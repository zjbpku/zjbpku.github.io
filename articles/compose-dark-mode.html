<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compose æ·±è‰²æ¨¡å¼å®Œå…¨æŒ‡å—ï¼šä¸»é¢˜åˆ‡æ¢ä¸åŠ¨æ€é€‚é… - Fidroid</title>
    <meta name="description" content="æ·±å…¥å­¦ä¹  Compose æ·±è‰²æ¨¡å¼å®ç°ï¼ŒæŒæ¡ä¸»é¢˜åˆ‡æ¢ã€Material You åŠ¨æ€é¢œè‰²ã€DataStore æŒä¹…åŒ–ç­‰æœ€ä½³å®è·µã€‚">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.8; color: #e5e7eb; background: #020617; }
        .navbar { background: rgba(15,23,42,0.98); backdrop-filter: blur(10px); position: fixed; top: 0; width: 100%; z-index: 1000; }
        .nav-container { max-width: 900px; margin: 0 auto; padding: 1rem 20px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; color: #38bdf8; text-decoration: none; letter-spacing: 0.08em; text-transform: uppercase; }
        .back-link { color: #9ca3af; text-decoration: none; font-size: 0.9rem; }
        .back-link:hover { color: #38bdf8; }
        .article-header { padding: 120px 20px 60px; background: radial-gradient(circle at top left, #1e1b4b 0, transparent 50%), radial-gradient(circle at bottom right, #fbbf24 0, transparent 55%), #020617; text-align: center; }
        .article-header h1 { max-width: 800px; margin: 0 auto 1rem; font-size: 2.5rem; font-weight: 800; letter-spacing: -0.03em; color: #fff; }
        .article-meta { color: #9ca3af; font-size: 0.9rem; margin-bottom: 1.5rem; }
        .article-tags { display: flex; justify-content: center; flex-wrap: wrap; gap: 0.5rem; }
        .article-tag { padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; background: rgba(15,23,42,0.85); border: 1px solid rgba(251,191,36,0.4); color: #fbbf24; }
        .article-content { max-width: 800px; margin: 0 auto; padding: 60px 20px 80px; }
        .article-content h2 { font-size: 1.6rem; margin: 2.5rem 0 1rem; color: #f9fafb; border-left: 4px solid #fbbf24; padding-left: 1rem; }
        .article-content h3 { font-size: 1.25rem; margin: 2rem 0 0.75rem; color: #e5e7eb; }
        .article-content p { margin-bottom: 1.25rem; color: #d1d5db; }
        .article-content ul { margin: 1rem 0 1.5rem 1.5rem; color: #d1d5db; }
        .article-content li { margin-bottom: 0.5rem; }
        .article-content strong { color: #f9fafb; }
        pre { background: #0f172a; border: 1px solid rgba(251,191,36,0.3); border-radius: 12px; padding: 1.25rem; overflow-x: auto; margin: 1.5rem 0; font-size: 0.85rem; line-height: 1.6; }
        code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; color: #e5e7eb; }
        .code-keyword { color: #c084fc; }
        .code-func { color: #38bdf8; }
        .code-type { color: #4ade80; }
        .code-string { color: #fb7185; }
        .code-comment { color: #6b7280; font-style: italic; }
        .callout { background: rgba(251,191,36,0.1); border: 1px solid rgba(251,191,36,0.3); border-radius: 12px; padding: 1.25rem 1.5rem; margin: 1.5rem 0; }
        .callout-title { font-weight: 600; color: #fbbf24; margin-bottom: 0.5rem; }
        .callout p { margin-bottom: 0; color: #d1d5db; }
        .footer { background: #020617; border-top: 1px solid #111827; padding: 2rem; text-align: center; color: #6b7280; }
        .footer a { color: #38bdf8; text-decoration: none; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="logo">Fidroid</a>
            <a href="../index.html#articles" class="back-link">â† è¿”å›åšå®¢åˆ—è¡¨</a>
        </div>
    </nav>

    <header class="article-header">
        <h1>Compose æ·±è‰²æ¨¡å¼å®Œå…¨æŒ‡å—ï¼šä¸»é¢˜åˆ‡æ¢ä¸åŠ¨æ€é€‚é…</h1>
        <p class="article-meta">2024-05-28 Â· 24 min Â· ä¸»é¢˜</p>
        <div class="article-tags">
            <span class="article-tag">Dark Mode</span>
            <span class="article-tag">Theme</span>
            <span class="article-tag">Material You</span>
            <span class="article-tag">Dynamic Colors</span>
        </div>
    </header>

    <article class="article-content">
        <p>æ·±è‰²æ¨¡å¼å·²æˆä¸ºç°ä»£åº”ç”¨çš„æ ‡é…åŠŸèƒ½ï¼Œä¸ä»…èƒ½å‡å°‘çœ¼ç›ç–²åŠ³ã€èŠ‚çœç”µé‡ï¼Œè¿˜èƒ½æä¾›æ›´å¥½çš„è§†è§‰ä½“éªŒã€‚æœ¬æ–‡å°†æ·±å…¥è®²è§£å¦‚ä½•åœ¨ Compose ä¸­å®ç°å®Œå–„çš„æ·±è‰²æ¨¡å¼æ”¯æŒã€‚</p>

        <h2>ä¸€ã€æ£€æµ‹ç³»ç»Ÿæ·±è‰²æ¨¡å¼</h2>
<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">App</span>() {
    <span class="code-keyword">val</span> isDarkTheme = <span class="code-func">isSystemInDarkTheme</span>()
    
    <span class="code-func">MyAppTheme</span>(darkTheme = isDarkTheme) {
        <span class="code-func">MainContent</span>()
    }
}</code></pre>

        <h2>äºŒã€ç”¨æˆ·å¯æ§çš„ä¸»é¢˜åˆ‡æ¢</h2>
<pre><code><span class="code-keyword">enum class</span> <span class="code-type">ThemeMode</span> { LIGHT, DARK, SYSTEM }

<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">App</span>(viewModel: <span class="code-type">ThemeViewModel</span>) {
    <span class="code-keyword">val</span> themeMode <span class="code-keyword">by</span> viewModel.themeMode.<span class="code-func">collectAsState</span>()
    <span class="code-keyword">val</span> systemDarkTheme = <span class="code-func">isSystemInDarkTheme</span>()
    
    <span class="code-keyword">val</span> isDarkTheme = <span class="code-keyword">when</span> (themeMode) {
        <span class="code-type">ThemeMode</span>.LIGHT -> <span class="code-keyword">false</span>
        <span class="code-type">ThemeMode</span>.DARK -> <span class="code-keyword">true</span>
        <span class="code-type">ThemeMode</span>.SYSTEM -> systemDarkTheme
    }
    
    <span class="code-func">MyAppTheme</span>(darkTheme = isDarkTheme) {
        <span class="code-func">MainContent</span>()
    }
}</code></pre>

        <h2>ä¸‰ã€Material You åŠ¨æ€é¢œè‰²</h2>
<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">MyAppTheme</span>(
    darkTheme: <span class="code-type">Boolean</span> = <span class="code-func">isSystemInDarkTheme</span>(),
    dynamicColor: <span class="code-type">Boolean</span> = <span class="code-keyword">true</span>,
    content: <span class="code-keyword">@Composable</span> () -> <span class="code-type">Unit</span>
) {
    <span class="code-keyword">val</span> colorScheme = <span class="code-keyword">when</span> {
        dynamicColor && Build.VERSION.SDK_INT >= Build.VERSION_CODES.S -> {
            <span class="code-keyword">val</span> context = <span class="code-func">LocalContext</span>.current
            <span class="code-keyword">if</span> (darkTheme) <span class="code-func">dynamicDarkColorScheme</span>(context) 
            <span class="code-keyword">else</span> <span class="code-func">dynamicLightColorScheme</span>(context)
        }
        darkTheme -> DarkColorScheme
        <span class="code-keyword">else</span> -> LightColorScheme
    }
    
    <span class="code-func">MaterialTheme</span>(colorScheme = colorScheme, content = content)
}</code></pre>

        <h2>å››ã€DataStore æŒä¹…åŒ–</h2>
<pre><code><span class="code-keyword">class</span> <span class="code-type">ThemePreferences</span>(<span class="code-keyword">private val</span> dataStore: <span class="code-type">DataStore</span>&lt;<span class="code-type">Preferences</span>&gt;) {
    
    <span class="code-keyword">val</span> themeMode: <span class="code-type">Flow</span>&lt;<span class="code-type">ThemeMode</span>&gt; = dataStore.data
        .<span class="code-func">map</span> { preferences ->
            <span class="code-keyword">val</span> modeString = preferences[THEME_MODE_KEY] ?: <span class="code-type">ThemeMode</span>.SYSTEM.name
            <span class="code-type">ThemeMode</span>.<span class="code-func">valueOf</span>(modeString)
        }
    
    <span class="code-keyword">suspend fun</span> <span class="code-func">setThemeMode</span>(mode: <span class="code-type">ThemeMode</span>) {
        dataStore.<span class="code-func">edit</span> { it[THEME_MODE_KEY] = mode.name }
    }
}</code></pre>

        <h2>äº”ã€è¯­ä¹‰åŒ–é¢œè‰²</h2>
<pre><code><span class="code-comment">// âœ… å¥½ï¼šä½¿ç”¨ MaterialTheme é¢œè‰²</span>
<span class="code-func">Card</span>(
    colors = <span class="code-type">CardDefaults</span>.<span class="code-func">cardColors</span>(
        containerColor = <span class="code-type">MaterialTheme</span>.colorScheme.surface,
        contentColor = <span class="code-type">MaterialTheme</span>.colorScheme.onSurface
    )
)

<span class="code-comment">// âŒ é¿å…ï¼šç¡¬ç¼–ç é¢œè‰²</span>
<span class="code-func">Card</span>(
    colors = <span class="code-type">CardDefaults</span>.<span class="code-func">cardColors</span>(
        containerColor = <span class="code-type">Color</span>.White  <span class="code-comment">// æ·±è‰²æ¨¡å¼ä¸‹ä¼šå¾ˆåˆºçœ¼</span>
    )
)</code></pre>

        <div class="callout">
            <p class="callout-title">ğŸ’¡ æœ€ä½³å®è·µ</p>
            <p>å§‹ç»ˆä½¿ç”¨ MaterialTheme.colorScheme ä¸­çš„é¢œè‰²ï¼Œé¿å…ç¡¬ç¼–ç ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åº”ç”¨åœ¨æ·±è‰²å’Œæµ…è‰²æ¨¡å¼ä¸‹éƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºã€‚</p>
        </div>

        <h2>å…­ã€Preview é¢„è§ˆä¸¤ç§ä¸»é¢˜</h2>
<pre><code><span class="code-keyword">@Preview</span>(name = <span class="code-string">"Light Mode"</span>)
<span class="code-keyword">@Preview</span>(name = <span class="code-string">"Dark Mode"</span>, uiMode = <span class="code-type">Configuration</span>.UI_MODE_NIGHT_YES)
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">ScreenPreview</span>() {
    <span class="code-func">MyAppTheme</span> {
        <span class="code-func">MyScreen</span>()
    }
}</code></pre>

        <h2>ä¸ƒã€æœ€ä½³å®è·µ</h2>
        <ul>
            <li>âœ… ä½¿ç”¨ <code>MaterialTheme.colorScheme</code> è€Œéç¡¬ç¼–ç é¢œè‰²</li>
            <li>âœ… æä¾›æµ…è‰²/æ·±è‰²/è·Ÿéšç³»ç»Ÿä¸‰ç§é€‰é¡¹</li>
            <li>âœ… ä½¿ç”¨ DataStore æŒä¹…åŒ–ç”¨æˆ·åå¥½</li>
            <li>âœ… Android 12+ æ”¯æŒ Material You åŠ¨æ€é¢œè‰²</li>
            <li>âœ… ä¸ºæ·±è‰²æ¨¡å¼é€‚é…å›¾ç‰‡å’Œå›¾æ ‡</li>
            <li>âœ… åœ¨ Preview ä¸­åŒæ—¶é¢„è§ˆä¸¤ç§ä¸»é¢˜</li>
        </ul>

        <h2>æ€»ç»“</h2>
        <ul>
            <li><strong>isSystemInDarkTheme()</strong>ï¼šæ£€æµ‹ç³»ç»Ÿæ·±è‰²æ¨¡å¼</li>
            <li><strong>ColorScheme</strong>ï¼šMaterial3 çš„é¢œè‰²æ–¹æ¡ˆ</li>
            <li><strong>dynamicColorScheme</strong>ï¼šAndroid 12+ åŠ¨æ€é¢œè‰²</li>
            <li><strong>DataStore</strong>ï¼šæŒä¹…åŒ–ä¸»é¢˜åå¥½</li>
            <li><strong>è¯­ä¹‰åŒ–é¢œè‰²</strong>ï¼šé¿å…ç¡¬ç¼–ç </li>
        </ul>
    </article>

    <footer class="footer">
        <p>&copy; 2024 Fidroid. <a href="../index.html">è¿”å›é¦–é¡µ</a></p>
    </footer>
</body>
</html>

