<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compose Canvas è‡ªå®šä¹‰ç»˜åˆ¶ï¼šå›¾å½¢ã€è·¯å¾„ä¸åŠ¨ç”» - Fidroid</title>
    <meta name="description" content="æ·±å…¥å­¦ä¹  Compose Canvas APIï¼ŒæŒæ¡ DrawScopeã€Pathã€æ¸å˜ç­‰ç»˜åˆ¶æŠ€æœ¯ï¼Œåˆ›å»ºè‡ªå®šä¹‰å›¾å½¢å’ŒåŠ¨ç”»æ•ˆæœã€‚">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.8;
            color: #e5e7eb;
            background: #020617;
        }
        .navbar {
            background: rgba(15,23,42,0.98);
            backdrop-filter: blur(10px);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }
        .nav-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 1rem 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #38bdf8;
            text-decoration: none;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }
        .back-link { color: #9ca3af; text-decoration: none; font-size: 0.9rem; }
        .back-link:hover { color: #38bdf8; }

        .article-header {
            padding: 120px 20px 60px;
            background: radial-gradient(circle at top left, #f97316 0, transparent 50%),
                        radial-gradient(circle at bottom right, #ec4899 0, transparent 55%),
                        #020617;
            text-align: center;
        }
        .article-header h1 {
            max-width: 800px;
            margin: 0 auto 1rem;
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -0.03em;
            color: #fff;
        }
        .article-meta { color: #9ca3af; font-size: 0.9rem; margin-bottom: 1.5rem; }
        .article-tags { display: flex; justify-content: center; flex-wrap: wrap; gap: 0.5rem; }
        .article-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            background: rgba(15,23,42,0.85);
            border: 1px solid rgba(249,115,22,0.4);
            color: #fb923c;
        }

        .article-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 60px 20px 80px;
        }
        .article-content h2 {
            font-size: 1.6rem;
            margin: 2.5rem 0 1rem;
            color: #f9fafb;
            border-left: 4px solid #f97316;
            padding-left: 1rem;
        }
        .article-content h3 { font-size: 1.25rem; margin: 2rem 0 0.75rem; color: #e5e7eb; }
        .article-content p { margin-bottom: 1.25rem; color: #d1d5db; }
        .article-content ul, .article-content ol { margin: 1rem 0 1.5rem 1.5rem; color: #d1d5db; }
        .article-content li { margin-bottom: 0.5rem; }
        .article-content strong { color: #f9fafb; }
        .article-content a { color: #38bdf8; text-decoration: underline; }

        pre {
            background: #0f172a;
            border: 1px solid rgba(249,115,22,0.3);
            border-radius: 12px;
            padding: 1.25rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-size: 0.85rem;
            line-height: 1.6;
        }
        code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; color: #e5e7eb; }
        .code-keyword { color: #c084fc; }
        .code-func { color: #38bdf8; }
        .code-type { color: #4ade80; }
        .code-string { color: #fb7185; }
        .code-comment { color: #6b7280; font-style: italic; }
        .code-number { color: #fbbf24; }

        .callout {
            background: rgba(249,115,22,0.1);
            border: 1px solid rgba(249,115,22,0.3);
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
            margin: 1.5rem 0;
        }
        .callout-title { font-weight: 600; color: #fb923c; margin-bottom: 0.5rem; }
        .callout p { margin-bottom: 0; color: #d1d5db; }

        .footer {
            background: #020617;
            border-top: 1px solid #111827;
            padding: 2rem;
            text-align: center;
            color: #6b7280;
        }
        .footer a { color: #38bdf8; text-decoration: none; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="logo">Fidroid</a>
            <a href="../index.html#articles" class="back-link">â† è¿”å›åšå®¢åˆ—è¡¨</a>
        </div>
    </nav>

    <header class="article-header">
        <h1>Compose Canvas è‡ªå®šä¹‰ç»˜åˆ¶ï¼šå›¾å½¢ã€è·¯å¾„ä¸åŠ¨ç”»</h1>
        <p class="article-meta">2024-05-12 Â· 28 min Â· è‡ªå®šä¹‰ç»˜åˆ¶</p>
        <div class="article-tags">
            <span class="article-tag">Canvas</span>
            <span class="article-tag">DrawScope</span>
            <span class="article-tag">Path</span>
            <span class="article-tag">è‡ªå®šä¹‰ç»˜åˆ¶</span>
        </div>
    </header>

    <article class="article-content">
        <p>å½“å†…ç½®ç»„ä»¶æ— æ³•æ»¡è¶³è®¾è®¡éœ€æ±‚æ—¶ï¼Œä½ éœ€è¦ä½¿ç”¨ Canvas è¿›è¡Œè‡ªå®šä¹‰ç»˜åˆ¶ã€‚Compose çš„ Canvas API æä¾›äº†å¼ºå¤§è€Œç®€æ´çš„ç»˜åˆ¶èƒ½åŠ›ï¼Œè®©ä½ å¯ä»¥åˆ›å»ºä»»æ„å¤æ‚çš„å›¾å½¢å’ŒåŠ¨ç”»æ•ˆæœã€‚</p>

        <h2>ä¸€ã€Canvas åŸºç¡€</h2>
        <h3>Canvas Composable</h3>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">SimpleCanvas</span>() {
    <span class="code-func">Canvas</span>(
        modifier = <span class="code-type">Modifier</span>
            .<span class="code-func">fillMaxWidth</span>()
            .<span class="code-func">height</span>(<span class="code-number">200</span>.dp)
    ) {
        <span class="code-comment">// this: DrawScope</span>
        <span class="code-comment">// size: Size - ç”»å¸ƒå°ºå¯¸</span>
        <span class="code-comment">// center: Offset - ç”»å¸ƒä¸­å¿ƒç‚¹</span>
        
        <span class="code-func">drawCircle</span>(
            color = <span class="code-type">Color</span>.Blue,
            radius = <span class="code-number">100f</span>,
            center = center
        )
    }
}</code></pre>

        <h2>äºŒã€åŸºç¡€å›¾å½¢ç»˜åˆ¶</h2>
        <h3>ç»˜åˆ¶çŸ©å½¢</h3>

<pre><code><span class="code-func">Canvas</span>(modifier = <span class="code-type">Modifier</span>.<span class="code-func">size</span>(<span class="code-number">300</span>.dp)) {
    <span class="code-comment">// å¡«å……çŸ©å½¢</span>
    <span class="code-func">drawRect</span>(
        color = <span class="code-type">Color</span>.Blue,
        topLeft = <span class="code-func">Offset</span>(<span class="code-number">20f</span>, <span class="code-number">20f</span>),
        size = <span class="code-func">Size</span>(<span class="code-number">200f</span>, <span class="code-number">100f</span>)
    )
    
    <span class="code-comment">// æè¾¹çŸ©å½¢</span>
    <span class="code-func">drawRect</span>(
        color = <span class="code-type">Color</span>.Red,
        topLeft = <span class="code-func">Offset</span>(<span class="code-number">20f</span>, <span class="code-number">140f</span>),
        size = <span class="code-func">Size</span>(<span class="code-number">200f</span>, <span class="code-number">100f</span>),
        style = <span class="code-func">Stroke</span>(width = <span class="code-number">4f</span>)
    )
    
    <span class="code-comment">// åœ†è§’çŸ©å½¢</span>
    <span class="code-func">drawRoundRect</span>(
        color = <span class="code-type">Color</span>.Green,
        cornerRadius = <span class="code-func">CornerRadius</span>(<span class="code-number">16f</span>)
    )
}</code></pre>

        <h3>ç»˜åˆ¶åœ†å½¢å’Œå¼§å½¢</h3>

<pre><code><span class="code-func">Canvas</span>(modifier = <span class="code-type">Modifier</span>.<span class="code-func">size</span>(<span class="code-number">300</span>.dp)) {
    <span class="code-comment">// åœ†å½¢</span>
    <span class="code-func">drawCircle</span>(
        color = <span class="code-type">Color</span>.Blue,
        radius = <span class="code-number">80f</span>,
        center = <span class="code-func">Offset</span>(<span class="code-number">100f</span>, <span class="code-number">100f</span>)
    )
    
    <span class="code-comment">// å¼§çº¿</span>
    <span class="code-func">drawArc</span>(
        color = <span class="code-type">Color</span>.Red,
        startAngle = <span class="code-number">0f</span>,
        sweepAngle = <span class="code-number">270f</span>,
        useCenter = <span class="code-keyword">false</span>,
        style = <span class="code-func">Stroke</span>(width = <span class="code-number">8f</span>, cap = <span class="code-type">StrokeCap</span>.Round)
    )
}</code></pre>

        <h2>ä¸‰ã€Path è·¯å¾„ç»˜åˆ¶</h2>
        <p>Path æ˜¯è‡ªå®šä¹‰ç»˜åˆ¶çš„æ ¸å¿ƒï¼Œå¯ä»¥åˆ›å»ºä»»æ„å¤æ‚çš„å½¢çŠ¶ã€‚</p>

        <h3>åŸºæœ¬ Path æ“ä½œ</h3>

<pre><code><span class="code-func">Canvas</span>(modifier = <span class="code-type">Modifier</span>.<span class="code-func">size</span>(<span class="code-number">300</span>.dp)) {
    <span class="code-keyword">val</span> path = <span class="code-func">Path</span>().<span class="code-func">apply</span> {
        <span class="code-func">moveTo</span>(<span class="code-number">50f</span>, <span class="code-number">200f</span>)       <span class="code-comment">// ç§»åŠ¨åˆ°èµ·ç‚¹</span>
        <span class="code-func">lineTo</span>(<span class="code-number">150f</span>, <span class="code-number">50f</span>)      <span class="code-comment">// ç›´çº¿åˆ°ä¸‹ä¸€ç‚¹</span>
        <span class="code-func">lineTo</span>(<span class="code-number">250f</span>, <span class="code-number">200f</span>)
        <span class="code-func">close</span>()                  <span class="code-comment">// é—­åˆè·¯å¾„</span>
    }
    
    <span class="code-func">drawPath</span>(path = path, color = <span class="code-type">Color</span>.Blue)
}</code></pre>

        <h3>è´å¡å°”æ›²çº¿</h3>

<pre><code><span class="code-keyword">val</span> path = <span class="code-func">Path</span>().<span class="code-func">apply</span> {
    <span class="code-func">moveTo</span>(<span class="code-number">50f</span>, <span class="code-number">200f</span>)
    
    <span class="code-comment">// äºŒæ¬¡è´å¡å°”æ›²çº¿</span>
    <span class="code-func">quadraticBezierTo</span>(
        x1 = <span class="code-number">150f</span>, y1 = <span class="code-number">0f</span>,   <span class="code-comment">// æ§åˆ¶ç‚¹</span>
        x2 = <span class="code-number">250f</span>, y2 = <span class="code-number">200f</span>  <span class="code-comment">// ç»ˆç‚¹</span>
    )
}

<span class="code-keyword">val</span> cubicPath = <span class="code-func">Path</span>().<span class="code-func">apply</span> {
    <span class="code-func">moveTo</span>(<span class="code-number">50f</span>, <span class="code-number">350f</span>)
    
    <span class="code-comment">// ä¸‰æ¬¡è´å¡å°”æ›²çº¿</span>
    <span class="code-func">cubicTo</span>(
        x1 = <span class="code-number">100f</span>, y1 = <span class="code-number">200f</span>,  <span class="code-comment">// æ§åˆ¶ç‚¹1</span>
        x2 = <span class="code-number">200f</span>, y2 = <span class="code-number">500f</span>,  <span class="code-comment">// æ§åˆ¶ç‚¹2</span>
        x3 = <span class="code-number">250f</span>, y3 = <span class="code-number">350f</span>   <span class="code-comment">// ç»ˆç‚¹</span>
    )
}</code></pre>

        <h2>å››ã€æ¸å˜ä¸ç”»åˆ·</h2>

<pre><code><span class="code-func">Canvas</span>(modifier = <span class="code-type">Modifier</span>.<span class="code-func">size</span>(<span class="code-number">300</span>.dp)) {
    <span class="code-comment">// çº¿æ€§æ¸å˜</span>
    <span class="code-keyword">val</span> linearGradient = <span class="code-type">Brush</span>.<span class="code-func">linearGradient</span>(
        colors = <span class="code-func">listOf</span>(<span class="code-type">Color</span>.Red, <span class="code-type">Color</span>.Yellow, <span class="code-type">Color</span>.Green),
        start = <span class="code-type">Offset</span>.Zero,
        end = <span class="code-func">Offset</span>(size.width, size.height)
    )
    <span class="code-func">drawRect</span>(brush = linearGradient)
    
    <span class="code-comment">// å¾„å‘æ¸å˜</span>
    <span class="code-keyword">val</span> radialGradient = <span class="code-type">Brush</span>.<span class="code-func">radialGradient</span>(
        colors = <span class="code-func">listOf</span>(<span class="code-type">Color</span>.Yellow, <span class="code-type">Color</span>.Transparent),
        center = center,
        radius = size.minDimension / <span class="code-number">2</span>
    )
    <span class="code-func">drawCircle</span>(brush = radialGradient)
}</code></pre>

        <h2>äº”ã€å®æˆ˜ï¼šç¯å½¢è¿›åº¦æ¡</h2>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">CircularProgressIndicator</span>(
    progress: <span class="code-type">Float</span>,  <span class="code-comment">// 0f - 1f</span>
    strokeWidth: <span class="code-type">Dp</span> = <span class="code-number">8</span>.dp,
    trackColor: <span class="code-type">Color</span> = <span class="code-type">Color</span>.LightGray,
    progressColor: <span class="code-type">Color</span> = <span class="code-type">Color</span>.Blue
) {
    <span class="code-func">Canvas</span>(modifier = <span class="code-type">Modifier</span>.<span class="code-func">size</span>(<span class="code-number">100</span>.dp)) {
        <span class="code-keyword">val</span> stroke = strokeWidth.<span class="code-func">toPx</span>()
        <span class="code-keyword">val</span> radius = (size.minDimension - stroke) / <span class="code-number">2</span>
        
        <span class="code-comment">// ç»˜åˆ¶è½¨é“</span>
        <span class="code-func">drawCircle</span>(
            color = trackColor,
            radius = radius,
            style = <span class="code-func">Stroke</span>(width = stroke)
        )
        
        <span class="code-comment">// ç»˜åˆ¶è¿›åº¦</span>
        <span class="code-func">drawArc</span>(
            color = progressColor,
            startAngle = -<span class="code-number">90f</span>,
            sweepAngle = <span class="code-number">360f</span> * progress,
            useCenter = <span class="code-keyword">false</span>,
            style = <span class="code-func">Stroke</span>(width = stroke, cap = <span class="code-type">StrokeCap</span>.Round)
        )
    }
}</code></pre>

        <h2>å…­ã€Canvas åŠ¨ç”»</h2>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">RotatingArc</span>() {
    <span class="code-keyword">val</span> infiniteTransition = <span class="code-func">rememberInfiniteTransition</span>(label = <span class="code-string">"rotation"</span>)
    <span class="code-keyword">val</span> rotation <span class="code-keyword">by</span> infiniteTransition.<span class="code-func">animateFloat</span>(
        initialValue = <span class="code-number">0f</span>,
        targetValue = <span class="code-number">360f</span>,
        animationSpec = <span class="code-func">infiniteRepeatable</span>(
            animation = <span class="code-func">tween</span>(<span class="code-number">2000</span>, easing = <span class="code-type">LinearEasing</span>)
        ),
        label = <span class="code-string">"rotation"</span>
    )
    
    <span class="code-func">Canvas</span>(modifier = <span class="code-type">Modifier</span>.<span class="code-func">size</span>(<span class="code-number">100</span>.dp)) {
        <span class="code-func">rotate</span>(rotation) {
            <span class="code-func">drawArc</span>(
                color = <span class="code-type">Color</span>.Blue,
                startAngle = <span class="code-number">0f</span>,
                sweepAngle = <span class="code-number">270f</span>,
                useCenter = <span class="code-keyword">false</span>,
                style = <span class="code-func">Stroke</span>(width = <span class="code-number">8f</span>, cap = <span class="code-type">StrokeCap</span>.Round)
            )
        }
    }
}</code></pre>

        <h2>ä¸ƒã€æ€§èƒ½ä¼˜åŒ–</h2>

        <h3>ä½¿ç”¨ drawWithCache</h3>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">CachedDrawing</span>() {
    <span class="code-func">Box</span>(
        modifier = <span class="code-type">Modifier</span>
            .<span class="code-func">size</span>(<span class="code-number">200</span>.dp)
            .<span class="code-func">drawWithCache</span> {
                <span class="code-comment">// è¿™é‡Œçš„è®¡ç®—åªåœ¨å°ºå¯¸å˜åŒ–æ—¶æ‰§è¡Œ</span>
                <span class="code-keyword">val</span> path = <span class="code-func">Path</span>().<span class="code-func">apply</span> { ... }
                <span class="code-keyword">val</span> brush = <span class="code-type">Brush</span>.<span class="code-func">linearGradient</span>(...)
                
                <span class="code-func">onDrawBehind</span> {
                    <span class="code-comment">// è¿™é‡Œæ¯å¸§æ‰§è¡Œï¼Œä½†ä½¿ç”¨ç¼“å­˜çš„å¯¹è±¡</span>
                    <span class="code-func">drawPath</span>(path, brush)
                }
            }
    )
}</code></pre>

        <div class="callout">
            <p class="callout-title">ğŸ’¡ æ€§èƒ½å»ºè®®</p>
            <p>é¿å…åœ¨ Canvas lambda ä¸­åˆ›å»ºå¯¹è±¡ï¼ˆPathã€Brush ç­‰ï¼‰ï¼Œä½¿ç”¨ remember æˆ– drawWithCache ç¼“å­˜å¤æ‚è®¡ç®—ã€‚</p>
        </div>

        <h2>æ€»ç»“</h2>
        <ul>
            <li><strong>Canvas Composable</strong>ï¼šæä¾› DrawScopeï¼Œæ˜¯è‡ªå®šä¹‰ç»˜åˆ¶çš„å…¥å£</li>
            <li><strong>åŸºç¡€å›¾å½¢</strong>ï¼šdrawRectã€drawCircleã€drawLineã€drawArc</li>
            <li><strong>Path</strong>ï¼šåˆ›å»ºä»»æ„å¤æ‚å½¢çŠ¶ï¼Œæ”¯æŒè´å¡å°”æ›²çº¿</li>
            <li><strong>Brush</strong>ï¼šçº¿æ€§ã€å¾„å‘ã€æ‰«ææ¸å˜</li>
            <li><strong>åŠ¨ç”»</strong>ï¼šç»“åˆ animate*AsState åˆ›å»ºåŠ¨æ€æ•ˆæœ</li>
            <li><strong>æ€§èƒ½</strong>ï¼šä½¿ç”¨ drawWithCache ç¼“å­˜å¤æ‚è®¡ç®—</li>
        </ul>
    </article>

    <footer class="footer">
        <p>&copy; 2024 Fidroid. <a href="../index.html">è¿”å›é¦–é¡µ</a></p>
    </footer>
</body>
</html>



