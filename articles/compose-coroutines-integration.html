<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compose ä¸ Coroutines æ·±åº¦é›†æˆï¼šå¼‚æ­¥ UI çš„æ­£ç¡®å§¿åŠ¿ - Fidroid</title>
    <meta name="description" content="æ·±å…¥ç†è§£ Compose ä¸ Kotlin Coroutines çš„é›†æˆæœºåˆ¶ï¼ŒæŒæ¡ LaunchedEffectã€rememberCoroutineScope çš„æ­£ç¡®ä½¿ç”¨ã€‚">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.8;
            color: #e5e7eb;
            background: #020617;
        }
        .navbar {
            background: rgba(15,23,42,0.98);
            backdrop-filter: blur(10px);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }
        .nav-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 1rem 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #38bdf8;
            text-decoration: none;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }
        .back-link { color: #9ca3af; text-decoration: none; font-size: 0.9rem; }
        .back-link:hover { color: #38bdf8; }

        .article-header {
            padding: 120px 20px 60px;
            background: radial-gradient(circle at top left, #8b5cf6 0, transparent 50%),
                        radial-gradient(circle at bottom right, #22c55e 0, transparent 55%),
                        #020617;
            text-align: center;
        }
        .article-header h1 {
            max-width: 800px;
            margin: 0 auto 1rem;
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -0.03em;
            color: #fff;
        }
        .article-meta { color: #9ca3af; font-size: 0.9rem; margin-bottom: 1.5rem; }
        .article-tags { display: flex; justify-content: center; flex-wrap: wrap; gap: 0.5rem; }
        .article-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            background: rgba(15,23,42,0.85);
            border: 1px solid rgba(139,92,246,0.4);
            color: #c4b5fd;
        }

        .article-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 60px 20px 80px;
        }
        .article-content h2 {
            font-size: 1.6rem;
            margin: 2.5rem 0 1rem;
            color: #f9fafb;
            border-left: 4px solid #8b5cf6;
            padding-left: 1rem;
        }
        .article-content h3 { font-size: 1.25rem; margin: 2rem 0 0.75rem; color: #e5e7eb; }
        .article-content p { margin-bottom: 1.25rem; color: #d1d5db; }
        .article-content ul, .article-content ol { margin: 1rem 0 1.5rem 1.5rem; color: #d1d5db; }
        .article-content li { margin-bottom: 0.5rem; }
        .article-content strong { color: #f9fafb; }
        .article-content a { color: #38bdf8; text-decoration: underline; }

        pre {
            background: #0f172a;
            border: 1px solid rgba(139,92,246,0.3);
            border-radius: 12px;
            padding: 1.25rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-size: 0.85rem;
            line-height: 1.6;
        }
        code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; color: #e5e7eb; }
        .code-keyword { color: #c084fc; }
        .code-func { color: #38bdf8; }
        .code-type { color: #4ade80; }
        .code-string { color: #fb7185; }
        .code-comment { color: #6b7280; font-style: italic; }
        .code-number { color: #fbbf24; }
        .code-annotation { color: #f472b6; }

        .callout {
            background: rgba(139,92,246,0.1);
            border: 1px solid rgba(139,92,246,0.3);
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
            margin: 1.5rem 0;
        }
        .callout-title { font-weight: 600; color: #c4b5fd; margin-bottom: 0.5rem; }
        .callout p { margin-bottom: 0; color: #d1d5db; }

        .callout-warning {
            background: rgba(245,158,11,0.1);
            border: 1px solid rgba(245,158,11,0.3);
        }
        .callout-warning .callout-title { color: #fcd34d; }

        .callout-info {
            background: rgba(14,165,233,0.1);
            border: 1px solid rgba(14,165,233,0.3);
        }
        .callout-info .callout-title { color: #7dd3fc; }

        .diagram {
            background: #0f172a;
            border: 1px solid rgba(139,92,246,0.3);
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
            text-align: center;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            font-size: 0.8rem;
            line-height: 1.6;
            color: #94a3b8;
            overflow-x: auto;
        }
        .diagram .highlight { color: #a78bfa; font-weight: bold; }
        .diagram .coroutine { color: #4ade80; }
        .diagram .compose { color: #38bdf8; }
        .diagram .cancel { color: #f87171; }

        .reference {
            background: rgba(15,23,42,0.6);
            border: 1px solid rgba(148,163,184,0.2);
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin: 1rem 0;
            font-size: 0.9rem;
        }
        .reference-title {
            font-weight: 600;
            color: #94a3b8;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        .reference a { color: #38bdf8; }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            font-size: 0.9rem;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid rgba(148,163,184,0.3);
            padding: 0.75rem 1rem;
            text-align: left;
        }
        .comparison-table th {
            background: rgba(15,23,42,0.8);
            color: #f9fafb;
        }
        .comparison-table td { color: #d1d5db; }

        .footer {
            background: #020617;
            border-top: 1px solid #111827;
            padding: 2rem;
            text-align: center;
            color: #6b7280;
        }
        .footer a { color: #38bdf8; text-decoration: none; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="logo">Fidroid</a>
            <a href="../index.html#blog" class="back-link">â† è¿”å›åšå®¢åˆ—è¡¨</a>
        </div>
    </nav>

    <header class="article-header">
        <h1>Compose ä¸ Coroutines æ·±åº¦é›†æˆï¼šå¼‚æ­¥ UI çš„æ­£ç¡®å§¿åŠ¿</h1>
        <p class="article-meta">2024-05-05 Â· 28 min Â· å®æˆ˜æ·±åº¦è§£æ</p>
        <div class="article-tags">
            <span class="article-tag">Coroutines</span>
            <span class="article-tag">LaunchedEffect</span>
            <span class="article-tag">rememberCoroutineScope</span>
            <span class="article-tag">Flow</span>
        </div>
    </header>

    <article class="article-content">
        <p>Compose å’Œ Kotlin Coroutines æ˜¯å¤©ä½œä¹‹åˆã€‚ä½†è¦æ­£ç¡®ä½¿ç”¨å®ƒä»¬çš„ç»„åˆï¼Œä½ éœ€è¦ç†è§£ï¼šä»€ä¹ˆæ—¶å€™ç”¨ <code>LaunchedEffect</code>ï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨ <code>rememberCoroutineScope</code>ï¼ŸFlow å¦‚ä½•å®‰å…¨åœ°æ”¶é›†ï¼Ÿæœ¬æ–‡å°†æ·±å…¥æ¢è®¨ Compose ä¸ Coroutines çš„é›†æˆæœºåˆ¶ï¼Œå¸®åŠ©ä½ å†™å‡ºæ­£ç¡®ä¸”é«˜æ•ˆçš„å¼‚æ­¥ UI ä»£ç ã€‚</p>

        <div class="reference">
            <div class="reference-title">ğŸ“š å®˜æ–¹å‚è€ƒ</div>
            <a href="https://developer.android.com/jetpack/compose/side-effects" target="_blank">Side Effects in Compose</a><br>
            <a href="https://developer.android.com/kotlin/coroutines" target="_blank">Kotlin Coroutines on Android</a>
        </div>

        <h2>ä¸€ã€Compose çš„åç¨‹ä½œç”¨åŸŸ</h2>

        <p>Compose æä¾›äº†å¤šç§æ–¹å¼æ¥å¯åŠ¨åç¨‹ï¼Œæ¯ç§éƒ½æœ‰å…¶ç‰¹å®šçš„ç”Ÿå‘½å‘¨æœŸå’Œä½¿ç”¨åœºæ™¯ã€‚</p>

        <h3>æ ¸å¿ƒ API å¯¹æ¯”</h3>

        <table class="comparison-table">
            <thead>
                <tr>
                    <th>API</th>
                    <th>ç”Ÿå‘½å‘¨æœŸ</th>
                    <th>ä½¿ç”¨åœºæ™¯</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>LaunchedEffect</td>
                    <td>è·Ÿéš Composable</td>
                    <td>è‡ªåŠ¨å¯åŠ¨çš„å‰¯ä½œç”¨</td>
                </tr>
                <tr>
                    <td>rememberCoroutineScope</td>
                    <td>è·Ÿéš Composable</td>
                    <td>äº‹ä»¶è§¦å‘çš„åç¨‹</td>
                </tr>
                <tr>
                    <td>DisposableEffect</td>
                    <td>è·Ÿéš Composable</td>
                    <td>éœ€è¦æ¸…ç†çš„èµ„æº</td>
                </tr>
                <tr>
                    <td>produceState</td>
                    <td>è·Ÿéš Composable</td>
                    <td>å°†å¼‚æ­¥æ•°æ®è½¬ä¸º State</td>
                </tr>
                <tr>
                    <td>ViewModel.viewModelScope</td>
                    <td>è·Ÿéš ViewModel</td>
                    <td>ä¸šåŠ¡é€»è¾‘åç¨‹</td>
                </tr>
            </tbody>
        </table>

        <h2>äºŒã€LaunchedEffect æ·±åº¦è§£æ</h2>

        <p><code>LaunchedEffect</code> æ˜¯æœ€å¸¸ç”¨çš„åç¨‹ APIï¼Œå®ƒåœ¨ Composable è¿›å…¥ç»„åˆæ—¶å¯åŠ¨åç¨‹ï¼Œç¦»å¼€æ—¶è‡ªåŠ¨å–æ¶ˆã€‚</p>

        <h3>åŸºæœ¬ç”¨æ³•</h3>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">UserProfile</span>(userId: <span class="code-type">String</span>) {
    <span class="code-keyword">var</span> user <span class="code-keyword">by</span> <span class="code-func">remember</span> { <span class="code-func">mutableStateOf</span>&lt;<span class="code-type">User</span>?&gt;(<span class="code-keyword">null</span>) }
    
    <span class="code-comment">// å½“ userId å˜åŒ–æ—¶ï¼Œå–æ¶ˆæ—§åç¨‹ï¼Œå¯åŠ¨æ–°åç¨‹</span>
    <span class="code-func">LaunchedEffect</span>(userId) {
        user = <span class="code-func">fetchUser</span>(userId)  <span class="code-comment">// æŒ‚èµ·å‡½æ•°</span>
    }
    
    user?.<span class="code-func">let</span> { <span class="code-func">UserCard</span>(it) }
}</code></pre>

        <h3>Key å‚æ•°çš„ä½œç”¨</h3>

        <p><code>LaunchedEffect</code> çš„ key å‚æ•°å†³å®šäº†åç¨‹ä½•æ—¶é‡å¯ï¼š</p>

<pre><code><span class="code-comment">// 1. å›ºå®š keyï¼šåªåœ¨é¦–æ¬¡ç»„åˆæ—¶æ‰§è¡Œä¸€æ¬¡</span>
<span class="code-func">LaunchedEffect</span>(<span class="code-type">Unit</span>) {
    <span class="code-comment">// åªæ‰§è¡Œä¸€æ¬¡</span>
    <span class="code-func">analytics</span>.<span class="code-func">trackScreenView</span>(<span class="code-string">"UserProfile"</span>)
}

<span class="code-comment">// 2. åŠ¨æ€ keyï¼škey å˜åŒ–æ—¶é‡å¯</span>
<span class="code-func">LaunchedEffect</span>(userId) {
    <span class="code-comment">// userId å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œ</span>
    user = <span class="code-func">fetchUser</span>(userId)
}

<span class="code-comment">// 3. å¤šä¸ª keyï¼šä»»ä¸€å˜åŒ–æ—¶é‡å¯</span>
<span class="code-func">LaunchedEffect</span>(userId, refreshTrigger) {
    <span class="code-comment">// userId æˆ– refreshTrigger å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œ</span>
    user = <span class="code-func">fetchUser</span>(userId)
}

<span class="code-comment">// 4. æ—  keyï¼ˆä¸æ¨èï¼‰ï¼šæ¯æ¬¡é‡ç»„éƒ½é‡å¯</span>
<span class="code-comment">// LaunchedEffect { } // ç¼–è¯‘é”™è¯¯ï¼šå¿…é¡»æä¾› key</span></code></pre>

        <div class="diagram">
<pre>
<span class="highlight">LaunchedEffect ç”Ÿå‘½å‘¨æœŸ</span>

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Composable ç”Ÿå‘½å‘¨æœŸ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  <span class="compose">è¿›å…¥ç»„åˆ</span> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ <span class="cancel">ç¦»å¼€ç»„åˆ</span>   â”‚
â”‚      â”‚                                              â”‚        â”‚
â”‚      â–¼                                              â–¼        â”‚
â”‚  <span class="coroutine">å¯åŠ¨åç¨‹</span>                                      <span class="cancel">å–æ¶ˆåç¨‹</span>      â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Key å˜åŒ–æ—¶                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  key = "A"          key = "B"                               â”‚
â”‚      â”‚                  â”‚                                   â”‚
â”‚      â–¼                  â–¼                                   â”‚
â”‚  <span class="coroutine">å¯åŠ¨åç¨‹ A</span>  â”€â”€â”€â–¶  <span class="cancel">å–æ¶ˆåç¨‹ A</span>  â”€â”€â”€â–¶  <span class="coroutine">å¯åŠ¨åç¨‹ B</span>           â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
        </div>

        <h3>LaunchedEffect çš„å†…éƒ¨å®ç°</h3>

<pre><code><span class="code-comment">// ç®€åŒ–çš„ LaunchedEffect å®ç°</span>
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">LaunchedEffect</span>(
    key1: <span class="code-type">Any</span>?,
    block: <span class="code-keyword">suspend</span> <span class="code-type">CoroutineScope</span>.() -> <span class="code-type">Unit</span>
) {
    <span class="code-keyword">val</span> currentBlock <span class="code-keyword">by</span> <span class="code-func">rememberUpdatedState</span>(block)
    
    <span class="code-func">DisposableEffect</span>(key1) {
        <span class="code-keyword">val</span> scope = <span class="code-type">CoroutineScope</span>(<span class="code-type">SupervisorJob</span>() + <span class="code-type">Dispatchers</span>.Main.immediate)
        scope.<span class="code-func">launch</span> {
            currentBlock()
        }
        
        <span class="code-func">onDispose</span> {
            scope.<span class="code-func">cancel</span>()  <span class="code-comment">// ç¦»å¼€ç»„åˆæ—¶å–æ¶ˆ</span>
        }
    }
}</code></pre>

        <div class="callout callout-info">
            <p class="callout-title">ğŸ’¡ ä¸ºä»€ä¹ˆä½¿ç”¨ rememberUpdatedStateï¼Ÿ</p>
            <p><code>rememberUpdatedState</code> ç¡®ä¿åç¨‹ä¸­å§‹ç»ˆä½¿ç”¨æœ€æ–°çš„ lambdaï¼Œè€Œä¸ä¼šå› ä¸ºæ•è·äº†æ—§å€¼å¯¼è‡´é—®é¢˜ã€‚è¿™åœ¨é•¿æ—¶é—´è¿è¡Œçš„åç¨‹ä¸­ç‰¹åˆ«é‡è¦ã€‚</p>
        </div>

        <h2>ä¸‰ã€rememberCoroutineScope è¯¦è§£</h2>

        <p><code>rememberCoroutineScope</code> æä¾›ä¸€ä¸ªä¸ Composable ç”Ÿå‘½å‘¨æœŸç»‘å®šçš„ <code>CoroutineScope</code>ï¼Œç”¨äºåœ¨äº‹ä»¶å›è°ƒä¸­å¯åŠ¨åç¨‹ã€‚</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">RefreshableList</span>() {
    <span class="code-keyword">val</span> scope = <span class="code-func">rememberCoroutineScope</span>()
    <span class="code-keyword">var</span> items <span class="code-keyword">by</span> <span class="code-func">remember</span> { <span class="code-func">mutableStateOf</span>(<span class="code-func">emptyList</span>&lt;<span class="code-type">Item</span>&gt;()) }
    <span class="code-keyword">var</span> isRefreshing <span class="code-keyword">by</span> <span class="code-func">remember</span> { <span class="code-func">mutableStateOf</span>(<span class="code-keyword">false</span>) }
    
    <span class="code-func">PullRefreshBox</span>(
        isRefreshing = isRefreshing,
        onRefresh = {
            <span class="code-comment">// åœ¨äº‹ä»¶å›è°ƒä¸­å¯åŠ¨åç¨‹</span>
            scope.<span class="code-func">launch</span> {
                isRefreshing = <span class="code-keyword">true</span>
                items = <span class="code-func">fetchItems</span>()
                isRefreshing = <span class="code-keyword">false</span>
            }
        }
    ) {
        <span class="code-func">LazyColumn</span> {
            <span class="code-func">items</span>(items) { <span class="code-func">ItemRow</span>(it) }
        }
    }
}</code></pre>

        <h3>LaunchedEffect vs rememberCoroutineScope</h3>

        <table class="comparison-table">
            <thead>
                <tr>
                    <th>ç‰¹æ€§</th>
                    <th>LaunchedEffect</th>
                    <th>rememberCoroutineScope</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>å¯åŠ¨æ—¶æœº</td>
                    <td>è‡ªåŠ¨ï¼ˆè¿›å…¥ç»„åˆæ—¶ï¼‰</td>
                    <td>æ‰‹åŠ¨ï¼ˆäº‹ä»¶è§¦å‘ï¼‰</td>
                </tr>
                <tr>
                    <td>å–æ¶ˆæ—¶æœº</td>
                    <td>è‡ªåŠ¨ï¼ˆç¦»å¼€ç»„åˆæˆ– key å˜åŒ–ï¼‰</td>
                    <td>è‡ªåŠ¨ï¼ˆç¦»å¼€ç»„åˆï¼‰</td>
                </tr>
                <tr>
                    <td>å…¸å‹åœºæ™¯</td>
                    <td>åˆå§‹åŒ–ã€æ•°æ®åŠ è½½</td>
                    <td>ç‚¹å‡»ã€æ»‘åŠ¨ç­‰äº‹ä»¶</td>
                </tr>
                <tr>
                    <td>é‡å¯æ§åˆ¶</td>
                    <td>é€šè¿‡ key å‚æ•°</td>
                    <td>æ‰‹åŠ¨æ§åˆ¶</td>
                </tr>
            </tbody>
        </table>

<pre><code><span class="code-comment">// âŒ é”™è¯¯ï¼šåœ¨ LaunchedEffect ä¸­å“åº”äº‹ä»¶</span>
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">BadExample</span>(onClick: () -> <span class="code-type">Unit</span>) {
    <span class="code-keyword">var</span> clicked <span class="code-keyword">by</span> <span class="code-func">remember</span> { <span class="code-func">mutableStateOf</span>(<span class="code-keyword">false</span>) }
    
    <span class="code-func">LaunchedEffect</span>(clicked) {
        <span class="code-keyword">if</span> (clicked) {
            <span class="code-func">doSomething</span>()  <span class="code-comment">// ä¸å¥½ï¼šç”¨çŠ¶æ€è§¦å‘å‰¯ä½œç”¨</span>
        }
    }
    
    <span class="code-func">Button</span>(onClick = { clicked = <span class="code-keyword">true</span> }) { ... }
}

<span class="code-comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨ rememberCoroutineScope</span>
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">GoodExample</span>() {
    <span class="code-keyword">val</span> scope = <span class="code-func">rememberCoroutineScope</span>()
    
    <span class="code-func">Button</span>(
        onClick = {
            scope.<span class="code-func">launch</span> { <span class="code-func">doSomething</span>() }
        }
    ) { ... }
}</code></pre>

        <h2>å››ã€å®‰å…¨æ”¶é›† Flow</h2>

        <p>åœ¨ Compose ä¸­æ”¶é›† Flow éœ€è¦ç‰¹åˆ«æ³¨æ„ç”Ÿå‘½å‘¨æœŸå®‰å…¨ã€‚</p>

        <h3>collectAsState</h3>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">UserScreen</span>(viewModel: <span class="code-type">UserViewModel</span>) {
    <span class="code-comment">// æœ€ç®€å•çš„æ–¹å¼ï¼šè‡ªåŠ¨å¤„ç†ç”Ÿå‘½å‘¨æœŸ</span>
    <span class="code-keyword">val</span> uiState <span class="code-keyword">by</span> viewModel.uiState.<span class="code-func">collectAsState</span>()
    
    <span class="code-keyword">when</span> (uiState) {
        <span class="code-keyword">is</span> <span class="code-type">UiState.Loading</span> -> <span class="code-func">LoadingIndicator</span>()
        <span class="code-keyword">is</span> <span class="code-type">UiState.Success</span> -> <span class="code-func">UserContent</span>(uiState.data)
        <span class="code-keyword">is</span> <span class="code-type">UiState.Error</span> -> <span class="code-func">ErrorMessage</span>(uiState.message)
    }
}</code></pre>

        <h3>collectAsStateWithLifecycleï¼ˆæ¨èï¼‰</h3>

<pre><code><span class="code-comment">// éœ€è¦æ·»åŠ ä¾èµ–ï¼šandroidx.lifecycle:lifecycle-runtime-compose</span>

<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">UserScreen</span>(viewModel: <span class="code-type">UserViewModel</span>) {
    <span class="code-comment">// æ›´å®‰å…¨ï¼šåœ¨ Activity/Fragment ä¸å¯è§æ—¶åœæ­¢æ”¶é›†</span>
    <span class="code-keyword">val</span> uiState <span class="code-keyword">by</span> viewModel.uiState.<span class="code-func">collectAsStateWithLifecycle</span>()
    
    <span class="code-comment">// ...</span>
}</code></pre>

        <div class="diagram">
<pre>
<span class="highlight">collectAsState vs collectAsStateWithLifecycle</span>

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   collectAsState                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  <span class="compose">Composable å¯è§</span>                    <span class="cancel">Composable ä¸å¯è§</span>       â”‚
â”‚        â”‚                                    â”‚               â”‚
â”‚        â–¼                                    â–¼               â”‚
â”‚    <span class="coroutine">æ”¶é›† Flow</span>                          <span class="cancel">åœæ­¢æ”¶é›†</span>             â”‚
â”‚                                                              â”‚
â”‚  é—®é¢˜ï¼šActivity åœ¨åå°æ—¶ä»ç„¶æ”¶é›†                               â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               collectAsStateWithLifecycle                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  <span class="compose">Activity STARTED</span>                    <span class="cancel">Activity STOPPED</span>       â”‚
â”‚        â”‚                                    â”‚               â”‚
â”‚        â–¼                                    â–¼               â”‚
â”‚    <span class="coroutine">æ”¶é›† Flow</span>                          <span class="cancel">åœæ­¢æ”¶é›†</span>             â”‚
â”‚                                                              â”‚
â”‚  ä¼˜åŠ¿ï¼šéµå¾ª Activity ç”Ÿå‘½å‘¨æœŸï¼Œæ›´çœèµ„æº                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
        </div>

        <div class="reference">
            <div class="reference-title">ğŸ“š æ·±å…¥é˜…è¯»</div>
            <a href="https://medium.com/androiddevelopers/consuming-flows-safely-in-jetpack-compose-cde014d0d5a3" target="_blank">Consuming Flows Safely in Jetpack Compose</a>
        </div>

        <h3>åœ¨ LaunchedEffect ä¸­æ”¶é›† Flow</h3>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">EventHandler</span>(viewModel: <span class="code-type">MyViewModel</span>) {
    <span class="code-keyword">val</span> context = <span class="code-type">LocalContext</span>.current
    
    <span class="code-comment">// æ”¶é›†ä¸€æ¬¡æ€§äº‹ä»¶ï¼ˆå¦‚ Toastã€å¯¼èˆªï¼‰</span>
    <span class="code-func">LaunchedEffect</span>(<span class="code-type">Unit</span>) {
        viewModel.events.<span class="code-func">collect</span> { event ->
            <span class="code-keyword">when</span> (event) {
                <span class="code-keyword">is</span> <span class="code-type">Event.ShowToast</span> -> {
                    <span class="code-type">Toast</span>.<span class="code-func">makeText</span>(context, event.message, <span class="code-type">Toast</span>.LENGTH_SHORT).<span class="code-func">show</span>()
                }
                <span class="code-keyword">is</span> <span class="code-type">Event.Navigate</span> -> {
                    <span class="code-comment">// å¯¼èˆª...</span>
                }
            }
        }
    }
}</code></pre>

        <h2>äº”ã€produceStateï¼šå°†å¼‚æ­¥æ•°æ®è½¬ä¸º State</h2>

        <p><code>produceState</code> æ˜¯ä¸€ä¸ªä¾¿æ·å‡½æ•°ï¼Œç”¨äºå°†å¼‚æ­¥æ•°æ®æºè½¬æ¢ä¸º Compose Stateã€‚</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">UserProfile</span>(userId: <span class="code-type">String</span>) {
    <span class="code-comment">// å°†æŒ‚èµ·å‡½æ•°ç»“æœè½¬ä¸º State</span>
    <span class="code-keyword">val</span> user <span class="code-keyword">by</span> <span class="code-func">produceState</span>&lt;<span class="code-type">User</span>?&gt;(initialValue = <span class="code-keyword">null</span>, userId) {
        value = <span class="code-func">fetchUser</span>(userId)
    }
    
    user?.<span class="code-func">let</span> { <span class="code-func">UserCard</span>(it) } ?: <span class="code-func">LoadingIndicator</span>()
}

<span class="code-comment">// æ›´å¤æ‚çš„ä¾‹å­ï¼šå¸¦åŠ è½½çŠ¶æ€</span>
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">UserProfile</span>(userId: <span class="code-type">String</span>) {
    <span class="code-keyword">val</span> userState <span class="code-keyword">by</span> <span class="code-func">produceState</span>&lt;<span class="code-type">Result</span>&lt;<span class="code-type">User</span>&gt;&gt;(
        initialValue = <span class="code-type">Result</span>.Loading,
        userId
    ) {
        value = <span class="code-keyword">try</span> {
            <span class="code-type">Result</span>.<span class="code-func">Success</span>(<span class="code-func">fetchUser</span>(userId))
        } <span class="code-keyword">catch</span> (e: <span class="code-type">Exception</span>) {
            <span class="code-type">Result</span>.<span class="code-func">Error</span>(e)
        }
    }
    
    <span class="code-keyword">when</span> (<span class="code-keyword">val</span> state = userState) {
        <span class="code-keyword">is</span> <span class="code-type">Result.Loading</span> -> <span class="code-func">LoadingIndicator</span>()
        <span class="code-keyword">is</span> <span class="code-type">Result.Success</span> -> <span class="code-func">UserCard</span>(state.data)
        <span class="code-keyword">is</span> <span class="code-type">Result.Error</span> -> <span class="code-func">ErrorMessage</span>(state.exception.message)
    }
}</code></pre>

        <h3>produceState ä¸ Flow</h3>

<pre><code><span class="code-comment">// å°† Flow è½¬ä¸º Stateï¼ˆç­‰åŒäº collectAsStateï¼‰</span>
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> &lt;<span class="code-type">T</span>&gt; <span class="code-type">Flow</span>&lt;<span class="code-type">T</span>&gt;.<span class="code-func">collectAsStateCustom</span>(initial: <span class="code-type">T</span>): <span class="code-type">State</span>&lt;<span class="code-type">T</span>&gt; {
    <span class="code-keyword">return</span> <span class="code-func">produceState</span>(initial, <span class="code-keyword">this</span>) {
        <span class="code-func">collect</span> { value = it }
    }
}</code></pre>

        <h2>å…­ã€snapshotFlowï¼šå°† Compose State è½¬ä¸º Flow</h2>

        <p><code>snapshotFlow</code> æ˜¯ <code>produceState</code> çš„åå‘æ“ä½œï¼Œå°† Compose State è½¬æ¢ä¸º Flowã€‚</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">SearchScreen</span>(viewModel: <span class="code-type">SearchViewModel</span>) {
    <span class="code-keyword">var</span> query <span class="code-keyword">by</span> <span class="code-func">remember</span> { <span class="code-func">mutableStateOf</span>(<span class="code-string">""</span>) }
    
    <span class="code-comment">// å°† Compose State è½¬ä¸º Flowï¼Œåº”ç”¨ Flow æ“ä½œç¬¦</span>
    <span class="code-func">LaunchedEffect</span>(<span class="code-type">Unit</span>) {
        <span class="code-func">snapshotFlow</span> { query }
            .<span class="code-func">debounce</span>(<span class="code-number">300</span>)           <span class="code-comment">// é˜²æŠ–</span>
            .<span class="code-func">filter</span> { it.<span class="code-func">isNotEmpty</span>() }  <span class="code-comment">// è¿‡æ»¤ç©ºæŸ¥è¯¢</span>
            .<span class="code-func">distinctUntilChanged</span>()   <span class="code-comment">// å»é‡</span>
            .<span class="code-func">collect</span> { searchQuery ->
                viewModel.<span class="code-func">search</span>(searchQuery)
            }
    }
    
    <span class="code-func">TextField</span>(
        value = query,
        onValueChange = { query = it },
        placeholder = { <span class="code-func">Text</span>(<span class="code-string">"æœç´¢..."</span>) }
    )
}</code></pre>

        <h3>snapshotFlow çš„åŸç†</h3>

<pre><code><span class="code-comment">// snapshotFlow ç®€åŒ–å®ç°</span>
<span class="code-keyword">fun</span> &lt;<span class="code-type">T</span>&gt; <span class="code-func">snapshotFlow</span>(block: () -> <span class="code-type">T</span>): <span class="code-type">Flow</span>&lt;<span class="code-type">T</span>&gt; = <span class="code-func">flow</span> {
    <span class="code-keyword">var</span> previousValue: <span class="code-type">T</span>? = <span class="code-keyword">null</span>
    
    <span class="code-keyword">while</span> (<span class="code-keyword">true</span>) {
        <span class="code-comment">// åœ¨ Snapshot ä¸­æ‰§è¡Œ blockï¼Œè¿½è¸ªè¯»å–çš„çŠ¶æ€</span>
        <span class="code-keyword">val</span> readStates = <span class="code-func">mutableSetOf</span>&lt;<span class="code-type">StateObject</span>&gt;()
        <span class="code-keyword">val</span> value = <span class="code-type">Snapshot</span>.<span class="code-func">observe</span>(
            readObserver = { readStates.<span class="code-func">add</span>(it) }
        ) {
            <span class="code-func">block</span>()
        }
        
        <span class="code-comment">// å¦‚æœå€¼å˜åŒ–ï¼Œå‘å°„</span>
        <span class="code-keyword">if</span> (value != previousValue) {
            <span class="code-func">emit</span>(value)
            previousValue = value
        }
        
        <span class="code-comment">// æŒ‚èµ·ç›´åˆ°ä»»ä¸€çŠ¶æ€å˜åŒ–</span>
        <span class="code-func">suspendUntilChanged</span>(readStates)
    }
}</code></pre>

        <h2>ä¸ƒã€å¤„ç†åç¨‹å–æ¶ˆ</h2>

        <p>æ­£ç¡®å¤„ç†åç¨‹å–æ¶ˆæ˜¯é¿å…å†…å­˜æ³„æ¼å’Œ bug çš„å…³é”®ã€‚</p>

        <h3>ä½¿ç”¨ NonCancellable</h3>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">DataEditor</span>(viewModel: <span class="code-type">EditorViewModel</span>) {
    <span class="code-keyword">val</span> scope = <span class="code-func">rememberCoroutineScope</span>()
    
    <span class="code-func">Button</span>(
        onClick = {
            scope.<span class="code-func">launch</span> {
                <span class="code-keyword">try</span> {
                    viewModel.<span class="code-func">saveData</span>()
                } <span class="code-keyword">finally</span> {
                    <span class="code-comment">// å³ä½¿åç¨‹è¢«å–æ¶ˆï¼Œä¹Ÿè¦æ‰§è¡Œæ¸…ç†</span>
                    <span class="code-func">withContext</span>(<span class="code-type">NonCancellable</span>) {
                        viewModel.<span class="code-func">cleanup</span>()
                    }
                }
            }
        }
    ) {
        <span class="code-func">Text</span>(<span class="code-string">"ä¿å­˜"</span>)
    }
}</code></pre>

        <h3>æ£€æŸ¥å–æ¶ˆçŠ¶æ€</h3>

<pre><code><span class="code-func">LaunchedEffect</span>(items) {
    items.<span class="code-func">forEach</span> { item ->
        <span class="code-comment">// åœ¨é•¿å¾ªç¯ä¸­æ£€æŸ¥å–æ¶ˆ</span>
        <span class="code-func">ensureActive</span>()  <span class="code-comment">// å¦‚æœå·²å–æ¶ˆï¼ŒæŠ›å‡º CancellationException</span>
        
        <span class="code-func">processItem</span>(item)
    }
}</code></pre>

        <h2>å…«ã€åç¨‹å¼‚å¸¸å¤„ç†</h2>

        <h3>ä½¿ç”¨ CoroutineExceptionHandler</h3>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">SafeCoroutineExample</span>() {
    <span class="code-keyword">val</span> errorHandler = <span class="code-func">remember</span> {
        <span class="code-type">CoroutineExceptionHandler</span> { _, throwable ->
            <span class="code-func">Log</span>.e(<span class="code-string">"Coroutine"</span>, <span class="code-string">"Error: </span>${throwable.message}<span class="code-string">"</span>)
        }
    }
    
    <span class="code-keyword">val</span> scope = <span class="code-func">rememberCoroutineScope</span>()
    
    <span class="code-func">Button</span>(
        onClick = {
            scope.<span class="code-func">launch</span>(errorHandler) {
                <span class="code-comment">// å¼‚å¸¸ä¼šè¢« errorHandler æ•è·</span>
                <span class="code-func">riskyOperation</span>()
            }
        }
    ) {
        <span class="code-func">Text</span>(<span class="code-string">"æ‰§è¡Œ"</span>)
    }
}</code></pre>

        <h3>ä½¿ç”¨ try-catch</h3>

<pre><code><span class="code-func">LaunchedEffect</span>(userId) {
    <span class="code-keyword">try</span> {
        user = <span class="code-func">fetchUser</span>(userId)
    } <span class="code-keyword">catch</span> (e: <span class="code-type">CancellationException</span>) {
        <span class="code-comment">// é‡æ–°æŠ›å‡ºå–æ¶ˆå¼‚å¸¸ï¼Œä¸è¦åæ‰å®ƒï¼</span>
        <span class="code-keyword">throw</span> e
    } <span class="code-keyword">catch</span> (e: <span class="code-type">Exception</span>) {
        error = e.message
    }
}</code></pre>

        <div class="callout callout-warning">
            <p class="callout-title">âš ï¸ ä¸è¦åæ‰ CancellationException</p>
            <p><code>CancellationException</code> æ˜¯åç¨‹å–æ¶ˆçš„ä¿¡å·ã€‚å¦‚æœä½ æ•è·äº†å®ƒä½†ä¸é‡æ–°æŠ›å‡ºï¼Œåç¨‹å°†æ— æ³•æ­£ç¡®å–æ¶ˆï¼Œå¯èƒ½å¯¼è‡´èµ„æºæ³„æ¼ã€‚</p>
        </div>

        <h2>ä¹ã€å®æˆ˜æ¨¡å¼</h2>

        <h3>æ¨¡å¼ 1ï¼šåŠ è½½-æ˜¾ç¤º-é”™è¯¯</h3>

<pre><code><span class="code-keyword">sealed class</span> <span class="code-type">UiState</span>&lt;<span class="code-keyword">out</span> <span class="code-type">T</span>&gt; {
    <span class="code-keyword">object</span> <span class="code-type">Loading</span> : <span class="code-type">UiState</span>&lt;<span class="code-type">Nothing</span>&gt;()
    <span class="code-keyword">data class</span> <span class="code-type">Success</span>&lt;<span class="code-type">T</span>&gt;(<span class="code-keyword">val</span> data: <span class="code-type">T</span>) : <span class="code-type">UiState</span>&lt;<span class="code-type">T</span>&gt;()
    <span class="code-keyword">data class</span> <span class="code-type">Error</span>(<span class="code-keyword">val</span> message: <span class="code-type">String</span>) : <span class="code-type">UiState</span>&lt;<span class="code-type">Nothing</span>&gt;()
}

<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> &lt;<span class="code-type">T</span>&gt; <span class="code-func">AsyncContent</span>(
    state: <span class="code-type">UiState</span>&lt;<span class="code-type">T</span>&gt;,
    onRetry: () -> <span class="code-type">Unit</span>,
    content: <span class="code-keyword">@Composable</span> (<span class="code-type">T</span>) -> <span class="code-type">Unit</span>
) {
    <span class="code-keyword">when</span> (state) {
        <span class="code-keyword">is</span> <span class="code-type">UiState.Loading</span> -> {
            <span class="code-func">Box</span>(<span class="code-type">Modifier</span>.<span class="code-func">fillMaxSize</span>(), <span class="code-type">Alignment</span>.Center) {
                <span class="code-func">CircularProgressIndicator</span>()
            }
        }
        <span class="code-keyword">is</span> <span class="code-type">UiState.Success</span> -> <span class="code-func">content</span>(state.data)
        <span class="code-keyword">is</span> <span class="code-type">UiState.Error</span> -> {
            <span class="code-func">Column</span>(
                <span class="code-type">Modifier</span>.<span class="code-func">fillMaxSize</span>(),
                <span class="code-type">Arrangement</span>.Center,
                <span class="code-type">Alignment</span>.CenterHorizontally
            ) {
                <span class="code-func">Text</span>(state.message)
                <span class="code-func">Button</span>(onClick = onRetry) {
                    <span class="code-func">Text</span>(<span class="code-string">"é‡è¯•"</span>)
                }
            }
        }
    }
}</code></pre>

        <h3>æ¨¡å¼ 2ï¼šé˜²æŠ–è¾“å…¥</h3>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">DebouncedTextField</span>(
    onValueChange: (<span class="code-type">String</span>) -> <span class="code-type">Unit</span>,
    debounceMs: <span class="code-type">Long</span> = <span class="code-number">300</span>
) {
    <span class="code-keyword">var</span> text <span class="code-keyword">by</span> <span class="code-func">remember</span> { <span class="code-func">mutableStateOf</span>(<span class="code-string">""</span>) }
    
    <span class="code-func">LaunchedEffect</span>(text) {
        <span class="code-func">delay</span>(debounceMs)
        <span class="code-func">onValueChange</span>(text)
    }
    
    <span class="code-func">TextField</span>(
        value = text,
        onValueChange = { text = it }
    )
}</code></pre>

        <h3>æ¨¡å¼ 3ï¼šè¶…æ—¶å¤„ç†</h3>

<pre><code><span class="code-func">LaunchedEffect</span>(userId) {
    <span class="code-keyword">try</span> {
        <span class="code-func">withTimeout</span>(<span class="code-number">5000</span>) {
            user = <span class="code-func">fetchUser</span>(userId)
        }
    } <span class="code-keyword">catch</span> (e: <span class="code-type">TimeoutCancellationException</span>) {
        error = <span class="code-string">"è¯·æ±‚è¶…æ—¶ï¼Œè¯·é‡è¯•"</span>
    }
}</code></pre>

        <h2>åã€æœ€ä½³å®è·µæ€»ç»“</h2>

        <h3>DO âœ…</h3>

        <ul>
            <li>ä½¿ç”¨ <code>LaunchedEffect</code> å¤„ç†è‡ªåŠ¨å¯åŠ¨çš„å‰¯ä½œç”¨</li>
            <li>ä½¿ç”¨ <code>rememberCoroutineScope</code> å¤„ç†äº‹ä»¶è§¦å‘çš„åç¨‹</li>
            <li>ä½¿ç”¨ <code>collectAsStateWithLifecycle</code> æ”¶é›† Flow</li>
            <li>æ­£ç¡®å¤„ç† <code>CancellationException</code></li>
            <li>ä¸º <code>LaunchedEffect</code> æä¾›æ­£ç¡®çš„ key</li>
        </ul>

        <h3>DON'T âŒ</h3>

        <ul>
            <li>ä¸è¦åœ¨ Composable ä¸­ç›´æ¥è°ƒç”¨ <code>GlobalScope.launch</code></li>
            <li>ä¸è¦åæ‰ <code>CancellationException</code></li>
            <li>ä¸è¦ç”¨çŠ¶æ€å˜åŒ–æ¥è§¦å‘äº‹ä»¶ï¼ˆç”¨ <code>rememberCoroutineScope</code>ï¼‰</li>
            <li>ä¸è¦å¿˜è®°å¤„ç†åç¨‹å¼‚å¸¸</li>
        </ul>

        <h2>æ€»ç»“</h2>

        <p>Compose ä¸ Coroutines çš„é›†æˆæ˜¯ç°ä»£ Android å¼€å‘çš„åŸºçŸ³ï¼š</p>

        <ul>
            <li><strong>LaunchedEffect</strong>ï¼šè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸçš„å‰¯ä½œç”¨</li>
            <li><strong>rememberCoroutineScope</strong>ï¼šäº‹ä»¶é©±åŠ¨çš„åç¨‹</li>
            <li><strong>collectAsStateWithLifecycle</strong>ï¼šå®‰å…¨çš„ Flow æ”¶é›†</li>
            <li><strong>produceState</strong>ï¼šå¼‚æ­¥æ•°æ®è½¬ State</li>
            <li><strong>snapshotFlow</strong>ï¼šState è½¬ Flow</li>
        </ul>

        <p>æŒæ¡è¿™äº› APIï¼Œä½ å°±èƒ½å†™å‡ºå®‰å…¨ã€é«˜æ•ˆçš„å¼‚æ­¥ UI ä»£ç ã€‚</p>

        <div class="reference">
            <div class="reference-title">ğŸ“š æ¨èé˜…è¯»</div>
            <a href="https://developer.android.com/jetpack/compose/side-effects" target="_blank">Side Effects in Compose</a><br>
            <a href="https://developer.android.com/kotlin/flow/stateflow-and-sharedflow" target="_blank">StateFlow and SharedFlow</a><br>
            <a href="https://www.youtube.com/watch?v=BOHK_w09pVA" target="_blank">Kotlin Coroutines 101 (Video)</a>
        </div>
    </article>

    <footer class="footer">
        <p>&copy; 2024 Fidroid. <a href="../index.html">è¿”å›é¦–é¡µ</a></p>
    </footer>
</body>
</html>

