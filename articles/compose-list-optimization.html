<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compose å¤æ‚åˆ—è¡¨å®æˆ˜ä¼˜åŒ–æŠ€å·§ - Fidroid</title>
    <meta name="description" content="æ·±å…¥æ¢è®¨å¤æ‚åˆ—è¡¨çš„å®æˆ˜ä¼˜åŒ–æŠ€å·§ï¼Œä»åŸºç¡€ä¼˜åŒ–åˆ°é«˜çº§æŠ€å·§ï¼Œå¸®åŠ©ä½ æ„å»ºæµç•…ã€é«˜æ•ˆçš„åˆ—è¡¨ç•Œé¢ã€‚">
    <style>

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.8; color: #e5e7eb; background: #020617; }
        .navbar { background: rgba(15,23,42,0.98); backdrop-filter: blur(10px); position: fixed; top: 0; width: 100%; z-index: 1000; }
        .nav-container { max-width: 900px; margin: 0 auto; padding: 1rem 20px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; color: #38bdf8; text-decoration: none; letter-spacing: 0.08em; text-transform: uppercase; }
        .back-link { color: #9ca3af; text-decoration: none; font-size: 0.9rem; }
        .back-link:hover { color: #38bdf8; }
        .article-header { padding: 120px 20px 60px; background: radial-gradient(circle at top left, #dc2626 0, transparent 50%), radial-gradient(circle at bottom right, #7c3aed 0, transparent 55%), #020617; text-align: center; }
        .article-header h1 { max-width: 800px; margin: 0 auto 1rem; font-size: 2.5rem; font-weight: 800; letter-spacing: -0.03em; color: #fff; }
        .article-meta { color: #9ca3af; font-size: 0.9rem; margin-bottom: 1.5rem; }
        .article-tags { display: flex; justify-content: center; flex-wrap: wrap; gap: 0.5rem; }
        .article-tag { padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; background: rgba(15,23,42,0.85); border: 1px solid rgba(220,38,38,0.4); color: #f87171; }
        .article-content { max-width: 800px; margin: 0 auto; padding: 60px 20px 80px; }
        .article-content h2 { font-size: 1.6rem; margin: 2.5rem 0 1rem; color: #f9fafb; border-left: 4px solid #dc2626; padding-left: 1rem; }
        .article-content h3 { font-size: 1.25rem; margin: 2rem 0 0.75rem; color: #e5e7eb; }
        .article-content p { margin-bottom: 1.25rem; color: #d1d5db; }
        .article-content ul, .article-content ol { margin: 1rem 0 1.5rem 1.5rem; color: #d1d5db; }
        .article-content li { margin-bottom: 0.5rem; }
        .article-content strong { color: #f9fafb; }
        pre { background: #0f172a; border: 1px solid rgba(220,38,38,0.3); border-radius: 12px; padding: 1.25rem; overflow-x: auto; margin: 1.5rem 0; font-size: 0.85rem; line-height: 1.6; }
        code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; color: #e5e7eb; }
        .code-keyword { color: #c084fc; }
        .code-func { color: #38bdf8; }
        .code-type { color: #4ade80; }
        .code-string { color: #fb7185; }
        .code-comment { color: #6b7280; font-style: italic; }
        .footer { background: #020617; border-top: 1px solid #111827; padding: 2rem; text-align: center; color: #6b7280; }
        .footer a { color: #38bdf8; text-decoration: none; }
    
        .toc {
            background: rgba(15,23,42,0.6);
            border: 1px solid rgba(220,38,38,0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0 3rem;
        }
        .toc-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #f87171;
            margin-bottom: 1rem;
        }
        .toc-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .toc-list li {
            margin: 0.5rem 0;
        }
        .toc-h2 {
            margin-left: 0;
        }
        .toc-list a {
            color: #d1d5db;
            text-decoration: none;
        }
        .toc-list a:hover {
            color: #38bdf8;
        }
        .code-bad {
            background: rgba(220,38,38,0.1);
            border-left: 3px solid #ef4444;
            padding: 1rem;
            margin: 1rem 0;
        }
        .code-good {
            background: rgba(34,197,94,0.1);
            border-left: 3px solid #22c55e;
            padding: 1rem;
            margin: 1rem 0;
        }
        .reference {
            background: rgba(15,23,42,0.6);
            border: 1px solid rgba(148,163,184,0.2);
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin: 1rem 0;
            font-size: 0.9rem;
        }
        .reference-title {
            font-weight: 600;
            color: #94a3b8;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        .reference a { color: #38bdf8; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="logo">Fidroid</a>
            <a href="../index.html#blog" class="back-link">â† è¿”å›åšå®¢åˆ—è¡¨</a>
        </div>
    </nav>

    <header class="article-header">
        <h1>Compose å¤æ‚åˆ—è¡¨å®æˆ˜ä¼˜åŒ–æŠ€å·§</h1>
        <p class="article-meta">2024-12-23 Â· 30-35 min Â· åˆ—è¡¨ä¼˜åŒ–</p>
        <div class="article-tags">
            <span class="article-tag">åˆ—è¡¨ä¼˜åŒ–</span>
            <span class="article-tag">LazyColumn</span>
            <span class="article-tag">æ€§èƒ½ä¼˜åŒ–</span>
            <span class="article-tag">å®æˆ˜æŠ€å·§</span>
        </div>
    </header>

    <article class="article-content">
        <nav class="toc">
            <div class="toc-title">ğŸ“š ç›®å½•</div>
            <ul class="toc-list">
                <li class="toc-h2"><a href="#i-åŸºç¡€ä¼˜åŒ–æŠ€å·§">I. åŸºç¡€ä¼˜åŒ–æŠ€å·§</a></li>
                <li class="toc-h2"><a href="#ii-å¤æ‚å¸ƒå±€ä¼˜åŒ–">II. å¤æ‚å¸ƒå±€ä¼˜åŒ–</a></li>
                <li class="toc-h2"><a href="#iii-å›¾ç‰‡åŠ è½½ä¼˜åŒ–">III. å›¾ç‰‡åŠ è½½ä¼˜åŒ–</a></li>
                <li class="toc-h2"><a href="#iv-åŠ¨æ€å†…å®¹ä¼˜åŒ–">IV. åŠ¨æ€å†…å®¹ä¼˜åŒ–</a></li>
                <li class="toc-h2"><a href="#v-å¤šç±»å‹åˆ—è¡¨ä¼˜åŒ–">V. å¤šç±»å‹åˆ—è¡¨ä¼˜åŒ–</a></li>
                <li class="toc-h2"><a href="#vi-ç½‘æ ¼åˆ—è¡¨ä¼˜åŒ–">VI. ç½‘æ ¼åˆ—è¡¨ä¼˜åŒ–</a></li>
                <li class="toc-h2"><a href="#vii-åµŒå¥—åˆ—è¡¨ä¼˜åŒ–">VII. åµŒå¥—åˆ—è¡¨ä¼˜åŒ–</a></li>
                <li class="toc-h2"><a href="#viii-é«˜çº§ä¼˜åŒ–æŠ€å·§">VIII. é«˜çº§ä¼˜åŒ–æŠ€å·§</a></li>
            </ul>
        </nav>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œåˆ—è¡¨æ˜¯æœ€å¸¸è§çš„ UI ç»„ä»¶ä¹‹ä¸€ã€‚ä»ç®€å•çš„æ–‡æœ¬åˆ—è¡¨åˆ°å¤æ‚çš„å¡ç‰‡åˆ—è¡¨ï¼Œä»å•åˆ—åˆ°å¤šåˆ—ç½‘æ ¼ï¼Œä»é™æ€å†…å®¹åˆ°åŠ¨æ€åŠ è½½ï¼Œåˆ—è¡¨çš„æ€§èƒ½ç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒã€‚æœ¬æ–‡æ·±å…¥æ¢è®¨å¤æ‚åˆ—è¡¨çš„å®æˆ˜ä¼˜åŒ–æŠ€å·§ï¼Œå¸®åŠ©ä½ æ„å»ºæµç•…ã€é«˜æ•ˆçš„åˆ—è¡¨ç•Œé¢ã€‚</p>
        <h3 id="-å®˜æ–¹å‚è€ƒ">ğŸ“š å®˜æ–¹å‚è€ƒ</h3>
        <ul>
        <li><a href="https://developer.android.com/jetpack/compose/lists" target="_blank">Lists in Compose - Android Developers</a></li>
        <li><a href="https://developer.android.com/jetpack/compose/performance" target="_blank">Performance best practices - Android Developers</a></li>
        <li><a href="https://developer.android.com/jetpack/compose/lists#lazy" target="_blank">LazyColumn and LazyRow - Android Developers</a></li>
        </ul>
        <h3 id="ç›®å½•">ç›®å½•</h3>
        <ul>
        <li><a href="#i-åŸºç¡€ä¼˜åŒ–æŠ€å·§" target="_blank">I. åŸºç¡€ä¼˜åŒ–æŠ€å·§</a></li>
        <li><a href="#ii-å¤æ‚å¸ƒå±€ä¼˜åŒ–" target="_blank">II. å¤æ‚å¸ƒå±€ä¼˜åŒ–</a></li>
        <li><a href="#iii-å›¾ç‰‡åŠ è½½ä¼˜åŒ–" target="_blank">III. å›¾ç‰‡åŠ è½½ä¼˜åŒ–</a></li>
        <li><a href="#iv-åŠ¨æ€å†…å®¹ä¼˜åŒ–" target="_blank">IV. åŠ¨æ€å†…å®¹ä¼˜åŒ–</a></li>
        <li><a href="#v-å¤šç±»å‹åˆ—è¡¨ä¼˜åŒ–" target="_blank">V. å¤šç±»å‹åˆ—è¡¨ä¼˜åŒ–</a></li>
        <li><a href="#vi-ç½‘æ ¼åˆ—è¡¨ä¼˜åŒ–" target="_blank">VI. ç½‘æ ¼åˆ—è¡¨ä¼˜åŒ–</a></li>
        <li><a href="#vii-åµŒå¥—åˆ—è¡¨ä¼˜åŒ–" target="_blank">VII. åµŒå¥—åˆ—è¡¨ä¼˜åŒ–</a></li>
        <li><a href="#viii-é«˜çº§ä¼˜åŒ–æŠ€å·§" target="_blank">VIII. é«˜çº§ä¼˜åŒ–æŠ€å·§</a></li>
        </ul>
        <h3 id="i-åŸºç¡€ä¼˜åŒ–æŠ€å·§">I. åŸºç¡€ä¼˜åŒ–æŠ€å·§</h3>
        <p>æŒæ¡åŸºç¡€ä¼˜åŒ–æŠ€å·§æ˜¯æ„å»ºé«˜æ€§èƒ½åˆ—è¡¨çš„å‰æã€‚</p>
        <h4>1.1 æ­£ç¡®ä½¿ç”¨ key</h4>
        <p>key æ˜¯åˆ—è¡¨ä¼˜åŒ–çš„åŸºç¡€ï¼Œæ²¡æœ‰ key ä¼šå¯¼è‡´çŠ¶æ€é”™ä¹±å’Œæ€§èƒ½é—®é¢˜ã€‚</p>
        <div class="code-bad"><pre><code>
        // âŒ é”™è¯¯ï¼šæ²¡æœ‰ key
@Composable
fun ItemList(items: List&lt;Item&gt;) {
    LazyColumn {
        items(items) { item -&gt;
            ItemRow(item)  // çŠ¶æ€ä¼šé”™ä¹±
        }
    }
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç¨³å®šçš„ key
@Composable
fun ItemList(items: List&lt;Item&gt;) {
    LazyColumn {
        items(
            items = items,
            key = { it.id }  // ä½¿ç”¨å”¯ä¸€ä¸”ç¨³å®šçš„ ID
        ) { item -&gt;
            ItemRow(item)
        }
    }
}

// âœ… æ›´å¥½çš„åšæ³•ï¼šä½¿ç”¨å¤åˆ key
@Composable
fun ItemList(items: List&lt;Item&gt;) {
    LazyColumn {
        items(
            items = items,
            key = { "${it.type}-${it.id}" }  // ç±»å‹ + ID ç»„åˆ
        ) { item -&gt;
            ItemRow(item)
        }
    }
}
        </code></pre></div>
        <p><strong>ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ</strong></p>
        <ul>
        <li>key å¸®åŠ© Compose è¯†åˆ«åˆ—è¡¨é¡¹çš„èº«ä»½</li>
        <li>æ²¡æœ‰ key æ—¶ï¼Œä½ç½®å˜åŒ–ä¼šå¯¼è‡´çŠ¶æ€é”™ä¹±</li>
        <li>æ­£ç¡®çš„ key å¯ä»¥é¿å…ä¸å¿…è¦çš„é‡ç»„</li>
        </ul>
        <h4>1.2 é¿å…åœ¨åˆ—è¡¨é¡¹ä¸­åˆ›å»ºçŠ¶æ€</h4>
        <p>åœ¨åˆ—è¡¨é¡¹ä¸­åˆ›å»ºçŠ¶æ€ä¼šå¯¼è‡´æ¯ä¸ªé¡¹éƒ½æœ‰ç‹¬ç«‹çŠ¶æ€ï¼Œå¯èƒ½é€ æˆå†…å­˜é—®é¢˜ã€‚</p>
        <div class="code-bad"><pre><code>
        // âŒ é”™è¯¯ï¼šæ¯ä¸ªåˆ—è¡¨é¡¹éƒ½æœ‰ç‹¬ç«‹çŠ¶æ€
@Composable
fun ItemList(items: List&lt;Item&gt;) {
    LazyColumn {
        items(items) { item -&gt;
            var isExpanded by remember { mutableStateOf(false) }
            // å¦‚æœåˆ—è¡¨æœ‰ 1000 é¡¹ï¼Œå°±æœ‰ 1000 ä¸ªçŠ¶æ€å¯¹è±¡
            ExpandableItemRow(item, isExpanded) { 
                isExpanded = !isExpanded 
            }
        }
    }
}

// âœ… æ­£ç¡®ï¼šçŠ¶æ€æå‡åˆ°åˆ—è¡¨çº§åˆ«
@Composable
fun ItemList(items: List&lt;Item&gt;) {
    var expandedIds by remember { mutableStateOf(setOf&lt;Long&gt;()) }
    
    LazyColumn {
        items(items) { item -&gt;
            ExpandableItemRow(
                item = item,
                isExpanded = expandedIds.contains(item.id),
                onExpandedChange = { expanded -&gt;
                    expandedIds = if (expanded) {
                        expandedIds + item.id
                    } else {
                        expandedIds - item.id
                    }
                }
            )
        }
    }
}
        </code></pre></div>
        <h4>1.3 ä½¿ç”¨ contentPadding è€Œé padding</h4>
        <p><code>contentPadding</code> æ˜¯ LazyColumn çš„ä¸“ç”¨å±æ€§ï¼Œæ€§èƒ½æ›´å¥½ã€‚</p>
        <div class="code-bad"><pre><code>
        // âŒ é”™è¯¯ï¼šä½¿ç”¨ padding
@Composable
fun ItemList(items: List&lt;Item&gt;) {
    LazyColumn(
        modifier = Modifier.padding(16.dp)  // å½±å“æ•´ä¸ªåˆ—è¡¨
    ) {
        items(items) { item -&gt;
            ItemRow(item)
        }
    }
}

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ contentPadding
@Composable
fun ItemList(items: List&lt;Item&gt;) {
    LazyColumn(
        contentPadding = PaddingValues(16.dp)  // åªå½±å“å†…å®¹åŒºåŸŸ
    ) {
        items(items) { item -&gt;
            ItemRow(item)
        }
    }
}
        </code></pre></div>
        <h4>1.4 åˆç†è®¾ç½® itemSpacing</h4>
        <p>é€‚å½“çš„é—´è·å¯ä»¥æå‡è§†è§‰ä½“éªŒï¼Œä½†è¦æ³¨æ„æ€§èƒ½ã€‚</p>
        <div class="code-bad"><pre><code>
        // âœ… æ­£ç¡®ï¼šä½¿ç”¨ itemSpacing
@Composable
fun ItemList(items: List&lt;Item&gt;) {
    LazyColumn(
        verticalArrangement = Arrangement.spacedBy(8.dp)  // ç»Ÿä¸€é—´è·
    ) {
        items(items) { item -&gt;
            ItemRow(item)
        }
    }
}

// âŒ é¿å…ï¼šåœ¨æ¯ä¸ª item ä¸­å•ç‹¬è®¾ç½® margin
@Composable
fun ItemList(items: List&lt;Item&gt;) {
    LazyColumn {
        items(items) { item -&gt;
            ItemRow(
                item = item,
                modifier = Modifier.padding(vertical = 8.dp)  // ä¸æ¨è
            )
        }
    }
}
        </code></pre></div>
        <h3 id="ii-å¤æ‚å¸ƒå±€ä¼˜åŒ–">II. å¤æ‚å¸ƒå±€ä¼˜åŒ–</h3>
        <p>å¤æ‚å¸ƒå±€çš„åˆ—è¡¨é¡¹éœ€è¦ç‰¹åˆ«æ³¨æ„ä¼˜åŒ–ã€‚</p>
        <h4>2.1 é¿å…æ·±å±‚åµŒå¥—</h4>
        <p>æ·±å±‚åµŒå¥—ä¼šå½±å“å¸ƒå±€æ€§èƒ½ã€‚</p>
        <div class="code-bad"><pre><code>
        // âŒ é”™è¯¯ï¼šè¿‡åº¦åµŒå¥—
@Composable
fun ComplexItemRow(item: Item) {
    Column {
        Row {
            Column {
                Row {
                    Text(item.title)
                }
            }
        }
    }
}

// âœ… æ­£ç¡®ï¼šæ‰å¹³åŒ–å¸ƒå±€
@Composable
fun OptimizedItemRow(item: Item) {
    Row(
        modifier = Modifier.fillMaxWidth(),
        horizontalArrangement = Arrangement.SpaceBetween
    ) {
        Column(modifier = Modifier.weight(1f)) {
            Text(item.title)
            Text(item.subtitle)
        }
        Image(item.avatar)
    }
}
        </code></pre></div>
        <h4>2.2 ä½¿ç”¨ ConstraintLayout ä¼˜åŒ–å¤æ‚å¸ƒå±€</h4>
        <p>å¯¹äºå¤æ‚çš„å¸ƒå±€ï¼ŒConstraintLayout å¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½ã€‚</p>
        <div class="code-good"><pre><code>
        // âœ… ä½¿ç”¨ ConstraintLayout ä¼˜åŒ–å¤æ‚å¸ƒå±€
@Composable
fun ComplexItemRow(item: Item) {
    ConstraintLayout(
        modifier = Modifier
            .fillMaxWidth()
            .padding(16.dp)
    ) {
        val (avatar, title, subtitle, action) = createRefs()
        
        AsyncImage(
            model = item.avatarUrl,
            contentDescription = null,
            modifier = Modifier
                .size(48.dp)
                .constrainAs(avatar) {
                    start.linkTo(parent.start)
                    top.linkTo(parent.top)
                }
        )
        
        Text(
            text = item.title,
            modifier = Modifier.constrainAs(title) {
                start.linkTo(avatar.end, 16.dp)
                top.linkTo(parent.top)
                end.linkTo(action.start, 16.dp)
            }
        )
        
        Text(
            text = item.subtitle,
            modifier = Modifier.constrainAs(subtitle) {
                start.linkTo(title.start)
                top.linkTo(title.bottom, 8.dp)
            }
        )
        
        Button(
            onClick = { },
            modifier = Modifier.constrainAs(action) {
                end.linkTo(parent.end)
                top.linkTo(parent.top)
            }
        ) {
            Text("Action")
        }
    }
}
        </code></pre></div>
        <h4>2.3 ç¼“å­˜è®¡ç®—ç»“æœ</h4>
        <p>åœ¨åˆ—è¡¨é¡¹ä¸­é¿å…é‡å¤è®¡ç®—ã€‚</p>
        <div class="code-bad"><pre><code>
        // âŒ é”™è¯¯ï¼šæ¯æ¬¡é‡ç»„éƒ½è®¡ç®—
@Composable
fun ItemRow(item: Item) {
    val formattedPrice = formatPrice(item.price)  // æ¯æ¬¡éƒ½è®¡ç®—
    val displayName = item.name.uppercase()  // æ¯æ¬¡éƒ½è®¡ç®—
    
    Row {
        Text(formattedPrice)
        Text(displayName)
    }
}

// âœ… æ­£ç¡®ï¼šé¢„å…ˆå¤„ç†æ•°æ®
data class ProcessedItem(
    val id: Long,
    val formattedPrice: String,
    val displayName: String,
    // ... å…¶ä»–å­—æ®µ
)

@Composable
fun ItemList(items: List&lt;Item&gt;) {
    val processedItems = remember(items) {
        items.map { item -&gt;
            ProcessedItem(
                id = item.id,
                formattedPrice = formatPrice(item.price),
                displayName = item.name.uppercase(),
                // ...
            )
        }
    }
    
    LazyColumn {
        items(processedItems) { item -&gt;
            ItemRow(item)  // ç›´æ¥ä½¿ç”¨å¤„ç†åçš„æ•°æ®
        }
    }
}
        </code></pre></div>
        <h3 id="iii-å›¾ç‰‡åŠ è½½ä¼˜åŒ–">III. å›¾ç‰‡åŠ è½½ä¼˜åŒ–</h3>
        <p>å›¾ç‰‡æ˜¯åˆ—è¡¨æ€§èƒ½çš„å…³é”®ç“¶é¢ˆï¼Œéœ€è¦ç‰¹åˆ«ä¼˜åŒ–ã€‚</p>
        <h4>3.1 ä½¿ç”¨ Coil æˆ– Glide è¿›è¡Œå¼‚æ­¥åŠ è½½</h4>
        <div class="code-good"><pre><code>
        // âœ… ä½¿ç”¨ Coil å¼‚æ­¥åŠ è½½
@Composable
fun ItemRow(item: Item) {
    Row {
        AsyncImage(
            model = ImageRequest.Builder(LocalContext.current)
                .data(item.imageUrl)
                .crossfade(true)
                .placeholder(R.drawable.placeholder)
                .error(R.drawable.error)
                .build(),
            contentDescription = null,
            modifier = Modifier.size(64.dp),
            contentScale = ContentScale.Crop
        )
        Text(item.title)
    }
}

// âœ… ä½¿ç”¨è‡ªå®šä¹‰ Modifier ä¼˜åŒ–
@Composable
fun OptimizedImage(
    url: String,
    modifier: Modifier = Modifier
) {
    AsyncImage(
        model = ImageRequest.Builder(LocalContext.current)
            .data(url)
            .size(Size.ORIGINAL)
            .memoryCachePolicy(CachePolicy.ENABLED)
            .diskCachePolicy(CachePolicy.ENABLED)
            .build(),
        contentDescription = null,
        modifier = modifier,
        contentScale = ContentScale.Crop
    )
}
        </code></pre></div>
        <h4>3.2 å›¾ç‰‡å°ºå¯¸ä¼˜åŒ–</h4>
        <p>åŠ è½½åˆé€‚å°ºå¯¸çš„å›¾ç‰‡å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ã€‚</p>
        <div class="code-good"><pre><code>
        // âœ… æ ¹æ®æ˜¾ç¤ºå°ºå¯¸åŠ è½½å›¾ç‰‡
@Composable
fun ItemRow(item: Item) {
    val density = LocalDensity.current
    val imageSize = with(density) { 64.dp.toPx().toInt() }
    
    AsyncImage(
        model = ImageRequest.Builder(LocalContext.current)
            .data(item.imageUrl)
            .size(imageSize)  // åªåŠ è½½éœ€è¦çš„å°ºå¯¸
            .build(),
        contentDescription = null,
        modifier = Modifier.size(64.dp)
    )
}
        </code></pre></div>
        <h4>3.3 ä½¿ç”¨å ä½ç¬¦å’Œè¿‡æ¸¡åŠ¨ç”»</h4>
        <div class="code-good"><pre><code>
        // âœ… ä½¿ç”¨å ä½ç¬¦å’Œè¿‡æ¸¡
@Composable
fun ItemRow(item: Item) {
    var imageState by remember { mutableStateOf&lt;ImageLoadState&gt;(ImageLoadState.Loading) }
    
    Box {
        when (imageState) {
            is ImageLoadState.Loading -&gt; {
                Box(
                    modifier = Modifier
                        .size(64.dp)
                        .background(Color.Gray.copy(alpha = 0.3f))
                ) {
                    CircularProgressIndicator(modifier = Modifier.align(Alignment.Center))
                }
            }
            is ImageLoadState.Success -&gt; {
                AsyncImage(
                    model = item.imageUrl,
                    contentDescription = null,
                    modifier = Modifier.size(64.dp)
                )
            }
            is ImageLoadState.Error -&gt; {
                Icon(
                    imageVector = Icons.Default.Error,
                    contentDescription = null,
                    modifier = Modifier.size(64.dp)
                )
            }
        }
    }
}
        </code></pre></div>
        <h3 id="iv-åŠ¨æ€å†…å®¹ä¼˜åŒ–">IV. åŠ¨æ€å†…å®¹ä¼˜åŒ–</h3>
        <p>åŠ¨æ€å†…å®¹çš„åˆ—è¡¨éœ€è¦ç‰¹åˆ«å¤„ç†ã€‚</p>
        <h4>4.1 ä½¿ç”¨ itemContentType ä¼˜åŒ–</h4>
        <p><code>itemContentType</code> å¯ä»¥å¸®åŠ© Compose æ›´å¥½åœ°è¯†åˆ«åˆ—è¡¨é¡¹ç±»å‹ã€‚</p>
        <div class="code-good"><pre><code>
        // âœ… ä½¿ç”¨ itemContentType
@Composable
fun ItemList(items: List&lt;Item&gt;) {
    LazyColumn {
        items(
            items = items,
            key = { it.id },
            contentType = { it.type }  // å¸®åŠ© Compose è¯†åˆ«ç±»å‹
        ) { item -&gt;
            when (item.type) {
                ItemType.TEXT -&gt; TextItemRow(item)
                ItemType.IMAGE -&gt; ImageItemRow(item)
                ItemType.VIDEO -&gt; VideoItemRow(item)
            }
        }
    }
}
        </code></pre></div>
        <h4>4.2 å¤„ç†åŠ¨æ€é«˜åº¦</h4>
        <div class="code-good"><pre><code>
        // âœ… å¤„ç†åŠ¨æ€é«˜åº¦å†…å®¹
@Composable
fun DynamicHeightItemRow(item: Item) {
    Column(
        modifier = Modifier
            .fillMaxWidth()
            .animateItemPlacement()  // å¹³æ»‘è¿‡æ¸¡
    ) {
        Text(item.title)
        if (item.isExpanded) {
            Text(
                text = item.content,
                modifier = Modifier.animateContentSize()  // é«˜åº¦åŠ¨ç”»
            )
        }
    }
}
        </code></pre></div>
        <h4>4.3 ä½¿ç”¨ itemKey å’Œ itemContentType ç»„åˆ</h4>
        <div class="code-good"><pre><code>
        // âœ… ç»„åˆä½¿ç”¨ key å’Œ contentType
@Composable
fun MixedItemList(items: List&lt;Item&gt;) {
    LazyColumn {
        items(
            items = items,
            key = { "${it.type}-${it.id}" },
            contentType = { it.type }
        ) { item -&gt;
            when (item.type) {
                ItemType.HEADER -&gt; HeaderRow(item)
                ItemType.ITEM -&gt; ItemRow(item)
                ItemType.FOOTER -&gt; FooterRow(item)
            }
        }
    }
}
        </code></pre></div>
        <h3 id="v-å¤šç±»å‹åˆ—è¡¨ä¼˜åŒ–">V. å¤šç±»å‹åˆ—è¡¨ä¼˜åŒ–</h3>
        <p>å¤šç±»å‹åˆ—è¡¨æ˜¯å®é™…é¡¹ç›®ä¸­çš„å¸¸è§éœ€æ±‚ã€‚</p>
        <h4>5.1 ä½¿ç”¨ LazyListScope æ„å»ºå¤šç±»å‹åˆ—è¡¨</h4>
        <div class="code-good"><pre><code>
        // âœ… ä½¿ç”¨ LazyListScope æ„å»ºå¤šç±»å‹åˆ—è¡¨
@Composable
fun MultiTypeList(
    header: String,
    items: List&lt;Item&gt;,
    footer: String
) {
    LazyColumn {
        // Header
        item(key = "header") {
            HeaderRow(text = header)
        }
        
        // Items
        items(
            items = items,
            key = { it.id }
        ) { item -&gt;
            ItemRow(item)
        }
        
        // Footer
        item(key = "footer") {
            FooterRow(text = footer)
        }
    }
}
        </code></pre></div>
        <h4>5.2 åˆ†ç»„åˆ—è¡¨ä¼˜åŒ–</h4>
        <div class="code-good"><pre><code>
        // âœ… åˆ†ç»„åˆ—è¡¨ä¼˜åŒ–
@Composable
fun GroupedItemList(groups: List&lt;ItemGroup&gt;) {
    LazyColumn {
        groups.forEach { group -&gt;
            // Group Header
            item(key = "group-${group.id}") {
                GroupHeaderRow(group.title)
            }
            
            // Group Items
            items(
                items = group.items,
                key = { "${group.id}-${it.id}" }
            ) { item -&gt;
                ItemRow(item)
            }
        }
    }
}
        </code></pre></div>
        <h4>5.3 ä½¿ç”¨ StickyHeader ä¼˜åŒ–åˆ†ç»„åˆ—è¡¨</h4>
        <div class="code-good"><pre><code>
        // âœ… ä½¿ç”¨ stickyHeader å®ç°ç²˜æ€§å¤´éƒ¨
@Composable
fun StickyGroupedList(groups: List&lt;ItemGroup&gt;) {
    LazyColumn {
        groups.forEach { group -&gt;
            stickyHeader(key = "header-${group.id}") {
                GroupHeaderRow(group.title)
            }
            
            items(
                items = group.items,
                key = { "${group.id}-${it.id}" }
            ) { item -&gt;
                ItemRow(item)
            }
        }
    }
}
        </code></pre></div>
        <h3 id="vi-ç½‘æ ¼åˆ—è¡¨ä¼˜åŒ–">VI. ç½‘æ ¼åˆ—è¡¨ä¼˜åŒ–</h3>
        <p>ç½‘æ ¼åˆ—è¡¨éœ€è¦ç‰¹æ®Šçš„ä¼˜åŒ–æŠ€å·§ã€‚</p>
        <h4>6.1 ä½¿ç”¨ LazyVerticalGrid</h4>
        <div class="code-good"><pre><code>
        // âœ… ä½¿ç”¨ LazyVerticalGrid
@Composable
fun GridItemList(items: List&lt;Item&gt;) {
    LazyVerticalGrid(
        columns = GridCells.Fixed(2),
        contentPadding = PaddingValues(16.dp),
        horizontalArrangement = Arrangement.spacedBy(16.dp),
        verticalArrangement = Arrangement.spacedBy(16.dp)
    ) {
        items(
            items = items,
            key = { it.id }
        ) { item -&gt;
            GridItemCard(item)
        }
    }
}

// âœ… å“åº”å¼ç½‘æ ¼
@Composable
fun ResponsiveGridList(items: List&lt;Item&gt;) {
    val configuration = LocalConfiguration.current
    val screenWidth = configuration.screenWidthDp
    
    val columns = when {
        screenWidth &gt; 1200 -&gt; 4
        screenWidth &gt; 800 -&gt; 3
        screenWidth &gt; 600 -&gt; 2
        else -&gt; 1
    }
    
    LazyVerticalGrid(
        columns = GridCells.Fixed(columns),
        contentPadding = PaddingValues(16.dp),
        horizontalArrangement = Arrangement.spacedBy(16.dp),
        verticalArrangement = Arrangement.spacedBy(16.dp)
    ) {
        items(items, key = { it.id }) { item -&gt;
            GridItemCard(item)
        }
    }
}
        </code></pre></div>
        <h4>6.2 ç½‘æ ¼é¡¹ä¼˜åŒ–</h4>
        <div class="code-good"><pre><code>
        // âœ… ä¼˜åŒ–ç½‘æ ¼é¡¹å¸ƒå±€
@Composable
fun GridItemCard(item: Item) {
    Card(
        modifier = Modifier
            .fillMaxWidth()
            .aspectRatio(0.75f)  // å›ºå®šå®½é«˜æ¯”
    ) {
        Column {
            AsyncImage(
                model = item.imageUrl,
                contentDescription = null,
                modifier = Modifier
                    .fillMaxWidth()
                    .weight(1f),
                contentScale = ContentScale.Crop
            )
            Column(
                modifier = Modifier.padding(8.dp)
            ) {
                Text(
                    text = item.title,
                    maxLines = 2,
                    overflow = TextOverflow.Ellipsis
                )
                Text(
                    text = item.price,
                    style = MaterialTheme.typography.bodyMedium
                )
            }
        }
    }
}
        </code></pre></div>
        <h3 id="vii-åµŒå¥—åˆ—è¡¨ä¼˜åŒ–">VII. åµŒå¥—åˆ—è¡¨ä¼˜åŒ–</h3>
        <p>åµŒå¥—åˆ—è¡¨éœ€è¦ç‰¹åˆ«æ³¨æ„æ€§èƒ½ã€‚</p>
        <h4>7.1 é¿å…æ·±å±‚åµŒå¥— LazyColumn</h4>
        <div class="code-bad"><pre><code>
        // âŒ é”™è¯¯ï¼šæ·±å±‚åµŒå¥— LazyColumn
@Composable
fun NestedListProblem() {
    LazyColumn {
        items(10) { section -&gt;
            LazyColumn {  // åµŒå¥—çš„ LazyColumn
                items(100) { item -&gt;
                    ItemRow(item)
                }
            }
        }
    }
}

// âœ… æ­£ç¡®ï¼šæ‰å¹³åŒ–åˆ—è¡¨
@Composable
fun FlattenedList(sections: List&lt;Section&gt;) {
    LazyColumn {
        sections.forEach { section -&gt;
            item(key = "section-${section.id}") {
                SectionHeader(section.title)
            }
            items(
                items = section.items,
                key = { "${section.id}-${it.id}" }
            ) { item -&gt;
                ItemRow(item)
            }
        }
    }
}
        </code></pre></div>
        <h4>7.2 ä½¿ç”¨ LazyRow åµŒå¥—</h4>
        <div class="code-good"><pre><code>
        // âœ… æ°´å¹³æ»šåŠ¨çš„åµŒå¥—åˆ—è¡¨
@Composable
fun HorizontalNestedList(sections: List&lt;Section&gt;) {
    LazyColumn {
        items(sections, key = { it.id }) { section -&gt;
            Column {
                Text(
                    text = section.title,
                    style = MaterialTheme.typography.h6
                )
                LazyRow(
                    horizontalArrangement = Arrangement.spacedBy(8.dp)
                ) {
                    items(
                        items = section.items,
                        key = { it.id }
                    ) { item -&gt;
                        HorizontalItemCard(item)
                    }
                }
            }
        }
    }
}
        </code></pre></div>
        <h3 id="viii-é«˜çº§ä¼˜åŒ–æŠ€å·§">VIII. é«˜çº§ä¼˜åŒ–æŠ€å·§</h3>
        <h4>8.1 ä½¿ç”¨ rememberLazyListState ä¼˜åŒ–æ»šåŠ¨</h4>
        <div class="code-good"><pre><code>
        // âœ… ä½¿ç”¨ rememberLazyListState ä¼˜åŒ–æ»šåŠ¨
@Composable
fun OptimizedScrollableList(items: List&lt;Item&gt;) {
    val listState = rememberLazyListState()
    
    // åªåœ¨å¯è§é¡¹å˜åŒ–æ—¶æ›´æ–°
    val visibleItems = remember {
        derivedStateOf {
            val layoutInfo = listState.layoutInfo
            layoutInfo.visibleItemsInfo.map { it.index }
        }
    }
    
    LazyColumn(
        state = listState,
        items = items,
        key = { it.id }
    ) { item -&gt;
        ItemRow(item)
    }
}
        </code></pre></div>
        <h4>8.2 é¢„åŠ è½½ä¼˜åŒ–</h4>
        <div class="code-good"><pre><code>
        // âœ… é¢„åŠ è½½ä¼˜åŒ–
@Composable
fun PreloadList(items: List&lt;Item&gt;) {
    val listState = rememberLazyListState()
    
    LaunchedEffect(listState) {
        snapshotFlow { listState.layoutInfo.visibleItemsInfo }
            .collect { visibleItems -&gt;
                val lastVisibleIndex = visibleItems.lastOrNull()?.index ?: 0
                // é¢„åŠ è½½æ¥ä¸‹æ¥çš„ 5 é¡¹
                if (lastVisibleIndex &gt;= items.size - 5) {
                    // è§¦å‘åŠ è½½æ›´å¤š
                }
            }
    }
    
    LazyColumn(state = listState) {
        items(items, key = { it.id }) { item -&gt;
            ItemRow(item)
        }
    }
}
        </code></pre></div>
        <h4>8.3 ä½¿ç”¨ derivedStateOf ä¼˜åŒ–æ´¾ç”ŸçŠ¶æ€</h4>
        <div class="code-good"><pre><code>
        // âœ… ä½¿ç”¨ derivedStateOf ä¼˜åŒ–æ´¾ç”ŸçŠ¶æ€
@Composable
fun FilteredList(allItems: List&lt;Item&gt;, filter: String) {
    val filteredItems by remember(allItems, filter) {
        derivedStateOf {
            allItems.filter { it.title.contains(filter, ignoreCase = true) }
        }
    }
    
    LazyColumn {
        items(filteredItems, key = { it.id }) { item -&gt;
            ItemRow(item)
        }
    }
}
        </code></pre></div>
        <h4>8.4 ä½¿ç”¨ Modifier.onSizeChanged ä¼˜åŒ–</h4>
        <div class="code-good"><pre><code>
        // âœ… ä½¿ç”¨ onSizeChanged ä¼˜åŒ–å¸ƒå±€
@Composable
fun ResponsiveItemRow(item: Item) {
    var itemWidth by remember { mutableIntStateOf(0) }
    
    Row(
        modifier = Modifier
            .fillMaxWidth()
            .onSizeChanged { size -&gt;
                itemWidth = size.width
            }
    ) {
        if (itemWidth &gt; 600) {
            // å®½å±å¸ƒå±€
            WideLayout(item)
        } else {
            // çª„å±å¸ƒå±€
            NarrowLayout(item)
        }
    }
}
        </code></pre></div>
        <h4>8.5 æ€§èƒ½ç›‘æ§</h4>
        <div class="code-good"><pre><code>
        // âœ… æ€§èƒ½ç›‘æ§
@Composable
fun MonitoredItemList(items: List&lt;Item&gt;) {
    val listState = rememberLazyListState()
    
    LaunchedEffect(listState) {
        snapshotFlow { listState.layoutInfo }
            .collect { layoutInfo -&gt;
                val averageItemSize = layoutInfo.visibleItemsInfo
                    .map { it.size }
                    .average()
                
                Log.d("ListPerformance", "Average item size: $averageItemSize")
                Log.d("ListPerformance", "Visible items: ${layoutInfo.visibleItemsInfo.size}")
            }
    }
    
    LazyColumn(state = listState) {
        items(items, key = { it.id }) { item -&gt;
            ItemRow(item)
        }
    }
}
        </code></pre></div>
        <h3 id="æ€»ç»“">æ€»ç»“</h3>
        <p>å¤æ‚åˆ—è¡¨ä¼˜åŒ–çš„æ ¸å¿ƒåŸåˆ™ï¼š</p>
        <ul>
        <li>âœ… <strong>æ­£ç¡®ä½¿ç”¨ key</strong>ï¼šç¡®ä¿åˆ—è¡¨é¡¹èº«ä»½è¯†åˆ«</li>
        <li>âœ… <strong>çŠ¶æ€æå‡</strong>ï¼šé¿å…åœ¨åˆ—è¡¨é¡¹ä¸­åˆ›å»ºçŠ¶æ€</li>
        <li>âœ… <strong>é¢„è®¡ç®—æ•°æ®</strong>ï¼šåœ¨åˆ—è¡¨å¤–å¤„ç†æ•°æ®</li>
        <li>âœ… <strong>å›¾ç‰‡ä¼˜åŒ–</strong>ï¼šä½¿ç”¨å¼‚æ­¥åŠ è½½å’Œç¼“å­˜</li>
        <li>âœ… <strong>å¸ƒå±€ä¼˜åŒ–</strong>ï¼šé¿å…æ·±å±‚åµŒå¥—ï¼Œä½¿ç”¨ ConstraintLayout</li>
        <li>âœ… <strong>ç±»å‹è¯†åˆ«</strong>ï¼šä½¿ç”¨ itemContentType å¸®åŠ© Compose</li>
        <li>âœ… <strong>é¿å…åµŒå¥—</strong>ï¼šæ‰å¹³åŒ–åˆ—è¡¨ç»“æ„</li>
        <li>âœ… <strong>æ€§èƒ½ç›‘æ§</strong>ï¼šä½¿ç”¨å·¥å…·ç›‘æ§æ€§èƒ½</li>
        </ul>
        <p>æŒæ¡è¿™äº›æŠ€å·§ï¼Œå¯ä»¥æ„å»ºæµç•…ã€é«˜æ•ˆçš„å¤æ‚åˆ—è¡¨ç•Œé¢ã€‚</p>
        <p>---</p>
        <h3 id="æ¨èé˜…è¯»">æ¨èé˜…è¯»</h3>
        <ul>
        <li><a href="https://developer.android.com/jetpack/compose/lists" target="_blank">Lists in Compose - Android Developers</a></li>
        <li><a href="https://developer.android.com/jetpack/compose/performance" target="_blank">Performance best practices - Android Developers</a></li>
        <li><a href="https://developer.android.com/jetpack/compose/lists#lazy" target="_blank">LazyColumn and LazyRow - Android Developers</a></li>
        </ul>
        <div class="reference">
            <div class="reference-title">ğŸ“š å®˜æ–¹å‚è€ƒ</div>
            <a href="https://developer.android.com/jetpack/compose/lists" target="_blank">Lists in Compose - Android Developers</a><br>
            <a href="https://developer.android.com/jetpack/compose/performance" target="_blank">Performance best practices - Android Developers</a><br>
            <a href="https://developer.android.com/jetpack/compose/lists#lazy" target="_blank">LazyColumn and LazyRow - Android Developers</a>
        </div>
    </article>

    <footer class="footer">
        <p>&copy; 2024 Fidroid. <a href="../index.html">è¿”å›é¦–é¡µ</a></p>
    </footer>
</body>
</html>
