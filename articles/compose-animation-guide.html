<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compose åŠ¨ç”»å®Œå…¨æŒ‡å—ï¼šä»å…¥é—¨åˆ°ç²¾é€š - Fidroid</title>
    <meta name="description" content="ç³»ç»Ÿå­¦ä¹  Jetpack Compose åŠ¨ç”» APIï¼ŒæŒæ¡ animateXxxAsStateã€AnimatedVisibilityã€Transition ç­‰æ ¸å¿ƒæ¦‚å¿µï¼Œæ‰“é€ æµç•…çš„ç”¨æˆ·ä½“éªŒã€‚">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.8;
            color: #e5e7eb;
            background: #020617;
        }
        .navbar {
            background: rgba(15,23,42,0.98);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 4px rgba(15,23,42,0.6);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }
        .nav-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 1rem 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #38bdf8;
            text-decoration: none;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }
        .back-link {
            color: #9ca3af;
            text-decoration: none;
            font-size: 0.9rem;
        }
        .back-link:hover { color: #38bdf8; }

        .article-header {
            padding: 120px 20px 60px;
            background: radial-gradient(circle at top left, #f97316 0, transparent 50%),
                        radial-gradient(circle at bottom right, #38bdf8 0, transparent 55%),
                        #020617;
            text-align: center;
        }
        .article-header h1 {
            max-width: 800px;
            margin: 0 auto 1rem;
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -0.03em;
            color: #fff;
        }
        .article-meta {
            color: #9ca3af;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }
        .article-tags {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .article-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            background: rgba(15,23,42,0.85);
            border: 1px solid rgba(249,115,22,0.4);
            color: #fdba74;
        }

        .article-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 60px 20px 80px;
        }
        .article-content h2 {
            font-size: 1.6rem;
            margin: 2.5rem 0 1rem;
            color: #f9fafb;
            border-left: 4px solid #f97316;
            padding-left: 1rem;
        }
        .article-content h3 {
            font-size: 1.25rem;
            margin: 2rem 0 0.75rem;
            color: #e5e7eb;
        }
        .article-content p {
            margin-bottom: 1.25rem;
            color: #d1d5db;
        }
        .article-content ul, .article-content ol {
            margin: 1rem 0 1.5rem 1.5rem;
            color: #d1d5db;
        }
        .article-content li { margin-bottom: 0.5rem; }
        .article-content strong { color: #f9fafb; }
        .article-content a {
            color: #38bdf8;
            text-decoration: underline;
        }

        pre {
            background: #0f172a;
            border: 1px solid rgba(249,115,22,0.3);
            border-radius: 12px;
            padding: 1.25rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-size: 0.85rem;
            line-height: 1.6;
        }
        code {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            color: #e5e7eb;
        }
        .code-keyword { color: #c084fc; }
        .code-func { color: #38bdf8; }
        .code-type { color: #4ade80; }
        .code-string { color: #fb7185; }
        .code-comment { color: #6b7280; font-style: italic; }
        .code-number { color: #fbbf24; }

        .callout {
            background: rgba(249,115,22,0.1);
            border: 1px solid rgba(249,115,22,0.3);
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
            margin: 1.5rem 0;
        }
        .callout-title {
            font-weight: 600;
            color: #fdba74;
            margin-bottom: 0.5rem;
        }
        .callout p { margin-bottom: 0; color: #d1d5db; }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            font-size: 0.9rem;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid rgba(148,163,184,0.3);
            padding: 0.75rem 1rem;
            text-align: left;
        }
        .comparison-table th {
            background: rgba(15,23,42,0.8);
            color: #f9fafb;
        }
        .comparison-table td { color: #d1d5db; }

        .footer {
            background: #020617;
            border-top: 1px solid #111827;
            padding: 2rem;
            text-align: center;
            color: #6b7280;
        }
        .footer a { color: #38bdf8; text-decoration: none; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="logo">Fidroid</a>
            <a href="../index.html#blog" class="back-link">â† è¿”å›åšå®¢åˆ—è¡¨</a>
        </div>
    </nav>

    <header class="article-header">
        <h1>Compose åŠ¨ç”»å®Œå…¨æŒ‡å—ï¼šä»å…¥é—¨åˆ°ç²¾é€š</h1>
        <p class="article-meta">2024-03-28 Â· 20 min Â· åŠ¨ç”»ä¸äº¤äº’</p>
        <div class="article-tags">
            <span class="article-tag">Animation</span>
            <span class="article-tag">AnimatedVisibility</span>
            <span class="article-tag">Transition</span>
            <span class="article-tag">æ‰‹åŠ¿åŠ¨ç”»</span>
        </div>
    </header>

    <article class="article-content">
        <p>åŠ¨ç”»æ˜¯æå‡ç”¨æˆ·ä½“éªŒçš„å…³é”®è¦ç´ ã€‚Jetpack Compose æä¾›äº†ä¸€å¥—å£°æ˜å¼ã€æ˜“äºç»„åˆçš„åŠ¨ç”» APIï¼Œè®©å¼€å‘è€…å¯ä»¥ç”¨æ›´å°‘çš„ä»£ç å®ç°æµç•…ã€è‡ªç„¶çš„åŠ¨ç”»æ•ˆæœã€‚æœ¬æ–‡å°†ç³»ç»Ÿä»‹ç» Compose åŠ¨ç”»çš„æ ¸å¿ƒæ¦‚å¿µä¸å®æˆ˜æŠ€å·§ã€‚</p>

        <h2>ä¸€ã€Compose åŠ¨ç”» API æ¦‚è§ˆ</h2>
        <p>Compose çš„åŠ¨ç”»ç³»ç»Ÿåˆ†ä¸ºå¤šä¸ªå±‚çº§ï¼Œä»é«˜å±‚å°è£…åˆ°åº•å±‚æ§åˆ¶ï¼š</p>

        <table class="comparison-table">
            <thead>
                <tr>
                    <th>API å±‚çº§</th>
                    <th>å…¸å‹ API</th>
                    <th>é€‚ç”¨åœºæ™¯</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>é«˜å±‚åŠ¨ç”»</strong></td>
                    <td>AnimatedVisibility, AnimatedContent, Crossfade</td>
                    <td>å…ƒç´ å‡ºç°/æ¶ˆå¤±ã€å†…å®¹åˆ‡æ¢</td>
                </tr>
                <tr>
                    <td><strong>çŠ¶æ€é©±åŠ¨åŠ¨ç”»</strong></td>
                    <td>animateXxxAsState (animateFloatAsState, animateColorAsState...)</td>
                    <td>å•ä¸ªå±æ€§éšçŠ¶æ€å˜åŒ–</td>
                </tr>
                <tr>
                    <td><strong>Transition</strong></td>
                    <td>updateTransition, rememberInfiniteTransition</td>
                    <td>å¤šå±æ€§åè°ƒåŠ¨ç”»ã€å¾ªç¯åŠ¨ç”»</td>
                </tr>
                <tr>
                    <td><strong>åº•å±‚æ§åˆ¶</strong></td>
                    <td>Animatable, animate()</td>
                    <td>æ‰‹åŠ¿é©±åŠ¨ã€ç²¾ç»†æ§åˆ¶</td>
                </tr>
            </tbody>
        </table>

        <h2>äºŒã€animateXxxAsStateï¼šæœ€ç®€å•çš„åŠ¨ç”»å…¥å£</h2>
        <p>å½“ä½ åªéœ€è¦è®©æŸä¸ªå±æ€§ï¼ˆå¦‚é€æ˜åº¦ã€å¤§å°ã€é¢œè‰²ï¼‰éšçŠ¶æ€å˜åŒ–æ—¶å¹³æ»‘è¿‡æ¸¡ï¼Œ<code>animateXxxAsState</code> æ˜¯æœ€ç®€æ´çš„é€‰æ‹©ã€‚</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">ExpandableCard</span>(expanded: <span class="code-type">Boolean</span>) {
    <span class="code-comment">// é«˜åº¦éš expanded çŠ¶æ€å¹³æ»‘å˜åŒ–</span>
    <span class="code-keyword">val</span> height <span class="code-keyword">by</span> <span class="code-func">animateDpAsState</span>(
        targetValue = <span class="code-keyword">if</span> (expanded) <span class="code-number">200</span>.dp <span class="code-keyword">else</span> <span class="code-number">80</span>.dp,
        animationSpec = <span class="code-func">tween</span>(durationMillis = <span class="code-number">300</span>)
    )

    <span class="code-comment">// èƒŒæ™¯è‰²éšçŠ¶æ€å˜åŒ–</span>
    <span class="code-keyword">val</span> backgroundColor <span class="code-keyword">by</span> <span class="code-func">animateColorAsState</span>(
        targetValue = <span class="code-keyword">if</span> (expanded) Color.Blue <span class="code-keyword">else</span> Color.Gray
    )

    <span class="code-func">Box</span>(
        modifier = <span class="code-type">Modifier</span>
            .<span class="code-func">fillMaxWidth</span>()
            .<span class="code-func">height</span>(height)
            .<span class="code-func">background</span>(backgroundColor)
    )
}</code></pre>

        <div class="callout">
            <p class="callout-title">ğŸ’¡ animationSpec å‚æ•°</p>
            <p>ä½ å¯ä»¥é€šè¿‡ <code>animationSpec</code> è‡ªå®šä¹‰åŠ¨ç”»æ›²çº¿ï¼š<code>tween()</code> æŒ‡å®šæ—¶é•¿å’Œç¼“åŠ¨å‡½æ•°ï¼Œ<code>spring()</code> å®ç°å¼¹ç°§æ•ˆæœï¼Œ<code>keyframes {}</code> å®šä¹‰å…³é”®å¸§åŠ¨ç”»ã€‚</p>
        </div>

        <h2>ä¸‰ã€AnimatedVisibilityï¼šä¼˜é›…å¤„ç†å…ƒç´ å‡ºç°ä¸æ¶ˆå¤±</h2>
        <p>ä¼ ç»Ÿ View ç³»ç»Ÿä¸­ï¼Œè®©å…ƒç´ å¸¦åŠ¨ç”»åœ°å‡ºç°/æ¶ˆå¤±éœ€è¦æ‰‹åŠ¨ç®¡ç† alphaã€scale ç­‰å±æ€§ã€‚Compose çš„ <code>AnimatedVisibility</code> æŠŠè¿™ä¸€åˆ‡å°è£…å¥½äº†ï¼š</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">NotificationBanner</span>(visible: <span class="code-type">Boolean</span>, message: <span class="code-type">String</span>) {
    <span class="code-func">AnimatedVisibility</span>(
        visible = visible,
        enter = <span class="code-func">fadeIn</span>() + <span class="code-func">slideInVertically</span> { -it },
        exit = <span class="code-func">fadeOut</span>() + <span class="code-func">slideOutVertically</span> { -it }
    ) {
        <span class="code-func">Surface</span>(
            color = MaterialTheme.colorScheme.primaryContainer,
            modifier = <span class="code-type">Modifier</span>.<span class="code-func">fillMaxWidth</span>().<span class="code-func">padding</span>(<span class="code-number">16</span>.dp)
        ) {
            <span class="code-func">Text</span>(message)
        }
    }
}</code></pre>

        <h3>ç»„åˆå¤šç§è¿›å…¥/é€€å‡ºæ•ˆæœ</h3>
        <p>Compose æä¾›äº†å¤šç§ <code>EnterTransition</code> å’Œ <code>ExitTransition</code>ï¼Œå¯ä»¥ç”¨ <code>+</code> è¿ç®—ç¬¦ç»„åˆï¼š</p>
        <ul>
            <li><strong>fadeIn() / fadeOut()</strong> - é€æ˜åº¦æ¸å˜</li>
            <li><strong>slideInHorizontally() / slideOutHorizontally()</strong> - æ°´å¹³æ»‘åŠ¨</li>
            <li><strong>slideInVertically() / slideOutVertically()</strong> - å‚ç›´æ»‘åŠ¨</li>
            <li><strong>scaleIn() / scaleOut()</strong> - ç¼©æ”¾</li>
            <li><strong>expandIn() / shrinkOut()</strong> - å°ºå¯¸å±•å¼€/æ”¶ç¼©</li>
        </ul>

        <h2>å››ã€AnimatedContentï¼šå†…å®¹åˆ‡æ¢åŠ¨ç”»</h2>
        <p>å½“ UI å†…å®¹æœ¬èº«å‘ç”Ÿå˜åŒ–ï¼ˆè€Œä¸ä»…ä»…æ˜¯æ˜¾ç¤º/éšè—ï¼‰æ—¶ï¼Œ<code>AnimatedContent</code> å¯ä»¥åœ¨æ–°æ—§å†…å®¹ä¹‹é—´æ·»åŠ è¿‡æ¸¡åŠ¨ç”»ï¼š</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">CounterDisplay</span>(count: <span class="code-type">Int</span>) {
    <span class="code-func">AnimatedContent</span>(
        targetState = count,
        transitionSpec = {
            <span class="code-comment">// æ–°å†…å®¹ä»ä¸‹æ–¹æ»‘å…¥ï¼Œæ—§å†…å®¹å‘ä¸Šæ»‘å‡º</span>
            <span class="code-keyword">if</span> (targetState > initialState) {
                <span class="code-func">slideInVertically</span> { it } + <span class="code-func">fadeIn</span>() togetherWith
                    <span class="code-func">slideOutVertically</span> { -it } + <span class="code-func">fadeOut</span>()
            } <span class="code-keyword">else</span> {
                <span class="code-func">slideInVertically</span> { -it } + <span class="code-func">fadeIn</span>() togetherWith
                    <span class="code-func">slideOutVertically</span> { it } + <span class="code-func">fadeOut</span>()
            }
        }
    ) { targetCount ->
        <span class="code-func">Text</span>(
            text = <span class="code-string">"$targetCount"</span>,
            style = MaterialTheme.typography.displayLarge
        )
    }
}</code></pre>

        <h2>äº”ã€updateTransitionï¼šå¤šå±æ€§åè°ƒåŠ¨ç”»</h2>
        <p>å½“å¤šä¸ªå±æ€§éœ€è¦æ ¹æ®åŒä¸€ä¸ªçŠ¶æ€åè°ƒå˜åŒ–æ—¶ï¼Œ<code>updateTransition</code> æ¯”å¤šä¸ªç‹¬ç«‹çš„ <code>animateXxxAsState</code> æ›´é«˜æ•ˆã€æ›´æ˜“ç»´æŠ¤ï¼š</p>

<pre><code><span class="code-keyword">enum class</span> <span class="code-type">CardState</span> { Collapsed, Expanded }

<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">AnimatedCard</span>(state: <span class="code-type">CardState</span>) {
    <span class="code-keyword">val</span> transition = <span class="code-func">updateTransition</span>(targetState = state, label = <span class="code-string">"card"</span>)

    <span class="code-keyword">val</span> height <span class="code-keyword">by</span> transition.<span class="code-func">animateDp</span>(label = <span class="code-string">"height"</span>) { s ->
        <span class="code-keyword">when</span> (s) {
            CardState.Collapsed -> <span class="code-number">80</span>.dp
            CardState.Expanded -> <span class="code-number">200</span>.dp
        }
    }

    <span class="code-keyword">val</span> cornerRadius <span class="code-keyword">by</span> transition.<span class="code-func">animateDp</span>(label = <span class="code-string">"corner"</span>) { s ->
        <span class="code-keyword">when</span> (s) {
            CardState.Collapsed -> <span class="code-number">16</span>.dp
            CardState.Expanded -> <span class="code-number">8</span>.dp
        }
    }

    <span class="code-keyword">val</span> elevation <span class="code-keyword">by</span> transition.<span class="code-func">animateDp</span>(label = <span class="code-string">"elevation"</span>) { s ->
        <span class="code-keyword">when</span> (s) {
            CardState.Collapsed -> <span class="code-number">2</span>.dp
            CardState.Expanded -> <span class="code-number">8</span>.dp
        }
    }

    <span class="code-func">Card</span>(
        modifier = <span class="code-type">Modifier</span>.<span class="code-func">fillMaxWidth</span>().<span class="code-func">height</span>(height),
        shape = <span class="code-func">RoundedCornerShape</span>(cornerRadius),
        elevation = <span class="code-func">CardDefaults</span>.<span class="code-func">cardElevation</span>(defaultElevation = elevation)
    ) {
        <span class="code-comment">// Card content...</span>
    }
}</code></pre>

        <h2>å…­ã€rememberInfiniteTransitionï¼šå¾ªç¯åŠ¨ç”»</h2>
        <p>éœ€è¦æŒç»­å¾ªç¯çš„åŠ¨ç”»ï¼ˆå¦‚åŠ è½½æŒ‡ç¤ºå™¨ã€å‘¼å¸ç¯æ•ˆæœï¼‰ï¼Œä½¿ç”¨ <code>rememberInfiniteTransition</code>ï¼š</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">PulsingDot</span>() {
    <span class="code-keyword">val</span> infiniteTransition = <span class="code-func">rememberInfiniteTransition</span>(label = <span class="code-string">"pulse"</span>)

    <span class="code-keyword">val</span> scale <span class="code-keyword">by</span> infiniteTransition.<span class="code-func">animateFloat</span>(
        initialValue = <span class="code-number">1f</span>,
        targetValue = <span class="code-number">1.3f</span>,
        animationSpec = <span class="code-func">infiniteRepeatable</span>(
            animation = <span class="code-func">tween</span>(<span class="code-number">600</span>, easing = FastOutSlowInEasing),
            repeatMode = RepeatMode.Reverse
        ),
        label = <span class="code-string">"scale"</span>
    )

    <span class="code-keyword">val</span> alpha <span class="code-keyword">by</span> infiniteTransition.<span class="code-func">animateFloat</span>(
        initialValue = <span class="code-number">1f</span>,
        targetValue = <span class="code-number">0.5f</span>,
        animationSpec = <span class="code-func">infiniteRepeatable</span>(
            animation = <span class="code-func">tween</span>(<span class="code-number">600</span>),
            repeatMode = RepeatMode.Reverse
        ),
        label = <span class="code-string">"alpha"</span>
    )

    <span class="code-func">Box</span>(
        modifier = <span class="code-type">Modifier</span>
            .<span class="code-func">size</span>(<span class="code-number">24</span>.dp)
            .<span class="code-func">scale</span>(scale)
            .<span class="code-func">alpha</span>(alpha)
            .<span class="code-func">background</span>(Color.Red, CircleShape)
    )
}</code></pre>

        <h2>ä¸ƒã€Animatableï¼šæ‰‹åŠ¿é©±åŠ¨ä¸ç²¾ç»†æ§åˆ¶</h2>
        <p>å½“ä½ éœ€è¦åœ¨åç¨‹ä¸­æ§åˆ¶åŠ¨ç”»ã€å“åº”æ‰‹åŠ¿æ‹–æ‹½æˆ–å®ç°å¤æ‚çš„åŠ¨ç”»åºåˆ—æ—¶ï¼Œ<code>Animatable</code> æä¾›äº†æœ€å¤§çš„çµæ´»æ€§ï¼š</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">SwipeToRefresh</span>(onRefresh: () -> <span class="code-type">Unit</span>) {
    <span class="code-keyword">val</span> offsetY = <span class="code-func">remember</span> { <span class="code-func">Animatable</span>(<span class="code-number">0f</span>) }
    <span class="code-keyword">val</span> coroutineScope = <span class="code-func">rememberCoroutineScope</span>()

    <span class="code-func">Box</span>(
        modifier = <span class="code-type">Modifier</span>
            .<span class="code-func">fillMaxSize</span>()
            .<span class="code-func">pointerInput</span>(Unit) {
                <span class="code-func">detectVerticalDragGestures</span>(
                    onDragEnd = {
                        coroutineScope.<span class="code-func">launch</span> {
                            <span class="code-keyword">if</span> (offsetY.value > <span class="code-number">100f</span>) {
                                <span class="code-func">onRefresh</span>()
                            }
                            <span class="code-comment">// å¼¹å›åŸä½</span>
                            offsetY.<span class="code-func">animateTo</span>(
                                targetValue = <span class="code-number">0f</span>,
                                animationSpec = <span class="code-func">spring</span>(
                                    dampingRatio = Spring.DampingRatioMediumBouncy,
                                    stiffness = Spring.StiffnessLow
                                )
                            )
                        }
                    },
                    onVerticalDrag = { change, dragAmount ->
                        coroutineScope.<span class="code-func">launch</span> {
                            <span class="code-keyword">val</span> newValue = (offsetY.value + dragAmount).<span class="code-func">coerceAtLeast</span>(<span class="code-number">0f</span>)
                            offsetY.<span class="code-func">snapTo</span>(newValue)
                        }
                    }
                )
            }
            .<span class="code-func">offset</span> { <span class="code-func">IntOffset</span>(<span class="code-number">0</span>, offsetY.value.<span class="code-func">roundToInt</span>()) }
    ) {
        <span class="code-comment">// Content...</span>
    }
}</code></pre>

        <h2>å…«ã€åŠ¨ç”»æ€§èƒ½ä¼˜åŒ–å»ºè®®</h2>

        <h3>1. ä¼˜å…ˆä½¿ç”¨ graphicsLayer</h3>
        <p>å¯¹äº alphaã€scaleã€rotationã€translation ç­‰å˜æ¢ï¼Œä½¿ç”¨ <code>Modifier.graphicsLayer</code> å¯ä»¥é¿å…è§¦å‘ recompositionï¼š</p>

<pre><code><span class="code-comment">// âœ… æ¨èï¼šä½¿ç”¨ graphicsLayerï¼Œåªå½±å“ç»˜åˆ¶é˜¶æ®µ</span>
<span class="code-func">Box</span>(
    modifier = <span class="code-type">Modifier</span>.<span class="code-func">graphicsLayer</span> {
        alpha = animatedAlpha
        scaleX = animatedScale
        scaleY = animatedScale
    }
)

<span class="code-comment">// âŒ é¿å…ï¼šç›´æ¥ä½¿ç”¨ Modifierï¼Œä¼šè§¦å‘ recomposition</span>
<span class="code-func">Box</span>(
    modifier = <span class="code-type">Modifier</span>
        .<span class="code-func">alpha</span>(animatedAlpha)
        .<span class="code-func">scale</span>(animatedScale)
)</code></pre>

        <h3>2. ä½¿ç”¨ label å‚æ•°</h3>
        <p>ä¸ºåŠ¨ç”»æ·»åŠ  <code>label</code> å‚æ•°ï¼Œæ–¹ä¾¿åœ¨ Layout Inspector å’Œ Compose Tracing ä¸­è°ƒè¯•ï¼š</p>

<pre><code><span class="code-keyword">val</span> alpha <span class="code-keyword">by</span> <span class="code-func">animateFloatAsState</span>(
    targetValue = <span class="code-keyword">if</span> (visible) <span class="code-number">1f</span> <span class="code-keyword">else</span> <span class="code-number">0f</span>,
    label = <span class="code-string">"cardAlpha"</span>  <span class="code-comment">// ä¾¿äºè°ƒè¯•è¿½è¸ª</span>
)</code></pre>

        <h3>3. é¿å…åœ¨åŠ¨ç”»ä¸­åˆ›å»ºæ–°å¯¹è±¡</h3>
        <p>åŠ¨ç”»å›è°ƒä¸­é¿å…åˆ›å»ºæ–°çš„ Offsetã€Size ç­‰å¯¹è±¡ï¼Œä½¿ç”¨ <code>remember</code> ç¼“å­˜ï¼š</p>

<pre><code><span class="code-comment">// âœ… æ¨è</span>
<span class="code-keyword">val</span> offset = <span class="code-func">remember</span>(animatedX, animatedY) {
    <span class="code-func">Offset</span>(animatedX, animatedY)
}

<span class="code-comment">// âŒ é¿å…ï¼šæ¯å¸§åˆ›å»ºæ–°å¯¹è±¡</span>
<span class="code-keyword">val</span> offset = <span class="code-func">Offset</span>(animatedX, animatedY)</code></pre>

        <h2>ä¹ã€å®æˆ˜æ¡ˆä¾‹ï¼šå¡ç‰‡å±•å¼€åŠ¨ç”»</h2>
        <p>ç»¼åˆè¿ç”¨ä¸Šè¿°æŠ€æœ¯ï¼Œå®ç°ä¸€ä¸ªç‚¹å‡»å±•å¼€çš„å¡ç‰‡åŠ¨ç”»ï¼š</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">ExpandableNewsCard</span>(
    title: <span class="code-type">String</span>,
    summary: <span class="code-type">String</span>,
    content: <span class="code-type">String</span>
) {
    <span class="code-keyword">var</span> expanded <span class="code-keyword">by</span> <span class="code-func">remember</span> { <span class="code-func">mutableStateOf</span>(<span class="code-keyword">false</span>) }
    <span class="code-keyword">val</span> transition = <span class="code-func">updateTransition</span>(expanded, label = <span class="code-string">"expand"</span>)

    <span class="code-keyword">val</span> cardPadding <span class="code-keyword">by</span> transition.<span class="code-func">animateDp</span>(label = <span class="code-string">"padding"</span>) {
        <span class="code-keyword">if</span> (it) <span class="code-number">24</span>.dp <span class="code-keyword">else</span> <span class="code-number">16</span>.dp
    }
    <span class="code-keyword">val</span> cardElevation <span class="code-keyword">by</span> transition.<span class="code-func">animateDp</span>(label = <span class="code-string">"elevation"</span>) {
        <span class="code-keyword">if</span> (it) <span class="code-number">12</span>.dp <span class="code-keyword">else</span> <span class="code-number">4</span>.dp
    }
    <span class="code-keyword">val</span> arrowRotation <span class="code-keyword">by</span> transition.<span class="code-func">animateFloat</span>(label = <span class="code-string">"arrow"</span>) {
        <span class="code-keyword">if</span> (it) <span class="code-number">180f</span> <span class="code-keyword">else</span> <span class="code-number">0f</span>
    }

    <span class="code-func">Card</span>(
        modifier = <span class="code-type">Modifier</span>
            .<span class="code-func">fillMaxWidth</span>()
            .<span class="code-func">clickable</span> { expanded = !expanded },
        elevation = <span class="code-func">CardDefaults</span>.<span class="code-func">cardElevation</span>(cardElevation)
    ) {
        <span class="code-func">Column</span>(modifier = <span class="code-type">Modifier</span>.<span class="code-func">padding</span>(cardPadding)) {
            <span class="code-func">Row</span>(verticalAlignment = Alignment.CenterVertically) {
                <span class="code-func">Text</span>(title, style = MaterialTheme.typography.titleMedium)
                <span class="code-func">Spacer</span>(<span class="code-type">Modifier</span>.<span class="code-func">weight</span>(<span class="code-number">1f</span>))
                <span class="code-func">Icon</span>(
                    Icons.Default.KeyboardArrowDown,
                    contentDescription = <span class="code-keyword">null</span>,
                    modifier = <span class="code-type">Modifier</span>.<span class="code-func">graphicsLayer</span> {
                        rotationZ = arrowRotation
                    }
                )
            }

            <span class="code-func">Spacer</span>(<span class="code-type">Modifier</span>.<span class="code-func">height</span>(<span class="code-number">8</span>.dp))
            <span class="code-func">Text</span>(summary, color = MaterialTheme.colorScheme.onSurfaceVariant)

            <span class="code-func">AnimatedVisibility</span>(visible = expanded) {
                <span class="code-func">Column</span> {
                    <span class="code-func">Spacer</span>(<span class="code-type">Modifier</span>.<span class="code-func">height</span>(<span class="code-number">16</span>.dp))
                    <span class="code-func">HorizontalDivider</span>()
                    <span class="code-func">Spacer</span>(<span class="code-type">Modifier</span>.<span class="code-func">height</span>(<span class="code-number">16</span>.dp))
                    <span class="code-func">Text</span>(content)
                }
            }
        }
    }
}</code></pre>

        <h2>æ€»ç»“</h2>
        <p>Jetpack Compose çš„åŠ¨ç”»ç³»ç»Ÿè®¾è®¡å¾—éå¸¸çµæ´»ï¼š</p>
        <ul>
            <li><strong>ç®€å•åœºæ™¯</strong>ï¼šç”¨ <code>animateXxxAsState</code> ä¸€è¡Œä»£ç æå®š</li>
            <li><strong>å…ƒç´ æ˜¾éš</strong>ï¼šç”¨ <code>AnimatedVisibility</code> è‡ªåŠ¨å¤„ç†è¿›å…¥/é€€å‡º</li>
            <li><strong>å†…å®¹åˆ‡æ¢</strong>ï¼šç”¨ <code>AnimatedContent</code> å®ç°å¹³æ»‘è¿‡æ¸¡</li>
            <li><strong>å¤šå±æ€§åè°ƒ</strong>ï¼šç”¨ <code>updateTransition</code> ç»Ÿä¸€ç®¡ç†</li>
            <li><strong>å¾ªç¯åŠ¨ç”»</strong>ï¼šç”¨ <code>rememberInfiniteTransition</code></li>
            <li><strong>æ‰‹åŠ¿/å¤æ‚æ§åˆ¶</strong>ï¼šç”¨ <code>Animatable</code> åœ¨åç¨‹ä¸­ç²¾ç»†æ“æ§</li>
        </ul>
        <p>æŒæ¡è¿™äº› API åï¼Œä½ å¯ä»¥ä¸ºåº”ç”¨æ‰“é€ æµç•…ã€è‡ªç„¶ã€ä»¤äººæ„‰æ‚¦çš„äº¤äº’ä½“éªŒã€‚ä¸‹ä¸€æ­¥å»ºè®®ï¼šç»“åˆ <a href="compose-navigation-best-practices.html">Navigation Compose</a> å®ç°é¡µé¢åˆ‡æ¢åŠ¨ç”»ï¼Œè®©æ•´ä¸ªåº”ç”¨çš„åŠ¨æ•ˆä½“éªŒæ›´åŠ ç»Ÿä¸€ã€‚</p>
    </article>

    <footer class="footer">
        <p>&copy; 2024 Fidroid. <a href="../index.html">è¿”å›é¦–é¡µ</a></p>
    </footer>
</body>
</html>

