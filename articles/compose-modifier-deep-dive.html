<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compose Modifier é“¾å¼è°ƒç”¨åŸç†ä¸è‡ªå®šä¹‰ Modifier - Fidroid</title>
    <meta name="description" content="æ·±å…¥ç†è§£ Modifier çš„é“¾å¼è°ƒç”¨æœºåˆ¶ã€Node ç³»ç»Ÿã€ä»¥åŠå¦‚ä½•åˆ›å»ºé«˜æ€§èƒ½çš„è‡ªå®šä¹‰ Modifierã€‚">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.8;
            color: #e5e7eb;
            background: #020617;
        }
        .navbar {
            background: rgba(15,23,42,0.98);
            backdrop-filter: blur(10px);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }
        .nav-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 1rem 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #38bdf8;
            text-decoration: none;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }
        .back-link { color: #9ca3af; text-decoration: none; font-size: 0.9rem; }
        .back-link:hover { color: #38bdf8; }

        .article-header {
            padding: 120px 20px 60px;
            background: radial-gradient(circle at top left, #f97316 0, transparent 50%),
                        radial-gradient(circle at bottom right, #06b6d4 0, transparent 55%),
                        #020617;
            text-align: center;
        }
        .article-header h1 {
            max-width: 800px;
            margin: 0 auto 1rem;
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -0.03em;
            color: #fff;
        }
        .article-meta { color: #9ca3af; font-size: 0.9rem; margin-bottom: 1.5rem; }
        .article-tags { display: flex; justify-content: center; flex-wrap: wrap; gap: 0.5rem; }
        .article-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            background: rgba(15,23,42,0.85);
            border: 1px solid rgba(249,115,22,0.4);
            color: #fdba74;
        }

        .article-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 60px 20px 80px;
        }
        .article-content h2 {
            font-size: 1.6rem;
            margin: 2.5rem 0 1rem;
            color: #f9fafb;
            border-left: 4px solid #f97316;
            padding-left: 1rem;
        }
        .article-content h3 { font-size: 1.25rem; margin: 2rem 0 0.75rem; color: #e5e7eb; }
        .article-content p { margin-bottom: 1.25rem; color: #d1d5db; }
        .article-content ul, .article-content ol { margin: 1rem 0 1.5rem 1.5rem; color: #d1d5db; }
        .article-content li { margin-bottom: 0.5rem; }
        .article-content strong { color: #f9fafb; }
        .article-content a { color: #38bdf8; text-decoration: underline; }

        pre {
            background: #0f172a;
            border: 1px solid rgba(249,115,22,0.3);
            border-radius: 12px;
            padding: 1.25rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-size: 0.85rem;
            line-height: 1.6;
        }
        code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; color: #e5e7eb; }
        .code-keyword { color: #c084fc; }
        .code-func { color: #38bdf8; }
        .code-type { color: #4ade80; }
        .code-string { color: #fb7185; }
        .code-comment { color: #6b7280; font-style: italic; }
        .code-number { color: #fbbf24; }
        .code-annotation { color: #f472b6; }

        .callout {
            background: rgba(249,115,22,0.1);
            border: 1px solid rgba(249,115,22,0.3);
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
            margin: 1.5rem 0;
        }
        .callout-title { font-weight: 600; color: #fdba74; margin-bottom: 0.5rem; }
        .callout p { margin-bottom: 0; color: #d1d5db; }

        .callout-warning {
            background: rgba(245,158,11,0.1);
            border: 1px solid rgba(245,158,11,0.3);
        }
        .callout-warning .callout-title { color: #fcd34d; }

        .callout-info {
            background: rgba(14,165,233,0.1);
            border: 1px solid rgba(14,165,233,0.3);
        }
        .callout-info .callout-title { color: #7dd3fc; }

        .diagram {
            background: #0f172a;
            border: 1px solid rgba(249,115,22,0.3);
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
            text-align: center;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            font-size: 0.8rem;
            line-height: 1.6;
            color: #94a3b8;
            overflow-x: auto;
        }
        .diagram .highlight { color: #f97316; font-weight: bold; }
        .diagram .modifier { color: #4ade80; }
        .diagram .node { color: #38bdf8; }
        .diagram .layout { color: #c084fc; }

        .reference {
            background: rgba(15,23,42,0.6);
            border: 1px solid rgba(148,163,184,0.2);
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin: 1rem 0;
            font-size: 0.9rem;
        }
        .reference-title {
            font-weight: 600;
            color: #94a3b8;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }
        .reference a { color: #38bdf8; }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            font-size: 0.9rem;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid rgba(148,163,184,0.3);
            padding: 0.75rem 1rem;
            text-align: left;
        }
        .comparison-table th {
            background: rgba(15,23,42,0.8);
            color: #f9fafb;
        }
        .comparison-table td { color: #d1d5db; }

        .footer {
            background: #020617;
            border-top: 1px solid #111827;
            padding: 2rem;
            text-align: center;
            color: #6b7280;
        }
        .footer a { color: #38bdf8; text-decoration: none; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="logo">Fidroid</a>
            <a href="../index.html#blog" class="back-link">â† è¿”å›åšå®¢åˆ—è¡¨</a>
        </div>
    </nav>

    <header class="article-header">
        <h1>Compose Modifier é“¾å¼è°ƒç”¨åŸç†ä¸è‡ªå®šä¹‰ Modifier</h1>
        <p class="article-meta">2024-05-02 Â· 32 min Â· åº•å±‚åŸç†æ·±åº¦è§£æ</p>
        <div class="article-tags">
            <span class="article-tag">Modifier</span>
            <span class="article-tag">Modifier.Node</span>
            <span class="article-tag">Chain</span>
            <span class="article-tag">Custom Modifier</span>
        </div>
    </header>

    <article class="article-content">
        <p><code>Modifier</code> æ˜¯ Compose ä¸­æœ€å¸¸ç”¨çš„ API ä¹‹ä¸€ï¼Œä½†ä½ æ˜¯å¦æƒ³è¿‡ï¼šä¸ºä»€ä¹ˆ <code>.padding().background().clickable()</code> çš„é¡ºåºä¼šå½±å“ç»“æœï¼ŸModifier é“¾æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„ï¼Ÿæœ¬æ–‡å°†æ·±å…¥ Modifier çš„å†…éƒ¨å®ç°ï¼Œæ­ç¤ºé“¾å¼è°ƒç”¨çš„ç§˜å¯†ï¼Œå¹¶æ•™ä½ å¦‚ä½•åˆ›å»ºé«˜æ€§èƒ½çš„è‡ªå®šä¹‰ Modifierã€‚</p>

        <div class="reference">
            <div class="reference-title">ğŸ“š å®˜æ–¹å‚è€ƒ</div>
            <a href="https://developer.android.com/jetpack/compose/modifiers" target="_blank">Compose Modifiers - Android Developers</a><br>
            <a href="https://developer.android.com/jetpack/compose/custom-modifiers" target="_blank">Custom Modifiers - Android Developers</a>
        </div>

        <h2>ä¸€ã€Modifier æ˜¯ä»€ä¹ˆï¼Ÿ</h2>

        <p>ä» API è§’åº¦çœ‹ï¼Œ<code>Modifier</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼š</p>

<pre><code><span class="code-keyword">interface</span> <span class="code-type">Modifier</span> {
    <span class="code-comment">// éå† Modifier é“¾ä¸­çš„æ¯ä¸ªå…ƒç´ </span>
    <span class="code-keyword">fun</span> &lt;<span class="code-type">R</span>&gt; <span class="code-func">foldIn</span>(initial: <span class="code-type">R</span>, operation: (<span class="code-type">R</span>, <span class="code-type">Element</span>) -> <span class="code-type">R</span>): <span class="code-type">R</span>
    <span class="code-keyword">fun</span> &lt;<span class="code-type">R</span>&gt; <span class="code-func">foldOut</span>(initial: <span class="code-type">R</span>, operation: (<span class="code-type">Element</span>, <span class="code-type">R</span>) -> <span class="code-type">R</span>): <span class="code-type">R</span>
    
    <span class="code-comment">// æ£€æŸ¥æ˜¯å¦åŒ…å«æŸç±»å‹çš„ Modifier</span>
    <span class="code-keyword">fun</span> <span class="code-func">any</span>(predicate: (<span class="code-type">Element</span>) -> <span class="code-type">Boolean</span>): <span class="code-type">Boolean</span>
    <span class="code-keyword">fun</span> <span class="code-func">all</span>(predicate: (<span class="code-type">Element</span>) -> <span class="code-type">Boolean</span>): <span class="code-type">Boolean</span>
    
    <span class="code-comment">// è¿æ¥ä¸¤ä¸ª Modifier</span>
    <span class="code-keyword">infix fun</span> <span class="code-func">then</span>(other: <span class="code-type">Modifier</span>): <span class="code-type">Modifier</span>
    
    <span class="code-comment">// å•ä¸ª Modifier å…ƒç´ </span>
    <span class="code-keyword">interface</span> <span class="code-type">Element</span> : <span class="code-type">Modifier</span>
    
    <span class="code-comment">// ç©º Modifierï¼ˆé“¾çš„èµ·ç‚¹ï¼‰</span>
    <span class="code-keyword">companion object</span> : <span class="code-type">Modifier</span>
}</code></pre>

        <p>å…³é”®æ´å¯Ÿï¼š<strong>Modifier æœ¬èº«ä¸æ‰§è¡Œä»»ä½•æ“ä½œ</strong>ï¼Œå®ƒåªæ˜¯ä¸€ä¸ª<strong>æè¿°</strong>ã€‚çœŸæ­£çš„å·¥ä½œç”± Modifier.Node åœ¨å¸ƒå±€é˜¶æ®µå®Œæˆã€‚</p>

        <h3>Modifier çš„ä¸‰ç§å½¢æ€</h3>

        <table class="comparison-table">
            <thead>
                <tr>
                    <th>ç±»å‹</th>
                    <th>æè¿°</th>
                    <th>ç¤ºä¾‹</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Modifier.companion</td>
                    <td>ç©º Modifierï¼Œé“¾çš„èµ·ç‚¹</td>
                    <td><code>Modifier</code></td>
                </tr>
                <tr>
                    <td>Modifier.Element</td>
                    <td>å•ä¸ª Modifier å…ƒç´ </td>
                    <td><code>PaddingModifier</code></td>
                </tr>
                <tr>
                    <td>CombinedModifier</td>
                    <td>ä¸¤ä¸ª Modifier çš„ç»„åˆ</td>
                    <td><code>Modifier.padding().background()</code></td>
                </tr>
            </tbody>
        </table>

        <h2>äºŒã€é“¾å¼è°ƒç”¨çš„ç§˜å¯†</h2>

        <p>å½“ä½ å†™ <code>Modifier.padding(16.dp).background(Color.Red)</code> æ—¶ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>

<pre><code><span class="code-comment">// å±•å¼€é“¾å¼è°ƒç”¨</span>
<span class="code-keyword">val</span> modifier = <span class="code-type">Modifier</span>           <span class="code-comment">// Modifier.Companion (ç©º)</span>
    .<span class="code-func">padding</span>(<span class="code-number">16</span>.dp)              <span class="code-comment">// CombinedModifier(Companion, PaddingModifier)</span>
    .<span class="code-func">background</span>(<span class="code-type">Color</span>.Red)       <span class="code-comment">// CombinedModifier(ä¸Šé¢çš„ç»“æœ, BackgroundModifier)</span>

<span class="code-comment">// å†…éƒ¨ç»“æ„ï¼ˆç®€åŒ–ï¼‰</span>
<span class="code-keyword">class</span> <span class="code-type">CombinedModifier</span>(
    <span class="code-keyword">val</span> outer: <span class="code-type">Modifier</span>,
    <span class="code-keyword">val</span> inner: <span class="code-type">Modifier</span>
) : <span class="code-type">Modifier</span></code></pre>

        <div class="diagram">
<pre>
<span class="highlight">Modifier é“¾çš„æ•°æ®ç»“æ„</span>

Modifier.padding(16.dp).background(Color.Red).clickable { }

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  CombinedModifier   â”‚
                    â”‚  (æœ€å¤–å±‚)            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                                     â”‚
            â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CombinedModifier   â”‚               â”‚  <span class="modifier">ClickableModifier</span>   â”‚
â”‚  (ä¸­é—´å±‚)            â”‚               â”‚  (inner)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚             â”‚
    â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="modifier">Empty</span>  â”‚  â”‚  <span class="modifier">PaddingModifier</span>    â”‚
â”‚        â”‚  â”‚  (16.dp)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  <span class="modifier">BackgroundModifier</span> â”‚
    â”‚  (Color.Red)        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="node">éå†é¡ºåº (foldIn): padding â†’ background â†’ clickable</span>
<span class="layout">éå†é¡ºåº (foldOut): clickable â†’ background â†’ padding</span>
</pre>
        </div>

        <h3>ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦ï¼Ÿ</h3>

<pre><code><span class="code-comment">// è¿™ä¸¤ä¸ªçœ‹èµ·æ¥ç›¸ä¼¼ï¼Œä½†æ•ˆæœå®Œå…¨ä¸åŒï¼</span>

<span class="code-comment">// 1. å…ˆ paddingï¼Œå background</span>
<span class="code-type">Box</span>(
    modifier = <span class="code-type">Modifier</span>
        .<span class="code-func">padding</span>(<span class="code-number">16</span>.dp)      <span class="code-comment">// å…ˆç¼©å°å¯ç”¨ç©ºé—´</span>
        .<span class="code-func">background</span>(<span class="code-type">Color</span>.Red)  <span class="code-comment">// åœ¨ç¼©å°åçš„ç©ºé—´ç»˜åˆ¶èƒŒæ™¯</span>
)
<span class="code-comment">// ç»“æœï¼šçº¢è‰²èƒŒæ™¯ä¸åŒ…å« padding åŒºåŸŸ</span>

<span class="code-comment">// 2. å…ˆ backgroundï¼Œå padding</span>
<span class="code-type">Box</span>(
    modifier = <span class="code-type">Modifier</span>
        .<span class="code-func">background</span>(<span class="code-type">Color</span>.Red)  <span class="code-comment">// å…ˆç»˜åˆ¶èƒŒæ™¯</span>
        .<span class="code-func">padding</span>(<span class="code-number">16</span>.dp)      <span class="code-comment">// å†ç¼©å°å†…å®¹ç©ºé—´</span>
)
<span class="code-comment">// ç»“æœï¼šçº¢è‰²èƒŒæ™¯åŒ…å« padding åŒºåŸŸ</span></code></pre>

        <div class="callout callout-info">
            <p class="callout-title">ğŸ’¡ ç†è§£ Modifier é¡ºåºçš„å¿ƒæ™ºæ¨¡å‹</p>
            <p>æŠŠ Modifier é“¾æƒ³è±¡æˆ<strong>æ´‹è‘±å±‚</strong>ï¼šç¬¬ä¸€ä¸ª Modifier æ˜¯æœ€å¤–å±‚ï¼Œæœ€åä¸€ä¸ªæ˜¯æœ€å†…å±‚ã€‚å¸ƒå±€ä»å¤–å‘å†…æµ‹é‡ï¼Œç»˜åˆ¶ä»å†…å‘å¤–è¿›è¡Œã€‚</p>
        </div>

        <h2>ä¸‰ã€Modifier.Node ç³»ç»Ÿï¼ˆCompose 1.3+ï¼‰</h2>

        <p>ä» Compose 1.3 å¼€å§‹ï¼Œå¼•å…¥äº†å…¨æ–°çš„ <code>Modifier.Node</code> ç³»ç»Ÿï¼Œå¤§å¹…æå‡äº†æ€§èƒ½ã€‚</p>

        <h3>æ—§ç³»ç»Ÿ vs æ–°ç³»ç»Ÿ</h3>

        <table class="comparison-table">
            <thead>
                <tr>
                    <th>ç‰¹æ€§</th>
                    <th>æ—§ç³»ç»Ÿ (composed)</th>
                    <th>æ–°ç³»ç»Ÿ (Modifier.Node)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>çŠ¶æ€å­˜å‚¨</td>
                    <td>æ¯æ¬¡é‡ç»„åˆ›å»ºæ–°å®ä¾‹</td>
                    <td>Node å®ä¾‹å¯å¤ç”¨</td>
                </tr>
                <tr>
                    <td>å†…å­˜åˆ†é…</td>
                    <td>é¢‘ç¹åˆ†é…</td>
                    <td>æœ€å°åŒ–åˆ†é…</td>
                </tr>
                <tr>
                    <td>æ›´æ–°æœºåˆ¶</td>
                    <td>æ›¿æ¢æ•´ä¸ª Modifier</td>
                    <td>åŸåœ°æ›´æ–° Node</td>
                </tr>
                <tr>
                    <td>æ€§èƒ½</td>
                    <td>ä¸€èˆ¬</td>
                    <td>æ˜¾è‘—æå‡</td>
                </tr>
            </tbody>
        </table>

        <h3>Modifier.Node çš„æ ¸å¿ƒæ¦‚å¿µ</h3>

<pre><code><span class="code-comment">// 1. ModifierNodeElementï¼šæè¿° Modifier çš„æ•°æ®</span>
<span class="code-keyword">class</span> <span class="code-type">PaddingElement</span>(
    <span class="code-keyword">val</span> padding: <span class="code-type">Dp</span>
) : <span class="code-type">ModifierNodeElement</span>&lt;<span class="code-type">PaddingNode</span>&gt;() {
    
    <span class="code-keyword">override fun</span> <span class="code-func">create</span>() = <span class="code-type">PaddingNode</span>(padding)
    
    <span class="code-keyword">override fun</span> <span class="code-func">update</span>(node: <span class="code-type">PaddingNode</span>) {
        node.padding = padding  <span class="code-comment">// åŸåœ°æ›´æ–°ï¼Œä¸åˆ›å»ºæ–°å®ä¾‹</span>
    }
    
    <span class="code-keyword">override fun</span> <span class="code-func">equals</span>(other: <span class="code-type">Any</span>?) = 
        other <span class="code-keyword">is</span> <span class="code-type">PaddingElement</span> && other.padding == padding
    
    <span class="code-keyword">override fun</span> <span class="code-func">hashCode</span>() = padding.<span class="code-func">hashCode</span>()
}

<span class="code-comment">// 2. Modifier.Nodeï¼šå®é™…æ‰§è¡Œå·¥ä½œçš„èŠ‚ç‚¹</span>
<span class="code-keyword">class</span> <span class="code-type">PaddingNode</span>(
    <span class="code-keyword">var</span> padding: <span class="code-type">Dp</span>
) : <span class="code-type">LayoutModifierNode</span>, <span class="code-type">Modifier.Node</span>() {
    
    <span class="code-keyword">override fun</span> <span class="code-type">MeasureScope</span>.<span class="code-func">measure</span>(
        measurable: <span class="code-type">Measurable</span>,
        constraints: <span class="code-type">Constraints</span>
    ): <span class="code-type">MeasureResult</span> {
        <span class="code-keyword">val</span> paddingPx = padding.<span class="code-func">roundToPx</span>()
        <span class="code-keyword">val</span> placeable = measurable.<span class="code-func">measure</span>(
            constraints.<span class="code-func">offset</span>(-paddingPx * <span class="code-number">2</span>, -paddingPx * <span class="code-number">2</span>)
        )
        <span class="code-keyword">return</span> <span class="code-func">layout</span>(
            placeable.width + paddingPx * <span class="code-number">2</span>,
            placeable.height + paddingPx * <span class="code-number">2</span>
        ) {
            placeable.<span class="code-func">place</span>(paddingPx, paddingPx)
        }
    }
}</code></pre>

        <div class="diagram">
<pre>
<span class="highlight">Modifier.Node ç”Ÿå‘½å‘¨æœŸ</span>

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é¦–æ¬¡ç»„åˆ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ModifierNodeElement â”€â”€â”€â”€â”€â”€â–¶ <span class="node">create()</span> â”€â”€â”€â”€â”€â”€â–¶ Modifier.Node â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é‡ç»„ï¼ˆå‚æ•°å˜åŒ–ï¼‰                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  æ–° Element â”€â”€â–¶ <span class="modifier">equals(æ—§ Element)?</span>                        â”‚
â”‚                       â”‚                                      â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚            â”‚                     â”‚                          â”‚
â”‚            â–¼                     â–¼                          â”‚
â”‚      ç›¸ç­‰ï¼šè·³è¿‡            ä¸ç›¸ç­‰ï¼š<span class="node">update(node)</span>              â”‚
â”‚                                  â”‚                          â”‚
â”‚                                  â–¼                          â”‚
â”‚                          åŸåœ°æ›´æ–° Node                       â”‚
â”‚                          <span class="layout">ï¼ˆæ— å†…å­˜åˆ†é…ï¼‰</span>                      â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
        </div>

        <div class="reference">
            <div class="reference-title">ğŸ“š æ·±å…¥é˜…è¯»</div>
            <a href="https://android-developers.googleblog.com/2023/01/modifier-node-jetpack-compose.html" target="_blank">Modifier.Node - Android Developers Blog</a>
        </div>

        <h2>å››ã€ä¸åŒç±»å‹çš„ Modifier.Node</h2>

        <p>æ ¹æ®åŠŸèƒ½ä¸åŒï¼ŒModifier.Node æœ‰å¤šä¸ªå­æ¥å£ï¼š</p>

        <table class="comparison-table">
            <thead>
                <tr>
                    <th>æ¥å£</th>
                    <th>åŠŸèƒ½</th>
                    <th>å…¸å‹ç”¨ä¾‹</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>LayoutModifierNode</td>
                    <td>å‚ä¸æµ‹é‡å’Œå¸ƒå±€</td>
                    <td>padding, size, offset</td>
                </tr>
                <tr>
                    <td>DrawModifierNode</td>
                    <td>ç»˜åˆ¶å†…å®¹</td>
                    <td>background, border, shadow</td>
                </tr>
                <tr>
                    <td>PointerInputModifierNode</td>
                    <td>å¤„ç†è§¦æ‘¸äº‹ä»¶</td>
                    <td>clickable, draggable</td>
                </tr>
                <tr>
                    <td>SemanticsModifierNode</td>
                    <td>æä¾›æ— éšœç¢ä¿¡æ¯</td>
                    <td>contentDescription</td>
                </tr>
                <tr>
                    <td>FocusEventModifierNode</td>
                    <td>ç„¦ç‚¹äº‹ä»¶</td>
                    <td>onFocusChanged</td>
                </tr>
                <tr>
                    <td>GlobalPositionAwareModifierNode</td>
                    <td>è·å–å…¨å±€ä½ç½®</td>
                    <td>onGloballyPositioned</td>
                </tr>
            </tbody>
        </table>

        <h3>ç»„åˆå¤šä¸ªèƒ½åŠ›</h3>

<pre><code><span class="code-comment">// ä¸€ä¸ª Node å¯ä»¥å®ç°å¤šä¸ªæ¥å£</span>
<span class="code-keyword">class</span> <span class="code-type">CustomButtonNode</span> : 
    <span class="code-type">Modifier.Node</span>(),
    <span class="code-type">LayoutModifierNode</span>,      <span class="code-comment">// æ§åˆ¶å¤§å°</span>
    <span class="code-type">DrawModifierNode</span>,        <span class="code-comment">// ç»˜åˆ¶èƒŒæ™¯</span>
    <span class="code-type">PointerInputModifierNode</span>, <span class="code-comment">// å¤„ç†ç‚¹å‡»</span>
    <span class="code-type">SemanticsModifierNode</span>    <span class="code-comment">// æ— éšœç¢</span>
{
    <span class="code-comment">// å®ç°å„ä¸ªæ¥å£çš„æ–¹æ³•...</span>
}</code></pre>

        <h2>äº”ã€å®æˆ˜ï¼šåˆ›å»ºè‡ªå®šä¹‰ Modifier</h2>

        <h3>ç¤ºä¾‹ 1ï¼šç®€å•çš„ shimmer æ•ˆæœ</h3>

<pre><code><span class="code-comment">// 1. å®šä¹‰ Element</span>
<span class="code-keyword">private class</span> <span class="code-type">ShimmerElement</span>(
    <span class="code-keyword">val</span> color: <span class="code-type">Color</span>,
    <span class="code-keyword">val</span> durationMillis: <span class="code-type">Int</span>
) : <span class="code-type">ModifierNodeElement</span>&lt;<span class="code-type">ShimmerNode</span>&gt;() {
    
    <span class="code-keyword">override fun</span> <span class="code-func">create</span>() = <span class="code-type">ShimmerNode</span>(color, durationMillis)
    
    <span class="code-keyword">override fun</span> <span class="code-func">update</span>(node: <span class="code-type">ShimmerNode</span>) {
        node.color = color
        node.durationMillis = durationMillis
    }
    
    <span class="code-keyword">override fun</span> <span class="code-func">equals</span>(other: <span class="code-type">Any</span>?): <span class="code-type">Boolean</span> {
        <span class="code-keyword">if</span> (other !<span class="code-keyword">is</span> <span class="code-type">ShimmerElement</span>) <span class="code-keyword">return false</span>
        <span class="code-keyword">return</span> color == other.color && durationMillis == other.durationMillis
    }
    
    <span class="code-keyword">override fun</span> <span class="code-func">hashCode</span>() = color.<span class="code-func">hashCode</span>() * <span class="code-number">31</span> + durationMillis
}

<span class="code-comment">// 2. å®šä¹‰ Node</span>
<span class="code-keyword">private class</span> <span class="code-type">ShimmerNode</span>(
    <span class="code-keyword">var</span> color: <span class="code-type">Color</span>,
    <span class="code-keyword">var</span> durationMillis: <span class="code-type">Int</span>
) : <span class="code-type">DrawModifierNode</span>, <span class="code-type">Modifier.Node</span>() {
    
    <span class="code-keyword">private var</span> progress = <span class="code-number">0f</span>
    
    <span class="code-keyword">override fun</span> <span class="code-type">ContentDrawScope</span>.<span class="code-func">draw</span>() {
        <span class="code-comment">// å…ˆç»˜åˆ¶åŸå†…å®¹</span>
        <span class="code-func">drawContent</span>()
        
        <span class="code-comment">// ç»˜åˆ¶ shimmer æ•ˆæœ</span>
        <span class="code-keyword">val</span> shimmerBrush = <span class="code-type">Brush</span>.<span class="code-func">linearGradient</span>(
            colors = <span class="code-func">listOf</span>(
                <span class="code-type">Color</span>.Transparent,
                color.<span class="code-func">copy</span>(alpha = <span class="code-number">0.3f</span>),
                <span class="code-type">Color</span>.Transparent
            ),
            start = <span class="code-type">Offset</span>(size.width * (progress - <span class="code-number">0.3f</span>), <span class="code-number">0f</span>),
            end = <span class="code-type">Offset</span>(size.width * (progress + <span class="code-number">0.3f</span>), size.height)
        )
        <span class="code-func">drawRect</span>(shimmerBrush)
    }
    
    <span class="code-comment">// åŠ¨ç”»æ›´æ–° progressï¼ˆéœ€è¦é…åˆ coroutineï¼‰</span>
}

<span class="code-comment">// 3. æ‰©å±•å‡½æ•°</span>
<span class="code-keyword">fun</span> <span class="code-type">Modifier</span>.<span class="code-func">shimmer</span>(
    color: <span class="code-type">Color</span> = <span class="code-type">Color</span>.White,
    durationMillis: <span class="code-type">Int</span> = <span class="code-number">1000</span>
): <span class="code-type">Modifier</span> = <span class="code-keyword">this</span> <span class="code-keyword">then</span> <span class="code-type">ShimmerElement</span>(color, durationMillis)</code></pre>

        <h3>ç¤ºä¾‹ 2ï¼šå¸¦çŠ¶æ€çš„ Modifierï¼ˆä½¿ç”¨ coroutineï¼‰</h3>

<pre><code><span class="code-comment">// ä¸€ä¸ªå¯ä»¥åœ¨ Node ä¸­ä½¿ç”¨åç¨‹çš„ç¤ºä¾‹</span>
<span class="code-keyword">private class</span> <span class="code-type">PulseNode</span>(
    <span class="code-keyword">var</span> minScale: <span class="code-type">Float</span>,
    <span class="code-keyword">var</span> maxScale: <span class="code-type">Float</span>
) : <span class="code-type">LayoutModifierNode</span>, <span class="code-type">Modifier.Node</span>() {
    
    <span class="code-keyword">private var</span> scale = <span class="code-number">1f</span>
    
    <span class="code-comment">// Node é™„åŠ åˆ°æ ‘æ—¶è°ƒç”¨</span>
    <span class="code-keyword">override fun</span> <span class="code-func">onAttach</span>() {
        <span class="code-comment">// å¯åŠ¨åŠ¨ç”»åç¨‹</span>
        coroutineScope.<span class="code-func">launch</span> {
            <span class="code-keyword">while</span> (<span class="code-keyword">true</span>) {
                <span class="code-func">animate</span>(minScale, maxScale) { value, _ ->
                    scale = value
                    <span class="code-func">invalidateMeasurement</span>()  <span class="code-comment">// è§¦å‘é‡æ–°æµ‹é‡</span>
                }
                <span class="code-func">animate</span>(maxScale, minScale) { value, _ ->
                    scale = value
                    <span class="code-func">invalidateMeasurement</span>()
                }
            }
        }
    }
    
    <span class="code-keyword">override fun</span> <span class="code-type">MeasureScope</span>.<span class="code-func">measure</span>(
        measurable: <span class="code-type">Measurable</span>,
        constraints: <span class="code-type">Constraints</span>
    ): <span class="code-type">MeasureResult</span> {
        <span class="code-keyword">val</span> placeable = measurable.<span class="code-func">measure</span>(constraints)
        <span class="code-keyword">val</span> scaledWidth = (placeable.width * scale).<span class="code-func">roundToInt</span>()
        <span class="code-keyword">val</span> scaledHeight = (placeable.height * scale).<span class="code-func">roundToInt</span>()
        
        <span class="code-keyword">return</span> <span class="code-func">layout</span>(scaledWidth, scaledHeight) {
            placeable.<span class="code-func">placeWithLayer</span>(
                x = (scaledWidth - placeable.width) / <span class="code-number">2</span>,
                y = (scaledHeight - placeable.height) / <span class="code-number">2</span>
            ) {
                scaleX = scale
                scaleY = scale
            }
        }
    }
}</code></pre>

        <h2>å…­ã€Modifier æ€§èƒ½ä¼˜åŒ–</h2>

        <h3>é¿å…åœ¨ Composable ä¸­åˆ›å»º Modifier</h3>

<pre><code><span class="code-comment">// âŒ æ¯æ¬¡é‡ç»„éƒ½åˆ›å»ºæ–°çš„ Modifier å®ä¾‹</span>
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">BadExample</span>() {
    <span class="code-type">Box</span>(
        modifier = <span class="code-type">Modifier</span>
            .<span class="code-func">padding</span>(<span class="code-number">16</span>.dp)
            .<span class="code-func">background</span>(<span class="code-type">Color</span>.Red)  <span class="code-comment">// æ¯æ¬¡é‡ç»„åˆ›å»ºæ–°å®ä¾‹</span>
    )
}

<span class="code-comment">// âœ… ä½¿ç”¨ remember ç¼“å­˜ä¸å˜çš„ Modifier</span>
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">GoodExample</span>() {
    <span class="code-keyword">val</span> modifier = <span class="code-func">remember</span> {
        <span class="code-type">Modifier</span>
            .<span class="code-func">padding</span>(<span class="code-number">16</span>.dp)
            .<span class="code-func">background</span>(<span class="code-type">Color</span>.Red)
    }
    <span class="code-type">Box</span>(modifier = modifier)
}

<span class="code-comment">// âœ… å¯¹äºä¾èµ–å‚æ•°çš„ Modifierï¼Œä½¿ç”¨ remember(key)</span>
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">BetterExample</span>(color: <span class="code-type">Color</span>) {
    <span class="code-keyword">val</span> modifier = <span class="code-func">remember</span>(color) {
        <span class="code-type">Modifier</span>
            .<span class="code-func">padding</span>(<span class="code-number">16</span>.dp)
            .<span class="code-func">background</span>(color)
    }
    <span class="code-type">Box</span>(modifier = modifier)
}</code></pre>

        <h3>ä½¿ç”¨ Modifier.Node è€Œé composed</h3>

<pre><code><span class="code-comment">// âŒ æ—§æ–¹å¼ï¼šä½¿ç”¨ composedï¼ˆæ€§èƒ½è¾ƒå·®ï¼‰</span>
<span class="code-keyword">fun</span> <span class="code-type">Modifier</span>.<span class="code-func">oldClickable</span>(onClick: () -> <span class="code-type">Unit</span>) = <span class="code-func">composed</span> {
    <span class="code-keyword">val</span> interactionSource = <span class="code-func">remember</span> { <span class="code-type">MutableInteractionSource</span>() }
    <span class="code-keyword">this</span>.<span class="code-func">clickable</span>(
        interactionSource = interactionSource,
        indication = <span class="code-func">rememberRipple</span>(),
        onClick = onClick
    )
}

<span class="code-comment">// âœ… æ–°æ–¹å¼ï¼šä½¿ç”¨ Modifier.Nodeï¼ˆé«˜æ€§èƒ½ï¼‰</span>
<span class="code-keyword">fun</span> <span class="code-type">Modifier</span>.<span class="code-func">newClickable</span>(onClick: () -> <span class="code-type">Unit</span>) = 
    <span class="code-keyword">this</span> <span class="code-keyword">then</span> <span class="code-type">ClickableElement</span>(onClick)

<span class="code-keyword">private class</span> <span class="code-type">ClickableElement</span>(
    <span class="code-keyword">val</span> onClick: () -> <span class="code-type">Unit</span>
) : <span class="code-type">ModifierNodeElement</span>&lt;<span class="code-type">ClickableNode</span>&gt;() {
    <span class="code-comment">// ...</span>
}</code></pre>

        <div class="callout callout-warning">
            <p class="callout-title">âš ï¸ composed çš„é—®é¢˜</p>
            <p><code>composed</code> ä¼šåœ¨æ¯æ¬¡é‡ç»„æ—¶åˆ›å»ºæ–°çš„ Composable ä½œç”¨åŸŸï¼Œå¯¼è‡´é¢å¤–çš„å†…å­˜åˆ†é…å’Œæ€§èƒ½å¼€é”€ã€‚å¯¹äºæ–°ä»£ç ï¼Œå§‹ç»ˆä¼˜å…ˆä½¿ç”¨ <code>Modifier.Node</code>ã€‚</p>
        </div>

        <h2>ä¸ƒã€Modifier çš„æ‰§è¡Œé¡ºåºè¯¦è§£</h2>

        <p>ç†è§£æ‰§è¡Œé¡ºåºå¯¹äºæ­£ç¡®ä½¿ç”¨ Modifier è‡³å…³é‡è¦ï¼š</p>

        <div class="diagram">
<pre>
<span class="highlight">Modifier æ‰§è¡Œé˜¶æ®µ</span>

Modifier.padding(16.dp).background(Color.Red).clickable { }

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æµ‹é‡é˜¶æ®µ (Measure)                       â”‚
â”‚                     ä»å¤–åˆ°å†…                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  <span class="modifier">padding</span> â”€â”€â–¶ çº¦æŸå‡å° â”€â”€â–¶ <span class="modifier">background</span> â”€â”€â–¶ <span class="modifier">clickable</span> â”€â”€â–¶ å†…å®¹  â”‚
â”‚                                                              â”‚
â”‚  çº¦æŸ: 200x200    çº¦æŸ: 168x168    çº¦æŸ: 168x168              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å¸ƒå±€é˜¶æ®µ (Layout)                        â”‚
â”‚                     ä»å†…åˆ°å¤–                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  å†…å®¹ â”€â”€â–¶ <span class="modifier">clickable</span> â”€â”€â–¶ <span class="modifier">background</span> â”€â”€â–¶ <span class="modifier">padding</span> â”€â”€â–¶ æœ€ç»ˆä½ç½®  â”‚
â”‚                                                              â”‚
â”‚  å¤§å°: 100x50    å¤§å°: 100x50    å¤§å°: 100x50   å¤§å°: 132x82   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç»˜åˆ¶é˜¶æ®µ (Draw)                          â”‚
â”‚                     ä»å¤–åˆ°å†…ï¼ˆå…ˆèƒŒæ™¯åå†…å®¹ï¼‰                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  <span class="layout">padding åŒºåŸŸ</span> â”€â”€â–¶ <span class="modifier">background ç»˜åˆ¶</span> â”€â”€â–¶ <span class="node">clickable æ¶Ÿæ¼ª</span> â”€â”€â–¶ å†…å®¹  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
        </div>

        <h2>å…«ã€å¸¸è§ Modifier æ¨¡å¼</h2>

        <h3>æ¡ä»¶ Modifier</h3>

<pre><code><span class="code-comment">// âœ… ä½¿ç”¨ Modifier.then()</span>
<span class="code-keyword">fun</span> <span class="code-type">Modifier</span>.<span class="code-func">conditional</span>(
    condition: <span class="code-type">Boolean</span>,
    modifier: <span class="code-type">Modifier</span>.() -> <span class="code-type">Modifier</span>
): <span class="code-type">Modifier</span> = <span class="code-keyword">if</span> (condition) <span class="code-keyword">then</span>(<span class="code-func">modifier</span>()) <span class="code-keyword">else this</span>

<span class="code-comment">// ä½¿ç”¨</span>
<span class="code-type">Modifier</span>
    .<span class="code-func">padding</span>(<span class="code-number">16</span>.dp)
    .<span class="code-func">conditional</span>(isSelected) {
        <span class="code-type">Modifier</span>.<span class="code-func">border</span>(<span class="code-number">2</span>.dp, <span class="code-type">Color</span>.Blue)
    }</code></pre>

        <h3>é“¾å¼æ„å»ºå™¨</h3>

<pre><code><span class="code-comment">// åˆ›å»ºå¯å¤ç”¨çš„ Modifier ç»„åˆ</span>
<span class="code-keyword">fun</span> <span class="code-type">Modifier</span>.<span class="code-func">cardStyle</span>() = <span class="code-keyword">this</span>
    .<span class="code-func">fillMaxWidth</span>()
    .<span class="code-func">padding</span>(<span class="code-number">16</span>.dp)
    .<span class="code-func">clip</span>(<span class="code-type">RoundedCornerShape</span>(<span class="code-number">12</span>.dp))
    .<span class="code-func">background</span>(<span class="code-type">MaterialTheme</span>.colorScheme.surface)
    .<span class="code-func">shadow</span>(<span class="code-number">4</span>.dp, <span class="code-type">RoundedCornerShape</span>(<span class="code-number">12</span>.dp))

<span class="code-comment">// ä½¿ç”¨</span>
<span class="code-type">Box</span>(modifier = <span class="code-type">Modifier</span>.<span class="code-func">cardStyle</span>()) {
    <span class="code-comment">// å†…å®¹</span>
}</code></pre>

        <h2>ä¹ã€è°ƒè¯• Modifier</h2>

        <h3>ä½¿ç”¨ inspectable</h3>

<pre><code><span class="code-comment">// è®©è‡ªå®šä¹‰ Modifier åœ¨ Layout Inspector ä¸­å¯è§</span>
<span class="code-keyword">private class</span> <span class="code-type">MyElement</span>(
    <span class="code-keyword">val</span> value: <span class="code-type">Int</span>
) : <span class="code-type">ModifierNodeElement</span>&lt;<span class="code-type">MyNode</span>&gt;() {
    
    <span class="code-keyword">override fun</span> <span class="code-type">InspectorInfo</span>.<span class="code-func">inspectableProperties</span>() {
        name = <span class="code-string">"myModifier"</span>
        properties[<span class="code-string">"value"</span>] = value
    }
    
    <span class="code-comment">// ...</span>
}</code></pre>

        <h3>æ‰“å° Modifier é“¾</h3>

<pre><code><span class="code-comment">// è°ƒè¯•ç”¨ï¼šæ‰“å° Modifier é“¾çš„ç»“æ„</span>
<span class="code-keyword">fun</span> <span class="code-type">Modifier</span>.<span class="code-func">debugPrint</span>(tag: <span class="code-type">String</span> = <span class="code-string">"Modifier"</span>): <span class="code-type">Modifier</span> {
    <span class="code-func">foldIn</span>(<span class="code-type">Unit</span>) { _, element ->
        <span class="code-func">println</span>(<span class="code-string">"</span>$tag<span class="code-string">: </span>${element::class.simpleName}<span class="code-string">"</span>)
    }
    <span class="code-keyword">return this</span>
}</code></pre>

        <h2>åã€æœ€ä½³å®è·µæ€»ç»“</h2>

        <h3>DO âœ…</h3>

        <ul>
            <li>ç†è§£ Modifier é¡ºåºçš„é‡è¦æ€§ï¼ˆæ´‹è‘±æ¨¡å‹ï¼‰</li>
            <li>ä½¿ç”¨ <code>Modifier.Node</code> åˆ›å»ºé«˜æ€§èƒ½è‡ªå®šä¹‰ Modifier</li>
            <li>ä½¿ç”¨ <code>remember</code> ç¼“å­˜ä¸å˜çš„ Modifier</li>
            <li>å®ç° <code>equals()</code> å’Œ <code>hashCode()</code> ä»¥æ”¯æŒè·³è¿‡æ›´æ–°</li>
            <li>ä¸ºè‡ªå®šä¹‰ Modifier æ·»åŠ  <code>inspectableProperties</code></li>
        </ul>

        <h3>DON'T âŒ</h3>

        <ul>
            <li>ä¸è¦åœ¨ Composable ä¸­æ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„ Modifier</li>
            <li>ä¸è¦ä½¿ç”¨ <code>composed</code>ï¼ˆé™¤éå¿…é¡»å…¼å®¹æ—§ä»£ç ï¼‰</li>
            <li>ä¸è¦å¿½ç•¥ Modifier é¡ºåºçš„å½±å“</li>
            <li>ä¸è¦åœ¨ Modifier ä¸­å­˜å‚¨å¯å˜çŠ¶æ€ï¼ˆä½¿ç”¨ Nodeï¼‰</li>
        </ul>

        <h2>æ€»ç»“</h2>

        <p>Modifier æ˜¯ Compose çš„æ ¸å¿ƒæŠ½è±¡ä¹‹ä¸€ï¼š</p>

        <ul>
            <li><strong>é“¾å¼ç»“æ„</strong>ï¼šCombinedModifier æ„æˆçš„æ ‘å½¢ç»“æ„</li>
            <li><strong>é¡ºåºæ•æ„Ÿ</strong>ï¼šå…ˆå£°æ˜çš„ Modifier åœ¨å¤–å±‚</li>
            <li><strong>Modifier.Node</strong>ï¼šé«˜æ€§èƒ½çš„æ–°å®ç°æ–¹å¼</li>
            <li><strong>å¤šç§èƒ½åŠ›</strong>ï¼šLayoutã€Drawã€Inputã€Semantics ç­‰</li>
            <li><strong>å¯ç»„åˆ</strong>ï¼šé€šè¿‡ <code>then</code> ç»„åˆå¤šä¸ª Modifier</li>
        </ul>

        <p>æŒæ¡ Modifier çš„å†…éƒ¨åŸç†ï¼Œèƒ½å¸®åŠ©ä½ å†™å‡ºæ›´é«˜æ•ˆã€æ›´æ­£ç¡®çš„ Compose ä»£ç ã€‚</p>

        <div class="reference">
            <div class="reference-title">ğŸ“š æ¨èé˜…è¯»</div>
            <a href="https://developer.android.com/jetpack/compose/modifiers" target="_blank">Compose Modifiers - Android Developers</a><br>
            <a href="https://developer.android.com/jetpack/compose/custom-modifiers" target="_blank">Custom Modifiers - Android Developers</a><br>
            <a href="https://www.youtube.com/watch?v=BjGX2RftXsU" target="_blank">Deep dive into Jetpack Compose layouts (Video)</a>
        </div>
    </article>

    <footer class="footer">
        <p>&copy; 2024 Fidroid. <a href="../index.html">è¿”å›é¦–é¡µ</a></p>
    </footer>
</body>
</html>

