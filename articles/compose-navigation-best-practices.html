<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compose Navigation æœ€ä½³å®è·µï¼šè·¯ç”±ã€å‚æ•°ä¸æ·±å±‚é“¾æ¥ - Fidroid</title>
    <meta name="description" content="æ·±å…¥æ¢è®¨ Navigation Compose çš„ä½¿ç”¨æ–¹å¼ï¼ŒåŒ…æ‹¬è·¯ç”±è®¾è®¡ã€å‚æ•°ä¼ é€’ã€åµŒå¥—å¯¼èˆªã€æ·±å±‚é“¾æ¥ä»¥åŠä¸ ViewModel çš„é›†æˆã€‚">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.8;
            color: #e5e7eb;
            background: #020617;
        }
        .navbar {
            background: rgba(15,23,42,0.98);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 4px rgba(15,23,42,0.6);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }
        .nav-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 1rem 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #38bdf8;
            text-decoration: none;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }
        .back-link {
            color: #9ca3af;
            text-decoration: none;
            font-size: 0.9rem;
        }
        .back-link:hover { color: #38bdf8; }

        .article-header {
            padding: 120px 20px 60px;
            background: radial-gradient(circle at top left, #8b5cf6 0, transparent 50%),
                        radial-gradient(circle at bottom right, #22c55e 0, transparent 55%),
                        #020617;
            text-align: center;
        }
        .article-header h1 {
            max-width: 800px;
            margin: 0 auto 1rem;
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -0.03em;
            color: #fff;
        }
        .article-meta {
            color: #9ca3af;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }
        .article-tags {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .article-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            background: rgba(15,23,42,0.85);
            border: 1px solid rgba(139,92,246,0.4);
            color: #c4b5fd;
        }

        .article-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 60px 20px 80px;
        }
        .article-content h2 {
            font-size: 1.6rem;
            margin: 2.5rem 0 1rem;
            color: #f9fafb;
            border-left: 4px solid #8b5cf6;
            padding-left: 1rem;
        }
        .article-content h3 {
            font-size: 1.25rem;
            margin: 2rem 0 0.75rem;
            color: #e5e7eb;
        }
        .article-content p {
            margin-bottom: 1.25rem;
            color: #d1d5db;
        }
        .article-content ul, .article-content ol {
            margin: 1rem 0 1.5rem 1.5rem;
            color: #d1d5db;
        }
        .article-content li { margin-bottom: 0.5rem; }
        .article-content strong { color: #f9fafb; }
        .article-content a {
            color: #38bdf8;
            text-decoration: underline;
        }

        pre {
            background: #0f172a;
            border: 1px solid rgba(139,92,246,0.3);
            border-radius: 12px;
            padding: 1.25rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-size: 0.85rem;
            line-height: 1.6;
        }
        code {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
            color: #e5e7eb;
        }
        .code-keyword { color: #c084fc; }
        .code-func { color: #38bdf8; }
        .code-type { color: #4ade80; }
        .code-string { color: #fb7185; }
        .code-comment { color: #6b7280; font-style: italic; }
        .code-number { color: #fbbf24; }

        .callout {
            background: rgba(139,92,246,0.1);
            border: 1px solid rgba(139,92,246,0.3);
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
            margin: 1.5rem 0;
        }
        .callout-title {
            font-weight: 600;
            color: #c4b5fd;
            margin-bottom: 0.5rem;
        }
        .callout p { margin-bottom: 0; color: #d1d5db; }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            font-size: 0.9rem;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid rgba(148,163,184,0.3);
            padding: 0.75rem 1rem;
            text-align: left;
        }
        .comparison-table th {
            background: rgba(15,23,42,0.8);
            color: #f9fafb;
        }
        .comparison-table td { color: #d1d5db; }

        .footer {
            background: #020617;
            border-top: 1px solid #111827;
            padding: 2rem;
            text-align: center;
            color: #6b7280;
        }
        .footer a { color: #38bdf8; text-decoration: none; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="logo">Fidroid</a>
            <a href="../index.html#blog" class="back-link">â† è¿”å›åšå®¢åˆ—è¡¨</a>
        </div>
    </nav>

    <header class="article-header">
        <h1>Compose Navigation æœ€ä½³å®è·µï¼šè·¯ç”±ã€å‚æ•°ä¸æ·±å±‚é“¾æ¥</h1>
        <p class="article-meta">2024-03-30 Â· 22 min Â· æ¶æ„ä¸å¯¼èˆª</p>
        <div class="article-tags">
            <span class="article-tag">Navigation</span>
            <span class="article-tag">Deep Link</span>
            <span class="article-tag">Type-Safe Routes</span>
            <span class="article-tag">ViewModel</span>
        </div>
    </header>

    <article class="article-content">
        <p>å¯¼èˆªæ˜¯æ¯ä¸ª Android åº”ç”¨çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ã€‚Navigation Compose æä¾›äº†ä¸€å¥—å£°æ˜å¼çš„å¯¼èˆª APIï¼Œä¸ Compose çš„ç¼–ç¨‹æ¨¡å‹å®Œç¾å¥‘åˆã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨å¦‚ä½•è®¾è®¡æ¸…æ™°çš„è·¯ç”±ç»“æ„ã€ä¼ é€’å‚æ•°ã€å¤„ç†æ·±å±‚é“¾æ¥ï¼Œä»¥åŠå¦‚ä½•ä¸ ViewModel ä¼˜é›…é›†æˆã€‚</p>

        <h2>ä¸€ã€Navigation Compose åŸºç¡€è®¾ç½®</h2>
        <p>é¦–å…ˆæ·»åŠ ä¾èµ–å¹¶åˆ›å»ºåŸºæœ¬çš„å¯¼èˆªç»“æ„ï¼š</p>

<pre><code><span class="code-comment">// build.gradle.kts</span>
dependencies {
    implementation(<span class="code-string">"androidx.navigation:navigation-compose:2.7.7"</span>)
}</code></pre>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">AppNavigation</span>() {
    <span class="code-keyword">val</span> navController = <span class="code-func">rememberNavController</span>()

    <span class="code-func">NavHost</span>(
        navController = navController,
        startDestination = <span class="code-string">"home"</span>
    ) {
        <span class="code-func">composable</span>(<span class="code-string">"home"</span>) {
            <span class="code-func">HomeScreen</span>(
                onNavigateToDetail = { id ->
                    navController.<span class="code-func">navigate</span>(<span class="code-string">"detail/$id"</span>)
                }
            )
        }

        <span class="code-func">composable</span>(
            route = <span class="code-string">"detail/{itemId}"</span>,
            arguments = <span class="code-func">listOf</span>(
                <span class="code-func">navArgument</span>(<span class="code-string">"itemId"</span>) { type = NavType.StringType }
            )
        ) { backStackEntry ->
            <span class="code-keyword">val</span> itemId = backStackEntry.arguments?.<span class="code-func">getString</span>(<span class="code-string">"itemId"</span>)
            <span class="code-func">DetailScreen</span>(itemId = itemId)
        }
    }
}</code></pre>

        <h2>äºŒã€ç±»å‹å®‰å…¨çš„è·¯ç”±è®¾è®¡</h2>
        <p>ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥è·¯ç”±å®¹æ˜“å‡ºé”™ã€‚æ¨èä½¿ç”¨ sealed class æˆ– object æ¥å®šä¹‰ç±»å‹å®‰å…¨çš„è·¯ç”±ï¼š</p>

<pre><code><span class="code-keyword">sealed class</span> <span class="code-type">Screen</span>(
    <span class="code-keyword">val</span> route: <span class="code-type">String</span>
) {
    <span class="code-keyword">data object</span> <span class="code-type">Home</span> : <span class="code-type">Screen</span>(<span class="code-string">"home"</span>)
    <span class="code-keyword">data object</span> <span class="code-type">Profile</span> : <span class="code-type">Screen</span>(<span class="code-string">"profile"</span>)
    <span class="code-keyword">data object</span> <span class="code-type">Settings</span> : <span class="code-type">Screen</span>(<span class="code-string">"settings"</span>)

    <span class="code-comment">// å¸¦å‚æ•°çš„è·¯ç”±</span>
    <span class="code-keyword">data class</span> <span class="code-type">Detail</span>(<span class="code-keyword">val</span> itemId: <span class="code-type">String</span>) : <span class="code-type">Screen</span>(<span class="code-string">"detail/$itemId"</span>) {
        <span class="code-keyword">companion object</span> {
            <span class="code-keyword">const val</span> ROUTE_PATTERN = <span class="code-string">"detail/{itemId}"</span>
            <span class="code-keyword">const val</span> ARG_ITEM_ID = <span class="code-string">"itemId"</span>
        }
    }

    <span class="code-comment">// å¸¦å¯é€‰å‚æ•°çš„è·¯ç”±</span>
    <span class="code-keyword">data class</span> <span class="code-type">Search</span>(
        <span class="code-keyword">val</span> query: <span class="code-type">String</span>? = <span class="code-keyword">null</span>,
        <span class="code-keyword">val</span> category: <span class="code-type">String</span>? = <span class="code-keyword">null</span>
    ) : <span class="code-type">Screen</span>(
        <span class="code-func">buildString</span> {
            <span class="code-func">append</span>(<span class="code-string">"search"</span>)
            <span class="code-keyword">val</span> params = <span class="code-func">mutableListOf</span>&lt;<span class="code-type">String</span>&gt;()
            query?.<span class="code-func">let</span> { params.<span class="code-func">add</span>(<span class="code-string">"query=$it"</span>) }
            category?.<span class="code-func">let</span> { params.<span class="code-func">add</span>(<span class="code-string">"category=$it"</span>) }
            <span class="code-keyword">if</span> (params.<span class="code-func">isNotEmpty</span>()) {
                <span class="code-func">append</span>(<span class="code-string">"?"</span>)
                <span class="code-func">append</span>(params.<span class="code-func">joinToString</span>(<span class="code-string">"&"</span>))
            }
        }
    ) {
        <span class="code-keyword">companion object</span> {
            <span class="code-keyword">const val</span> ROUTE_PATTERN = <span class="code-string">"search?query={query}&category={category}"</span>
        }
    }
}</code></pre>

        <h3>ä½¿ç”¨ç±»å‹å®‰å…¨è·¯ç”±</h3>

<pre><code><span class="code-func">NavHost</span>(
    navController = navController,
    startDestination = Screen.Home.route
) {
    <span class="code-func">composable</span>(Screen.Home.route) {
        <span class="code-func">HomeScreen</span>(
            onItemClick = { itemId ->
                navController.<span class="code-func">navigate</span>(Screen.<span class="code-func">Detail</span>(itemId).route)
            }
        )
    }

    <span class="code-func">composable</span>(
        route = Screen.Detail.ROUTE_PATTERN,
        arguments = <span class="code-func">listOf</span>(
            <span class="code-func">navArgument</span>(Screen.Detail.ARG_ITEM_ID) {
                type = NavType.StringType
            }
        )
    ) { backStackEntry ->
        <span class="code-keyword">val</span> itemId = backStackEntry.arguments
            ?.<span class="code-func">getString</span>(Screen.Detail.ARG_ITEM_ID) ?: <span class="code-keyword">return</span>@composable
        <span class="code-func">DetailScreen</span>(itemId = itemId)
    }
}</code></pre>

        <h2>ä¸‰ã€å‚æ•°ä¼ é€’çš„å¤šç§æ–¹å¼</h2>

        <table class="comparison-table">
            <thead>
                <tr>
                    <th>æ–¹å¼</th>
                    <th>è¯­æ³•</th>
                    <th>é€‚ç”¨åœºæ™¯</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>è·¯å¾„å‚æ•°</strong></td>
                    <td><code>detail/{id}</code></td>
                    <td>å¿…éœ€å‚æ•°ï¼Œå¦‚è¯¦æƒ…é¡µ ID</td>
                </tr>
                <tr>
                    <td><strong>æŸ¥è¯¢å‚æ•°</strong></td>
                    <td><code>search?q={query}</code></td>
                    <td>å¯é€‰å‚æ•°ï¼Œå¦‚ç­›é€‰æ¡ä»¶</td>
                </tr>
                <tr>
                    <td><strong>SavedStateHandle</strong></td>
                    <td>ViewModel ä¸­è·å–</td>
                    <td>å¤æ‚æ•°æ®ï¼Œé…åˆ ViewModel</td>
                </tr>
            </tbody>
        </table>

        <h3>è·¯å¾„å‚æ•°ï¼ˆå¿…éœ€ï¼‰</h3>

<pre><code><span class="code-func">composable</span>(
    route = <span class="code-string">"user/{userId}/post/{postId}"</span>,
    arguments = <span class="code-func">listOf</span>(
        <span class="code-func">navArgument</span>(<span class="code-string">"userId"</span>) { type = NavType.LongType },
        <span class="code-func">navArgument</span>(<span class="code-string">"postId"</span>) { type = NavType.LongType }
    )
) { backStackEntry ->
    <span class="code-keyword">val</span> userId = backStackEntry.arguments?.<span class="code-func">getLong</span>(<span class="code-string">"userId"</span>) ?: <span class="code-number">0L</span>
    <span class="code-keyword">val</span> postId = backStackEntry.arguments?.<span class="code-func">getLong</span>(<span class="code-string">"postId"</span>) ?: <span class="code-number">0L</span>
    <span class="code-func">PostDetailScreen</span>(userId, postId)
}</code></pre>

        <h3>æŸ¥è¯¢å‚æ•°ï¼ˆå¯é€‰ï¼‰</h3>

<pre><code><span class="code-func">composable</span>(
    route = <span class="code-string">"products?category={category}&sort={sort}"</span>,
    arguments = <span class="code-func">listOf</span>(
        <span class="code-func">navArgument</span>(<span class="code-string">"category"</span>) {
            type = NavType.StringType
            nullable = <span class="code-keyword">true</span>
            defaultValue = <span class="code-keyword">null</span>
        },
        <span class="code-func">navArgument</span>(<span class="code-string">"sort"</span>) {
            type = NavType.StringType
            defaultValue = <span class="code-string">"newest"</span>
        }
    )
) { backStackEntry ->
    <span class="code-keyword">val</span> category = backStackEntry.arguments?.<span class="code-func">getString</span>(<span class="code-string">"category"</span>)
    <span class="code-keyword">val</span> sort = backStackEntry.arguments?.<span class="code-func">getString</span>(<span class="code-string">"sort"</span>) ?: <span class="code-string">"newest"</span>
    <span class="code-func">ProductListScreen</span>(category, sort)
}</code></pre>

        <h2>å››ã€ä¸ ViewModel é›†æˆ</h2>
        <p>Navigation Compose ä¸ ViewModel çš„é›†æˆéå¸¸è‡ªç„¶ã€‚æ¯ä¸ªå¯¼èˆªç›®çš„åœ°å¯ä»¥æ‹¥æœ‰ç‹¬ç«‹çš„ ViewModelï¼Œå…¶ç”Ÿå‘½å‘¨æœŸä¸ BackStack Entry ç»‘å®šï¼š</p>

<pre><code><span class="code-func">composable</span>(
    route = Screen.Detail.ROUTE_PATTERN,
    arguments = <span class="code-func">listOf</span>(
        <span class="code-func">navArgument</span>(Screen.Detail.ARG_ITEM_ID) { type = NavType.StringType }
    )
) { backStackEntry ->
    <span class="code-comment">// ViewModel è‡ªåŠ¨è·å–è·¯ç”±å‚æ•°</span>
    <span class="code-keyword">val</span> viewModel: <span class="code-type">DetailViewModel</span> = <span class="code-func">hiltViewModel</span>()
    <span class="code-func">DetailScreen</span>(viewModel = viewModel)
}

<span class="code-comment">// DetailViewModel.kt</span>
<span class="code-keyword">@HiltViewModel</span>
<span class="code-keyword">class</span> <span class="code-type">DetailViewModel</span> <span class="code-keyword">@Inject constructor</span>(
    savedStateHandle: <span class="code-type">SavedStateHandle</span>,
    <span class="code-keyword">private val</span> repository: <span class="code-type">ItemRepository</span>
) : <span class="code-type">ViewModel</span>() {

    <span class="code-comment">// ä» SavedStateHandle è·å–å¯¼èˆªå‚æ•°</span>
    <span class="code-keyword">private val</span> itemId: <span class="code-type">String</span> = <span class="code-func">checkNotNull</span>(
        savedStateHandle[Screen.Detail.ARG_ITEM_ID]
    )

    <span class="code-keyword">val</span> uiState: <span class="code-type">StateFlow</span>&lt;<span class="code-type">DetailUiState</span>&gt; = repository
        .<span class="code-func">getItemFlow</span>(itemId)
        .<span class="code-func">map</span> { item -> <span class="code-func">DetailUiState</span>(item = item) }
        .<span class="code-func">stateIn</span>(
            scope = viewModelScope,
            started = SharingStarted.WhileSubscribed(<span class="code-number">5000</span>),
            initialValue = <span class="code-func">DetailUiState</span>(isLoading = <span class="code-keyword">true</span>)
        )
}</code></pre>

        <h2>äº”ã€åµŒå¥—å¯¼èˆªä¸ Bottom Navigation</h2>
        <p>å¤æ‚åº”ç”¨é€šå¸¸éœ€è¦åµŒå¥—å¯¼èˆªå›¾ï¼Œæ¯”å¦‚åº•éƒ¨å¯¼èˆªæ çš„æ¯ä¸ª Tab éƒ½æœ‰ç‹¬ç«‹çš„å¯¼èˆªæ ˆï¼š</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">MainScreen</span>() {
    <span class="code-keyword">val</span> navController = <span class="code-func">rememberNavController</span>()

    <span class="code-func">Scaffold</span>(
        bottomBar = {
            <span class="code-func">NavigationBar</span> {
                <span class="code-keyword">val</span> navBackStackEntry <span class="code-keyword">by</span> navController.<span class="code-func">currentBackStackEntryAsState</span>()
                <span class="code-keyword">val</span> currentDestination = navBackStackEntry?.destination

                <span class="code-func">listOf</span>(
                    BottomNavItem.Home,
                    BottomNavItem.Search,
                    BottomNavItem.Profile
                ).<span class="code-func">forEach</span> { item ->
                    <span class="code-func">NavigationBarItem</span>(
                        icon = { <span class="code-func">Icon</span>(item.icon, contentDescription = item.label) },
                        label = { <span class="code-func">Text</span>(item.label) },
                        selected = currentDestination?.<span class="code-func">hierarchy</span>?.<span class="code-func">any</span> {
                            it.route == item.route
                        } == <span class="code-keyword">true</span>,
                        onClick = {
                            navController.<span class="code-func">navigate</span>(item.route) {
                                <span class="code-comment">// é¿å…é‡å¤åˆ›å»ºç›¸åŒç›®çš„åœ°</span>
                                <span class="code-func">popUpTo</span>(navController.graph.findStartDestination().id) {
                                    saveState = <span class="code-keyword">true</span>
                                }
                                launchSingleTop = <span class="code-keyword">true</span>
                                restoreState = <span class="code-keyword">true</span>
                            }
                        }
                    )
                }
            }
        }
    ) { innerPadding ->
        <span class="code-func">NavHost</span>(
            navController = navController,
            startDestination = <span class="code-string">"home_graph"</span>,
            modifier = <span class="code-type">Modifier</span>.<span class="code-func">padding</span>(innerPadding)
        ) {
            <span class="code-comment">// Home Tab çš„åµŒå¥—å¯¼èˆªå›¾</span>
            <span class="code-func">navigation</span>(
                startDestination = <span class="code-string">"home"</span>,
                route = <span class="code-string">"home_graph"</span>
            ) {
                <span class="code-func">composable</span>(<span class="code-string">"home"</span>) { <span class="code-func">HomeScreen</span>(navController) }
                <span class="code-func">composable</span>(<span class="code-string">"home/detail/{id}"</span>) { <span class="code-func">HomeDetailScreen</span>() }
            }

            <span class="code-comment">// Search Tab çš„åµŒå¥—å¯¼èˆªå›¾</span>
            <span class="code-func">navigation</span>(
                startDestination = <span class="code-string">"search"</span>,
                route = <span class="code-string">"search_graph"</span>
            ) {
                <span class="code-func">composable</span>(<span class="code-string">"search"</span>) { <span class="code-func">SearchScreen</span>(navController) }
                <span class="code-func">composable</span>(<span class="code-string">"search/results"</span>) { <span class="code-func">SearchResultsScreen</span>() }
            }

            <span class="code-comment">// Profile Tab</span>
            <span class="code-func">composable</span>(<span class="code-string">"profile"</span>) { <span class="code-func">ProfileScreen</span>() }
        }
    }
}</code></pre>

        <h2>å…­ã€æ·±å±‚é“¾æ¥ï¼ˆDeep Linksï¼‰</h2>
        <p>Navigation Compose åŸç”Ÿæ”¯æŒæ·±å±‚é“¾æ¥ï¼Œè®©ç”¨æˆ·å¯ä»¥é€šè¿‡ URL ç›´æ¥è·³è½¬åˆ°åº”ç”¨å†…çš„ç‰¹å®šé¡µé¢ï¼š</p>

<pre><code><span class="code-func">composable</span>(
    route = <span class="code-string">"product/{productId}"</span>,
    arguments = <span class="code-func">listOf</span>(
        <span class="code-func">navArgument</span>(<span class="code-string">"productId"</span>) { type = NavType.StringType }
    ),
    deepLinks = <span class="code-func">listOf</span>(
        <span class="code-func">navDeepLink</span> {
            uriPattern = <span class="code-string">"https://fidroid.com/product/{productId}"</span>
        },
        <span class="code-func">navDeepLink</span> {
            uriPattern = <span class="code-string">"fidroid://product/{productId}"</span>
        }
    )
) { backStackEntry ->
    <span class="code-keyword">val</span> productId = backStackEntry.arguments?.<span class="code-func">getString</span>(<span class="code-string">"productId"</span>)
    <span class="code-func">ProductScreen</span>(productId)
}</code></pre>

        <h3>AndroidManifest.xml é…ç½®</h3>

<pre><code>&lt;<span class="code-type">activity</span> android:name=<span class="code-string">".MainActivity"</span>&gt;
    &lt;<span class="code-type">intent-filter</span>&gt;
        &lt;<span class="code-type">action</span> android:name=<span class="code-string">"android.intent.action.VIEW"</span> /&gt;
        &lt;<span class="code-type">category</span> android:name=<span class="code-string">"android.intent.category.DEFAULT"</span> /&gt;
        &lt;<span class="code-type">category</span> android:name=<span class="code-string">"android.intent.category.BROWSABLE"</span> /&gt;
        &lt;<span class="code-type">data</span>
            android:scheme=<span class="code-string">"https"</span>
            android:host=<span class="code-string">"fidroid.com"</span> /&gt;
    &lt;/<span class="code-type">intent-filter</span>&gt;
    &lt;<span class="code-type">intent-filter</span>&gt;
        &lt;<span class="code-type">action</span> android:name=<span class="code-string">"android.intent.action.VIEW"</span> /&gt;
        &lt;<span class="code-type">category</span> android:name=<span class="code-string">"android.intent.category.DEFAULT"</span> /&gt;
        &lt;<span class="code-type">category</span> android:name=<span class="code-string">"android.intent.category.BROWSABLE"</span> /&gt;
        &lt;<span class="code-type">data</span> android:scheme=<span class="code-string">"fidroid"</span> /&gt;
    &lt;/<span class="code-type">intent-filter</span>&gt;
&lt;/<span class="code-type">activity</span>&gt;</code></pre>

        <h2>ä¸ƒã€å¯¼èˆªäº‹ä»¶ä¸ç»“æœå›ä¼ </h2>
        <p>æœ‰æ—¶éœ€è¦ä»ç›®æ ‡é¡µé¢è¿”å›ç»“æœç»™ä¸Šä¸€ä¸ªé¡µé¢ã€‚Navigation Compose æä¾›äº† <code>previousBackStackEntry</code> æ¥å®ç°ï¼š</p>

<pre><code><span class="code-comment">// å‘é€ç»“æœçš„é¡µé¢</span>
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">SelectColorScreen</span>(navController: <span class="code-type">NavController</span>) {
    <span class="code-keyword">val</span> colors = <span class="code-func">listOf</span>(Color.Red, Color.Green, Color.Blue)

    <span class="code-func">LazyColumn</span> {
        <span class="code-func">items</span>(colors) { color ->
            <span class="code-func">Box</span>(
                modifier = <span class="code-type">Modifier</span>
                    .<span class="code-func">fillMaxWidth</span>()
                    .<span class="code-func">height</span>(<span class="code-number">60</span>.dp)
                    .<span class="code-func">background</span>(color)
                    .<span class="code-func">clickable</span> {
                        <span class="code-comment">// å°†ç»“æœè®¾ç½®åˆ°ä¸Šä¸€ä¸ªé¡µé¢çš„ SavedStateHandle</span>
                        navController.previousBackStackEntry
                            ?.savedStateHandle
                            ?.<span class="code-func">set</span>(<span class="code-string">"selected_color"</span>, color.<span class="code-func">toArgb</span>())
                        navController.<span class="code-func">popBackStack</span>()
                    }
            )
        }
    }
}

<span class="code-comment">// æ¥æ”¶ç»“æœçš„é¡µé¢</span>
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">SettingsScreen</span>(navController: <span class="code-type">NavController</span>) {
    <span class="code-keyword">val</span> selectedColor = navController.currentBackStackEntry
        ?.savedStateHandle
        ?.<span class="code-func">getStateFlow</span>&lt;<span class="code-type">Int</span>?&gt;(<span class="code-string">"selected_color"</span>, <span class="code-keyword">null</span>)
        ?.<span class="code-func">collectAsState</span>()

    <span class="code-func">Column</span> {
        <span class="code-func">Text</span>(<span class="code-string">"å½“å‰é€‰ä¸­é¢œè‰²: ${selectedColor?.value}"</span>)
        <span class="code-func">Button</span>(onClick = { navController.<span class="code-func">navigate</span>(<span class="code-string">"select_color"</span>) }) {
            <span class="code-func">Text</span>(<span class="code-string">"é€‰æ‹©é¢œè‰²"</span>)
        }
    }
}</code></pre>

        <h2>å…«ã€å¯¼èˆªåŠ¨ç”»</h2>
        <p>Navigation Compose æ”¯æŒè‡ªå®šä¹‰é¡µé¢åˆ‡æ¢åŠ¨ç”»ï¼š</p>

<pre><code><span class="code-func">composable</span>(
    route = <span class="code-string">"detail/{id}"</span>,
    enterTransition = {
        <span class="code-func">slideInHorizontally</span>(
            initialOffsetX = { it },
            animationSpec = <span class="code-func">tween</span>(<span class="code-number">300</span>)
        ) + <span class="code-func">fadeIn</span>(animationSpec = <span class="code-func">tween</span>(<span class="code-number">300</span>))
    },
    exitTransition = {
        <span class="code-func">slideOutHorizontally</span>(
            targetOffsetX = { -it / <span class="code-number">3</span> },
            animationSpec = <span class="code-func">tween</span>(<span class="code-number">300</span>)
        ) + <span class="code-func">fadeOut</span>(animationSpec = <span class="code-func">tween</span>(<span class="code-number">300</span>))
    },
    popEnterTransition = {
        <span class="code-func">slideInHorizontally</span>(
            initialOffsetX = { -it / <span class="code-number">3</span> },
            animationSpec = <span class="code-func">tween</span>(<span class="code-number">300</span>)
        ) + <span class="code-func">fadeIn</span>(animationSpec = <span class="code-func">tween</span>(<span class="code-number">300</span>))
    },
    popExitTransition = {
        <span class="code-func">slideOutHorizontally</span>(
            targetOffsetX = { it },
            animationSpec = <span class="code-func">tween</span>(<span class="code-number">300</span>)
        ) + <span class="code-func">fadeOut</span>(animationSpec = <span class="code-func">tween</span>(<span class="code-number">300</span>))
    }
) {
    <span class="code-func">DetailScreen</span>()
}</code></pre>

        <div class="callout">
            <p class="callout-title">ğŸ’¡ å…¨å±€å¯¼èˆªåŠ¨ç”»</p>
            <p>å¦‚æœå¸Œæœ›æ‰€æœ‰é¡µé¢ä½¿ç”¨ç»Ÿä¸€çš„åŠ¨ç”»ï¼Œå¯ä»¥åœ¨ NavHost çº§åˆ«è®¾ç½®é»˜è®¤çš„ enterTransitionã€exitTransition ç­‰å‚æ•°ã€‚</p>
        </div>

        <h2>ä¹ã€å¸¸è§é—®é¢˜ä¸æœ€ä½³å®è·µ</h2>

        <h3>1. é¿å…åœ¨ Composable ä¸­æŒæœ‰ NavController å¼•ç”¨</h3>
        <p>å°†å¯¼èˆªæ“ä½œé€šè¿‡å›è°ƒä¼ é€’ï¼Œè®© Screen Composable ä¿æŒæ— çŠ¶æ€ï¼š</p>

<pre><code><span class="code-comment">// âœ… æ¨èï¼šé€šè¿‡å›è°ƒä¼ é€’å¯¼èˆªæ„å›¾</span>
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">HomeScreen</span>(
    onNavigateToDetail: (String) -> Unit
) {
    <span class="code-func">Button</span>(onClick = { <span class="code-func">onNavigateToDetail</span>(<span class="code-string">"item-123"</span>) }) {
        <span class="code-func">Text</span>(<span class="code-string">"æŸ¥çœ‹è¯¦æƒ…"</span>)
    }
}

<span class="code-comment">// âŒ é¿å…ï¼šç›´æ¥ä¾èµ– NavController</span>
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">HomeScreen</span>(navController: <span class="code-type">NavController</span>) {
    <span class="code-func">Button</span>(onClick = { navController.<span class="code-func">navigate</span>(<span class="code-string">"detail/item-123"</span>) }) {
        <span class="code-func">Text</span>(<span class="code-string">"æŸ¥çœ‹è¯¦æƒ…"</span>)
    }
}</code></pre>

        <h3>2. ä½¿ç”¨ launchSingleTop é¿å…é‡å¤å¯¼èˆª</h3>

<pre><code>navController.<span class="code-func">navigate</span>(route) {
    launchSingleTop = <span class="code-keyword">true</span>  <span class="code-comment">// å¦‚æœç›®æ ‡å·²åœ¨æ ˆé¡¶ï¼Œä¸ä¼šé‡å¤åˆ›å»º</span>
}</code></pre>

        <h3>3. æ­£ç¡®å¤„ç†ç³»ç»Ÿè¿”å›é”®</h3>
        <p>Navigation Compose ä¼šè‡ªåŠ¨å¤„ç†ç³»ç»Ÿè¿”å›é”®ã€‚å¦‚æœéœ€è¦è‡ªå®šä¹‰è¿”å›è¡Œä¸ºï¼š</p>

<pre><code><span class="code-func">BackHandler</span>(enabled = hasUnsavedChanges) {
    <span class="code-comment">// æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†</span>
    showExitDialog = <span class="code-keyword">true</span>
}</code></pre>

        <h2>æ€»ç»“</h2>
        <p>Navigation Compose æä¾›äº†ä¸€å¥—ç°ä»£åŒ–çš„å£°æ˜å¼å¯¼èˆªæ–¹æ¡ˆï¼š</p>
        <ul>
            <li>ä½¿ç”¨ <strong>sealed class</strong> å®šä¹‰ç±»å‹å®‰å…¨çš„è·¯ç”±</li>
            <li>é€šè¿‡ <strong>è·¯å¾„å‚æ•°</strong>å’Œ<strong>æŸ¥è¯¢å‚æ•°</strong>ä¼ é€’æ•°æ®</li>
            <li>åˆ©ç”¨ <strong>SavedStateHandle</strong> åœ¨ ViewModel ä¸­è·å–å‚æ•°</li>
            <li>ä½¿ç”¨<strong>åµŒå¥—å¯¼èˆªå›¾</strong>ç»„ç»‡å¤æ‚çš„åº”ç”¨ç»“æ„</li>
            <li>é…ç½®<strong>æ·±å±‚é“¾æ¥</strong>æ”¯æŒå¤–éƒ¨è·³è½¬</li>
            <li>è‡ªå®šä¹‰<strong>é¡µé¢åˆ‡æ¢åŠ¨ç”»</strong>æå‡ä½“éªŒ</li>
        </ul>
        <p>ä¸‹ä¸€æ­¥å»ºè®®ï¼šç»“åˆ <a href="compose-performance-deep-dive.html">Compose æ€§èƒ½ä¼˜åŒ–</a>ï¼Œç¡®ä¿å¯¼èˆªè¿‡ç¨‹ä¸­çš„æµç•…ä½“éªŒã€‚</p>
    </article>

    <footer class="footer">
        <p>&copy; 2024 Fidroid. <a href="../index.html">è¿”å›é¦–é¡µ</a></p>
    </footer>
</body>
</html>


