<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compose Side Effects å®Œå…¨æŒ‡å—ï¼šå‰¯ä½œç”¨å¤„ç†çš„æ­£ç¡®å§¿åŠ¿ - Fidroid</title>
    <meta name="description" content="æ·±å…¥ç†è§£ LaunchedEffectã€DisposableEffectã€SideEffect ç­‰å‰¯ä½œç”¨ APIï¼ŒæŒæ¡åœ¨ Compose ä¸­æ­£ç¡®å¤„ç†å‰¯ä½œç”¨çš„æ–¹æ³•ã€‚">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.8;
            color: #e5e7eb;
            background: #020617;
        }
        .navbar {
            background: rgba(15,23,42,0.98);
            backdrop-filter: blur(10px);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }
        .nav-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 1rem 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #38bdf8;
            text-decoration: none;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }
        .back-link { color: #9ca3af; text-decoration: none; font-size: 0.9rem; }
        .back-link:hover { color: #38bdf8; }

        .article-header {
            padding: 120px 20px 60px;
            background: radial-gradient(circle at top left, #f59e0b 0, transparent 50%),
                        radial-gradient(circle at bottom right, #8b5cf6 0, transparent 55%),
                        #020617;
            text-align: center;
        }
        .article-header h1 {
            max-width: 800px;
            margin: 0 auto 1rem;
            font-size: 2.5rem;
            font-weight: 800;
            letter-spacing: -0.03em;
            color: #fff;
        }
        .article-meta { color: #9ca3af; font-size: 0.9rem; margin-bottom: 1.5rem; }
        .article-tags { display: flex; justify-content: center; flex-wrap: wrap; gap: 0.5rem; }
        .article-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            background: rgba(15,23,42,0.85);
            border: 1px solid rgba(245,158,11,0.4);
            color: #fcd34d;
        }

        .article-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 60px 20px 80px;
        }
        .article-content h2 {
            font-size: 1.6rem;
            margin: 2.5rem 0 1rem;
            color: #f9fafb;
            border-left: 4px solid #f59e0b;
            padding-left: 1rem;
        }
        .article-content h3 { font-size: 1.25rem; margin: 2rem 0 0.75rem; color: #e5e7eb; }
        .article-content p { margin-bottom: 1.25rem; color: #d1d5db; }
        .article-content ul, .article-content ol { margin: 1rem 0 1.5rem 1.5rem; color: #d1d5db; }
        .article-content li { margin-bottom: 0.5rem; }
        .article-content strong { color: #f9fafb; }
        .article-content a { color: #38bdf8; text-decoration: underline; }

        pre {
            background: #0f172a;
            border: 1px solid rgba(245,158,11,0.3);
            border-radius: 12px;
            padding: 1.25rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-size: 0.85rem;
            line-height: 1.6;
        }
        code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; color: #e5e7eb; }
        .code-keyword { color: #c084fc; }
        .code-func { color: #38bdf8; }
        .code-type { color: #4ade80; }
        .code-string { color: #fb7185; }
        .code-comment { color: #6b7280; font-style: italic; }
        .code-number { color: #fbbf24; }

        .callout {
            background: rgba(245,158,11,0.1);
            border: 1px solid rgba(245,158,11,0.3);
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
            margin: 1.5rem 0;
        }
        .callout-title { font-weight: 600; color: #fcd34d; margin-bottom: 0.5rem; }
        .callout p { margin-bottom: 0; color: #d1d5db; }

        .comparison-table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; font-size: 0.9rem; }
        .comparison-table th, .comparison-table td { border: 1px solid rgba(148,163,184,0.3); padding: 0.75rem 1rem; text-align: left; }
        .comparison-table th { background: rgba(15,23,42,0.8); color: #f9fafb; }
        .comparison-table td { color: #d1d5db; }

        .footer {
            background: #020617;
            border-top: 1px solid #111827;
            padding: 2rem;
            text-align: center;
            color: #6b7280;
        }
        .footer a { color: #38bdf8; text-decoration: none; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="logo">Fidroid</a>
            <a href="../index.html#blog" class="back-link">â† è¿”å›åšå®¢åˆ—è¡¨</a>
        </div>
    </nav>

    <header class="article-header">
        <h1>Compose Side Effects å®Œå…¨æŒ‡å—ï¼šå‰¯ä½œç”¨å¤„ç†çš„æ­£ç¡®å§¿åŠ¿</h1>
        <p class="article-meta">2024-04-15 Â· 20 min Â· å‰¯ä½œç”¨å¤„ç†</p>
        <div class="article-tags">
            <span class="article-tag">LaunchedEffect</span>
            <span class="article-tag">DisposableEffect</span>
            <span class="article-tag">SideEffect</span>
            <span class="article-tag">rememberCoroutineScope</span>
        </div>
    </header>

    <article class="article-content">
        <p>åœ¨ Compose çš„å£°æ˜å¼ä¸–ç•Œä¸­ï¼Œå‰¯ä½œç”¨ï¼ˆSide Effectsï¼‰æ˜¯æŒ‡é‚£äº›éœ€è¦åœ¨ Composable å‡½æ•°å¤–éƒ¨æ‰§è¡Œçš„æ“ä½œï¼Œå¦‚ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“è®¿é—®ã€æ—¥å¿—è®°å½•ç­‰ã€‚æ­£ç¡®å¤„ç†å‰¯ä½œç”¨æ˜¯å†™å¥½ Compose ä»£ç çš„å…³é”®ã€‚</p>

        <h2>ä¸€ã€ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨ï¼Ÿ</h2>
        <p>Composable å‡½æ•°åº”è¯¥æ˜¯<strong>çº¯å‡½æ•°</strong>ï¼šç»™å®šç›¸åŒçš„è¾“å…¥ï¼Œæ€»æ˜¯äº§ç”Ÿç›¸åŒçš„ UI è¾“å‡ºï¼Œä¸”æ²¡æœ‰å¯è§‚å¯Ÿçš„å‰¯ä½œç”¨ã€‚ä½†ç°å®ä¸­æˆ‘ä»¬éœ€è¦ï¼š</p>
        <ul>
            <li>åœ¨ç»„ä»¶æ˜¾ç¤ºæ—¶åŠ è½½æ•°æ®</li>
            <li>ç›‘å¬ç”Ÿå‘½å‘¨æœŸäº‹ä»¶</li>
            <li>ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’ï¼ˆä¼ æ„Ÿå™¨ã€å®šä½ç­‰ï¼‰</li>
            <li>è®°å½•åˆ†æäº‹ä»¶</li>
        </ul>
        <p>è¿™äº›æ“ä½œéœ€è¦é€šè¿‡ Compose æä¾›çš„ Effect API æ¥å®‰å…¨æ‰§è¡Œã€‚</p>

        <h2>äºŒã€Effect API é€ŸæŸ¥è¡¨</h2>

        <table class="comparison-table">
            <thead>
                <tr>
                    <th>API</th>
                    <th>æ‰§è¡Œæ—¶æœº</th>
                    <th>å…¸å‹ç”¨é€”</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>LaunchedEffect</code></td>
                    <td>è¿›å…¥ç»„åˆæ—¶ï¼Œkey å˜åŒ–æ—¶é‡å¯</td>
                    <td>åç¨‹ä¸­æ‰§è¡Œä¸€æ¬¡æ€§æ“ä½œ</td>
                </tr>
                <tr>
                    <td><code>DisposableEffect</code></td>
                    <td>è¿›å…¥ç»„åˆæ—¶ï¼Œç¦»å¼€æ—¶æ¸…ç†</td>
                    <td>éœ€è¦æ¸…ç†çš„èµ„æºï¼ˆç›‘å¬å™¨ï¼‰</td>
                </tr>
                <tr>
                    <td><code>SideEffect</code></td>
                    <td>æ¯æ¬¡æˆåŠŸé‡ç»„å</td>
                    <td>åŒæ­¥é Compose çŠ¶æ€</td>
                </tr>
                <tr>
                    <td><code>rememberCoroutineScope</code></td>
                    <td>è·å–ä¸ç»„åˆç»‘å®šçš„åç¨‹ä½œç”¨åŸŸ</td>
                    <td>å“åº”äº‹ä»¶æ—¶å¯åŠ¨åç¨‹</td>
                </tr>
                <tr>
                    <td><code>produceState</code></td>
                    <td>å°†é Compose çŠ¶æ€è½¬ä¸º State</td>
                    <td>è®¢é˜…å¤–éƒ¨æ•°æ®æº</td>
                </tr>
                <tr>
                    <td><code>derivedStateOf</code></td>
                    <td>æ´¾ç”ŸçŠ¶æ€å˜åŒ–æ—¶</td>
                    <td>å‡å°‘ä¸å¿…è¦çš„é‡ç»„</td>
                </tr>
                <tr>
                    <td><code>snapshotFlow</code></td>
                    <td>å°† Compose State è½¬ä¸º Flow</td>
                    <td>åœ¨ Flow ä¸­è§‚å¯ŸçŠ¶æ€å˜åŒ–</td>
                </tr>
            </tbody>
        </table>

        <h2>ä¸‰ã€LaunchedEffectï¼šåç¨‹å‰¯ä½œç”¨</h2>
        <p><code>LaunchedEffect</code> åœ¨è¿›å…¥ç»„åˆæ—¶å¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œå½“ key å˜åŒ–æ—¶å–æ¶ˆå¹¶é‡å¯ï¼š</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">UserProfile</span>(userId: <span class="code-type">String</span>) {
    <span class="code-keyword">var</span> user <span class="code-keyword">by</span> <span class="code-func">remember</span> { <span class="code-func">mutableStateOf</span>&lt;<span class="code-type">User</span>?&gt;(<span class="code-keyword">null</span>) }

    <span class="code-comment">// userId å˜åŒ–æ—¶é‡æ–°åŠ è½½</span>
    <span class="code-func">LaunchedEffect</span>(userId) {
        user = repository.<span class="code-func">getUser</span>(userId)
    }

    user?.<span class="code-func">let</span> { <span class="code-func">ProfileContent</span>(it) }
        ?: <span class="code-func">LoadingIndicator</span>()
}</code></pre>

        <h3>å¤šä¸ª key</h3>
<pre><code><span class="code-comment">// ä»»ä¸€ key å˜åŒ–éƒ½ä¼šé‡å¯</span>
<span class="code-func">LaunchedEffect</span>(userId, refreshTrigger) {
    user = repository.<span class="code-func">getUser</span>(userId)
}</code></pre>

        <h3>åªæ‰§è¡Œä¸€æ¬¡</h3>
<pre><code><span class="code-comment">// ä½¿ç”¨ Unit æˆ– true ä½œä¸º keyï¼Œåªåœ¨é¦–æ¬¡è¿›å…¥æ—¶æ‰§è¡Œ</span>
<span class="code-func">LaunchedEffect</span>(Unit) {
    analytics.<span class="code-func">logScreenView</span>(<span class="code-string">"profile"</span>)
}</code></pre>

        <div class="callout">
            <p class="callout-title">âš ï¸ å¸¸è§é”™è¯¯</p>
            <p>ä¸è¦åœ¨ LaunchedEffect ä¸­ä½¿ç”¨ä¼šé¢‘ç¹å˜åŒ–çš„ keyï¼ˆå¦‚æ¯æ¬¡é‡ç»„éƒ½å˜åŒ–çš„å¯¹è±¡ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´åç¨‹ä¸æ–­é‡å¯ã€‚</p>
        </div>

        <h2>å››ã€DisposableEffectï¼šéœ€è¦æ¸…ç†çš„å‰¯ä½œç”¨</h2>
        <p>å½“å‰¯ä½œç”¨éœ€è¦åœ¨ç¦»å¼€ç»„åˆæ—¶æ¸…ç†ï¼ˆå¦‚å–æ¶ˆç›‘å¬å™¨ï¼‰ï¼Œä½¿ç”¨ <code>DisposableEffect</code>ï¼š</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">LocationTracker</span>(onLocationUpdate: (<span class="code-type">Location</span>) -> <span class="code-type">Unit</span>) {
    <span class="code-keyword">val</span> context = <span class="code-func">LocalContext</span>.current
    <span class="code-keyword">val</span> locationManager = <span class="code-func">remember</span> {
        context.<span class="code-func">getSystemService</span>(<span class="code-type">LocationManager</span>::<span class="code-keyword">class</span>.java)
    }

    <span class="code-func">DisposableEffect</span>(locationManager) {
        <span class="code-keyword">val</span> listener = <span class="code-type">LocationListener</span> { location ->
            <span class="code-func">onLocationUpdate</span>(location)
        }

        locationManager.<span class="code-func">requestLocationUpdates</span>(
            LocationManager.GPS_PROVIDER,
            <span class="code-number">1000L</span>,
            <span class="code-number">10f</span>,
            listener
        )

        <span class="code-comment">// æ¸…ç†ï¼šç¦»å¼€ç»„åˆæ—¶è°ƒç”¨</span>
        <span class="code-func">onDispose</span> {
            locationManager.<span class="code-func">removeUpdates</span>(listener)
        }
    }
}</code></pre>

        <h3>ç”Ÿå‘½å‘¨æœŸè§‚å¯Ÿ</h3>
<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">LifecycleObserver</span>(
    onStart: () -> <span class="code-type">Unit</span>,
    onStop: () -> <span class="code-type">Unit</span>
) {
    <span class="code-keyword">val</span> lifecycleOwner = <span class="code-func">LocalLifecycleOwner</span>.current

    <span class="code-func">DisposableEffect</span>(lifecycleOwner) {
        <span class="code-keyword">val</span> observer = <span class="code-type">LifecycleEventObserver</span> { _, event ->
            <span class="code-keyword">when</span> (event) {
                Lifecycle.Event.ON_START -> <span class="code-func">onStart</span>()
                Lifecycle.Event.ON_STOP -> <span class="code-func">onStop</span>()
                <span class="code-keyword">else</span> -> {}
            }
        }

        lifecycleOwner.lifecycle.<span class="code-func">addObserver</span>(observer)

        <span class="code-func">onDispose</span> {
            lifecycleOwner.lifecycle.<span class="code-func">removeObserver</span>(observer)
        }
    }
}</code></pre>

        <h2>äº”ã€SideEffectï¼šæ¯æ¬¡é‡ç»„åæ‰§è¡Œ</h2>
        <p><code>SideEffect</code> åœ¨æ¯æ¬¡<strong>æˆåŠŸ</strong>é‡ç»„åæ‰§è¡Œï¼Œç”¨äºå°† Compose çŠ¶æ€åŒæ­¥åˆ°é Compose ä»£ç ï¼š</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">AnalyticsScreen</span>(screenName: <span class="code-type">String</span>) {
    <span class="code-comment">// æ¯æ¬¡é‡ç»„ååŒæ­¥åˆ°åˆ†æç³»ç»Ÿ</span>
    <span class="code-func">SideEffect</span> {
        analytics.<span class="code-func">setCurrentScreen</span>(screenName)
    }

    <span class="code-comment">// UI content...</span>
}</code></pre>

        <div class="callout">
            <p class="callout-title">ğŸ’¡ SideEffect vs LaunchedEffect</p>
            <p><code>SideEffect</code> æ˜¯åŒæ­¥çš„ã€æ¯æ¬¡é‡ç»„éƒ½æ‰§è¡Œï¼›<code>LaunchedEffect</code> æ˜¯å¼‚æ­¥çš„ã€åªåœ¨ key å˜åŒ–æ—¶æ‰§è¡Œã€‚</p>
        </div>

        <h2>å…­ã€rememberCoroutineScopeï¼šäº‹ä»¶é©±åŠ¨çš„åç¨‹</h2>
        <p>å½“éœ€è¦åœ¨äº‹ä»¶å›è°ƒï¼ˆå¦‚ç‚¹å‡»ï¼‰ä¸­å¯åŠ¨åç¨‹æ—¶ï¼Œä½¿ç”¨ <code>rememberCoroutineScope</code>ï¼š</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">SubmitButton</span>(onSubmit: <span class="code-keyword">suspend</span> () -> <span class="code-type">Unit</span>) {
    <span class="code-keyword">val</span> scope = <span class="code-func">rememberCoroutineScope</span>()
    <span class="code-keyword">var</span> isLoading <span class="code-keyword">by</span> <span class="code-func">remember</span> { <span class="code-func">mutableStateOf</span>(<span class="code-keyword">false</span>) }

    <span class="code-func">Button</span>(
        onClick = {
            scope.<span class="code-func">launch</span> {
                isLoading = <span class="code-keyword">true</span>
                <span class="code-keyword">try</span> {
                    <span class="code-func">onSubmit</span>()
                } <span class="code-keyword">finally</span> {
                    isLoading = <span class="code-keyword">false</span>
                }
            }
        },
        enabled = !isLoading
    ) {
        <span class="code-keyword">if</span> (isLoading) {
            <span class="code-func">CircularProgressIndicator</span>(modifier = <span class="code-type">Modifier</span>.<span class="code-func">size</span>(<span class="code-number">16</span>.dp))
        } <span class="code-keyword">else</span> {
            <span class="code-func">Text</span>(<span class="code-string">"æäº¤"</span>)
        }
    }
}</code></pre>

        <h2>ä¸ƒã€produceStateï¼šå°†å¤–éƒ¨æ•°æ®è½¬ä¸º State</h2>
        <p><code>produceState</code> å°†é Compose çš„å¼‚æ­¥æ•°æ®æºè½¬æ¢ä¸º Compose Stateï¼š</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">NetworkImage</span>(url: <span class="code-type">String</span>): <span class="code-type">State</span>&lt;<span class="code-type">ImageBitmap</span>?&gt; {
    <span class="code-keyword">return</span> <span class="code-func">produceState</span>&lt;<span class="code-type">ImageBitmap</span>?&gt;(initialValue = <span class="code-keyword">null</span>, url) {
        value = <span class="code-func">loadNetworkImage</span>(url)
    }
}

<span class="code-comment">// ä½¿ç”¨</span>
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">Avatar</span>(imageUrl: <span class="code-type">String</span>) {
    <span class="code-keyword">val</span> image <span class="code-keyword">by</span> <span class="code-func">NetworkImage</span>(imageUrl)

    image?.<span class="code-func">let</span> {
        <span class="code-func">Image</span>(bitmap = it, contentDescription = <span class="code-keyword">null</span>)
    } ?: <span class="code-func">Placeholder</span>()
}</code></pre>

        <h3>è®¢é˜… Flow</h3>
<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">connectivityState</span>(): <span class="code-type">State</span>&lt;<span class="code-type">Boolean</span>&gt; {
    <span class="code-keyword">val</span> context = <span class="code-func">LocalContext</span>.current

    <span class="code-keyword">return</span> <span class="code-func">produceState</span>(initialValue = <span class="code-keyword">true</span>) {
        context.<span class="code-func">observeConnectivity</span>().<span class="code-func">collect</span> { isConnected ->
            value = isConnected
        }
    }
}</code></pre>

        <h2>å…«ã€snapshotFlowï¼šState è½¬ Flow</h2>
        <p><code>snapshotFlow</code> å°† Compose State è½¬æ¢ä¸º Flowï¼Œä¾¿äºåœ¨åç¨‹ä¸­å¤„ç†ï¼š</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">ScrollTracker</span>(listState: <span class="code-type">LazyListState</span>) {
    <span class="code-func">LaunchedEffect</span>(listState) {
        <span class="code-func">snapshotFlow</span> { listState.firstVisibleItemIndex }
            .<span class="code-func">distinctUntilChanged</span>()
            .<span class="code-func">collect</span> { index ->
                analytics.<span class="code-func">logScroll</span>(index)
            }
    }
}</code></pre>

        <h2>ä¹ã€rememberUpdatedStateï¼šæ•è·æœ€æ–°å€¼</h2>
        <p>åœ¨é•¿æ—¶é—´è¿è¡Œçš„å‰¯ä½œç”¨ä¸­ï¼Œç¡®ä¿ä½¿ç”¨æœ€æ–°çš„å›è°ƒæˆ–å€¼ï¼š</p>

<pre><code><span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">SplashScreen</span>(onTimeout: () -> <span class="code-type">Unit</span>) {
    <span class="code-comment">// æ•è·æœ€æ–°çš„ onTimeoutï¼Œå³ä½¿å®ƒåœ¨ LaunchedEffect è¿è¡ŒæœŸé—´å˜åŒ–</span>
    <span class="code-keyword">val</span> currentOnTimeout <span class="code-keyword">by</span> <span class="code-func">rememberUpdatedState</span>(onTimeout)

    <span class="code-func">LaunchedEffect</span>(Unit) {
        <span class="code-func">delay</span>(<span class="code-number">3000</span>)
        <span class="code-func">currentOnTimeout</span>()  <span class="code-comment">// ä½¿ç”¨æœ€æ–°çš„å›è°ƒ</span>
    }

    <span class="code-comment">// Splash UI...</span>
}</code></pre>

        <h2>åã€é€‰æ‹©æ­£ç¡®çš„ Effect</h2>

        <h3>å†³ç­–æµç¨‹å›¾</h3>
        <ol>
            <li><strong>éœ€è¦åœ¨åç¨‹ä¸­æ‰§è¡Œï¼Ÿ</strong>
                <ul>
                    <li>æ˜¯ï¼Œä¸”ç”±çŠ¶æ€å˜åŒ–è§¦å‘ â†’ <code>LaunchedEffect</code></li>
                    <li>æ˜¯ï¼Œä¸”ç”±äº‹ä»¶è§¦å‘ â†’ <code>rememberCoroutineScope</code></li>
                </ul>
            </li>
            <li><strong>éœ€è¦æ¸…ç†èµ„æºï¼Ÿ</strong> â†’ <code>DisposableEffect</code></li>
            <li><strong>éœ€è¦åŒæ­¥åˆ°é Compose ä»£ç ï¼Ÿ</strong> â†’ <code>SideEffect</code></li>
            <li><strong>éœ€è¦å°†å¤–éƒ¨æ•°æ®è½¬ä¸º Stateï¼Ÿ</strong> â†’ <code>produceState</code></li>
            <li><strong>éœ€è¦å°† State è½¬ä¸º Flowï¼Ÿ</strong> â†’ <code>snapshotFlow</code></li>
        </ol>

        <h2>åä¸€ã€å¸¸è§é™·é˜±</h2>

        <h3>1. åœ¨ LaunchedEffect ä¸­ç›´æ¥ä½¿ç”¨å˜åŒ–çš„ lambda</h3>
<pre><code><span class="code-comment">// âŒ é”™è¯¯ï¼šonComplete å˜åŒ–ä¸ä¼šè§¦å‘é‡å¯</span>
<span class="code-func">LaunchedEffect</span>(Unit) {
    <span class="code-func">doSomething</span>()
    <span class="code-func">onComplete</span>()  <span class="code-comment">// å¯èƒ½æ˜¯æ—§çš„ lambda</span>
}

<span class="code-comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨ rememberUpdatedState</span>
<span class="code-keyword">val</span> currentOnComplete <span class="code-keyword">by</span> <span class="code-func">rememberUpdatedState</span>(onComplete)
<span class="code-func">LaunchedEffect</span>(Unit) {
    <span class="code-func">doSomething</span>()
    <span class="code-func">currentOnComplete</span>()
}</code></pre>

        <h3>2. å¿˜è®° onDispose</h3>
<pre><code><span class="code-comment">// âŒ é”™è¯¯ï¼šèµ„æºæ³„æ¼</span>
<span class="code-func">DisposableEffect</span>(key) {
    listener.<span class="code-func">register</span>()
    <span class="code-comment">// å¿˜è®° onDisposeï¼</span>
}

<span class="code-comment">// âœ… æ­£ç¡®</span>
<span class="code-func">DisposableEffect</span>(key) {
    listener.<span class="code-func">register</span>()
    <span class="code-func">onDispose</span> { listener.<span class="code-func">unregister</span>() }
}</code></pre>

        <h3>3. åœ¨ Composition ä¸­ç›´æ¥æ‰§è¡Œå‰¯ä½œç”¨</h3>
<pre><code><span class="code-comment">// âŒ é”™è¯¯ï¼šæ¯æ¬¡é‡ç»„éƒ½ä¼šæ‰§è¡Œ</span>
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">BadExample</span>() {
    analytics.<span class="code-func">logEvent</span>(<span class="code-string">"screen_view"</span>)  <span class="code-comment">// ç›´æ¥è°ƒç”¨ï¼</span>
}

<span class="code-comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨ Effect</span>
<span class="code-keyword">@Composable</span>
<span class="code-keyword">fun</span> <span class="code-func">GoodExample</span>() {
    <span class="code-func">LaunchedEffect</span>(Unit) {
        analytics.<span class="code-func">logEvent</span>(<span class="code-string">"screen_view"</span>)
    }
}</code></pre>

        <h2>æ€»ç»“</h2>
        <p>æ­£ç¡®ä½¿ç”¨ Effect API æ˜¯å†™å¥½ Compose ä»£ç çš„å…³é”®ï¼š</p>
        <ul>
            <li><strong>LaunchedEffect</strong>ï¼šçŠ¶æ€é©±åŠ¨çš„åç¨‹å‰¯ä½œç”¨</li>
            <li><strong>DisposableEffect</strong>ï¼šéœ€è¦æ¸…ç†çš„å‰¯ä½œç”¨</li>
            <li><strong>SideEffect</strong>ï¼šåŒæ­¥ Compose çŠ¶æ€åˆ°å¤–éƒ¨</li>
            <li><strong>rememberCoroutineScope</strong>ï¼šäº‹ä»¶é©±åŠ¨çš„åç¨‹</li>
            <li><strong>produceState</strong>ï¼šå¤–éƒ¨æ•°æ® â†’ State</li>
            <li><strong>snapshotFlow</strong>ï¼šState â†’ Flow</li>
            <li><strong>rememberUpdatedState</strong>ï¼šåœ¨å‰¯ä½œç”¨ä¸­æ•è·æœ€æ–°å€¼</li>
        </ul>
    </article>

    <footer class="footer">
        <p>&copy; 2024 Fidroid. <a href="../index.html">è¿”å›é¦–é¡µ</a></p>
    </footer>
</body>
</html>


